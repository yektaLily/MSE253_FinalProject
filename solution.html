<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yekta Amirkhalili">
<meta name="dcterms.date" content="2025-07-30">

<title>PR2-Solution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="solution_files/libs/clipboard/clipboard.min.js"></script>
<script src="solution_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="solution_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="solution_files/libs/quarto-html/popper.min.js"></script>
<script src="solution_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="solution_files/libs/quarto-html/anchor.min.js"></script>
<link href="solution_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="solution_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="solution_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="solution_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="solution_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introducing-the-page" id="toc-introducing-the-page" class="nav-link active" data-scroll-target="#introducing-the-page"><span class="header-section-number">1</span> Introducing the page</a>
  <ul class="collapse">
  <li><a href="#mini-project-1-hypothesis-testing-30p" id="toc-mini-project-1-hypothesis-testing-30p" class="nav-link" data-scroll-target="#mini-project-1-hypothesis-testing-30p"><span class="header-section-number">1.1</span> Mini-Project 1: Hypothesis Testing [30p]</a></li>
  <li><a href="#mini-project-2-30p" id="toc-mini-project-2-30p" class="nav-link" data-scroll-target="#mini-project-2-30p"><span class="header-section-number">1.2</span> Mini-Project 2 [30p]</a></li>
  <li><a href="#mini-project-3-linear-regression-analysis-40p" id="toc-mini-project-3-linear-regression-analysis-40p" class="nav-link" data-scroll-target="#mini-project-3-linear-regression-analysis-40p"><span class="header-section-number">1.3</span> Mini-Project 3: Linear Regression Analysis [40p]</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">PR2-Solution</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yekta Amirkhalili </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
.quarto-title h1.title {
  font-size: 1.5rem; 
}

h2{
    font-size: 1.2rem;
    background-color:rgba(128, 170, 156, 0.48);
}

.future-idea-box {
  border: 2px solid var(--quarto-hl-header-color, #86bdab); /* Uses Quarto header color variable or fallback */
  border-radius: 8px;
  padding: 1em;
  margin: 1em 0;
  background: #f9f9fc;
}
.future-idea-title {
  font-weight: bold;
  color: var(--quarto-hl-header-color,rgb(111, 172, 152));
  margin-bottom: 0.5em;
  font-size: 1.1em;
}

.blue-text {
  color: rgba(70, 70, 194, 1);
}

</style>
<!-- CSS CHANGES -->
<section id="introducing-the-page" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducing the page</h1>
<p>Hello and welcome. This page is written as a solution by Yekta Amirkhalili. I am PhD candidate at the University of Waterloo, department of Managment Science and Engineering. In Spring 2025, I was a lecturer for MSE 253 - Probability and Statistics 2. This is my students’ final term project. I thought it would be useful to provide a solution manual.<br>
All text in blue is written by me as the instructor as answer/explanation to the question. The question body is in black. The main point of this document is to be used for learning. It’s not really a portfolio project example, the focus really is to teach. Feel free to try and solve the questions on your own and check with my answers. I hope this is useful and you learn from it. I’ve also included a section to show you how I would use AI (chatGPT in this case) for coding or data analysis questions. Always cite it when you use it, and make sure its answer actually make sense! The code is written in <strong>R</strong>.</p>
<section id="mini-project-1-hypothesis-testing-30p" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="mini-project-1-hypothesis-testing-30p"><span class="header-section-number">1.1</span> Mini-Project 1: Hypothesis Testing [30p]</h2>
<p>The following R libraries are used:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="proportion-test" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="proportion-test"><span class="header-section-number">1.1.1</span> Proportion Test</h3>
<p>A survey finds that 60% of users prefer using mobile apps over desktop websites for booking appointments. Your company believes the proportion is different in your city. Use the <code>PRJ2_MP1_PT.csv</code> dataset to test whether the local preference differs from the national figure.</p>
<div class="blue-text">
<p>I will use a one-sample z-test for proportions to test the hypothesis.</p>
<p>Summarizing question’s information:</p>
<ul>
<li>proportion of users who prefer apps over desktop websites is 60/100.</li>
<li>I have data from my city.</li>
<li>Is the proportion I have in my city different from the 60% national figure?</li>
</ul>
<p>Mathamtically, that is:</p>
<p><span class="math display">\[
H_0: p = 0.6
\]</span> vs <span class="math display">\[
H_a: p \neq 0.6
\]</span> Where <span class="math inline">\(p\)</span> is the proportion of users in my city who prefer apps over desktop websites. Since significance level is not given, I will use the default of 0.05. The test statistic is calculated as follows: <span class="math display">\[
z = \frac{\hat{p} - p_0}{\sqrt{\frac{p_0(1 - p_0)}{n}}}
\]</span> where <span class="math inline">\(\hat{p}\)</span> is the sample proportion, <span class="math inline">\(p_0\)</span> is the population proportion, and <span class="math inline">\(n\)</span> is the sample size. The critical region for a two-tailed test at the 0.05 significance level is <span class="math inline">\(|z| &gt; z_{\alpha/2} = 1.96\)</span>. Chapter 10, Example 10.9 and 10.10 would be helpful.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_PT.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  USER_ID Preference 
    &lt;dbl&gt; &lt;chr&gt;      
1       1 Mobile App 
2       2 Desktop App
3       3 Mobile App 
4       4 Desktop App
5       5 Desktop App
6       6 Mobile App </code></pre>
</div>
</div>
<div class="blue-text">
<p>Let’s summarize the data to see how many of each we have:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
# Groups:   Preference [2]
  Preference      n
  &lt;chr&gt;       &lt;int&gt;
1 Mobile App    782
2 Desktop App   718</code></pre>
</div>
</div>
<div class="blue-text">
<p>Add proportion to this:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Preference      n Proportion
  &lt;chr&gt;       &lt;int&gt;      &lt;dbl&gt;
1 Mobile App    782      0.521
2 Desktop App   718      0.479</code></pre>
</div>
</div>
<div class="blue-text">
<p>Already looks kind of close to 60%, but also not really depending on who you ask (52%) - so which is it? You can either calculate the z value and compare it to the critical value, or use the <code>prop.test</code> function in R. This test takes in the number of successes (in this case, the number of users who prefer mobile apps), the total number of observations, the hypothesized proportion, and the alternative hypothesis’s one tailed or two-tailedness.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sum</span>(df1<span class="sc">$</span>Preference <span class="sc">==</span> <span class="st">"Mobile App"</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(df1),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.60</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">correct =</span> <span class="cn">FALSE</span> <span class="co"># optional </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test without continuity correction

data:  sum(df1$Preference == "Mobile App") out of nrow(df1), null probability 0.6
X-squared = 38.678, df = 1, p-value = 4.999e-10
alternative hypothesis: true p is not equal to 0.6
95 percent confidence interval:
 0.4960311 0.5465266
sample estimates:
        p 
0.5213333 </code></pre>
</div>
</div>
<div class="blue-text">
<p>The p-value is quite small, so we reject the null hypothesis. The null hypothesis was that the proportion of users who prefer mobile apps is 60%, and we found that it is significantly different from this value. The 95% confidence interval for the proportion of users who prefer mobile apps is (0.42, 0.54), which does not include 0.6.</p>
</div>
</section>
<section id="difference-in-means" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="difference-in-means"><span class="header-section-number">1.1.2</span> Difference in Means</h3>
<p>Two customer service strategies were implemented in your company. The customer satisfaction scores are collected and saved in <code>PRJ2_MP1_DM.csv</code>. Test whether the mean satisfaction differs significantly between the two strategies.</p>
<div class="blue-text">
<p>I will use a two-sample t-test to test the difference in means between the two customer service strategies. The hypotheses are as follows: <span class="math display">\[
H_0: \mu_1 - \mu_2 = 0
\]</span> vs <span class="math display">\[
H_a: \mu_1 - \mu_2 \neq 0
\]</span> Where <span class="math inline">\(\mu_1\)</span> is the mean satisfaction score for strategy 1 and <span class="math inline">\(\mu_2\)</span> is the mean satisfaction score for strategy 2. The significance level is not given, so I will use the default of 0.05. The test statistic is calculated based on chapter 10.5 of Walpole book.</p>
</div>
<div class="blue-text">
<p>Let’s first look at the data and see the difference between the two strategies.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_DM.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,500
Columns: 3
$ ...1      &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ strategy1 &lt;dbl&gt; 58.533, 56.791, 59.118, 52.179, 59.108, 51.463, 56.945, 58.4…
$ strategy2 &lt;dbl&gt; 88.491, 89.114, 89.632, 74.994, 89.769, 90.928, 93.512, 95.8…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">stg1_mean =</span> <span class="fu">mean</span>(strategy1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">stg2_mean =</span> <span class="fu">mean</span>(strategy2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  stg1_mean stg2_mean
      &lt;dbl&gt;     &lt;dbl&gt;
1      57.0      88.0</code></pre>
</div>
</div>
<div class="blue-text">
<p>It seems that the mean satisfaction score for strategy 1 is much lower than for strategy 2. But, is it significantly different? Let’s see the tests for the cases where:</p>
<ul>
<li>Variances are known or unknown and equal</li>
<li>Variances are unknown and unequal</li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variances are known or unknown and equal</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  df2$strategy1 and df2$strategy2
t = -203.88, df = 2998, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -31.30966 -30.71318
sample estimates:
mean of x mean of y 
 56.97268  87.98410 </code></pre>
</div>
</div>
<div class="blue-text">
<p>Since the p-value is less than 0.05, we reject the null hypothesis and conclude that there is a significant difference in mean satisfaction scores between the two strategies. That is, <span class="math inline">\(\mu_1 - \mu_2 \neq 0\)</span>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variances are unknown and unequal</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  df2$strategy1 and df2$strategy2
t = -203.88, df = 2433, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -31.30969 -30.71315
sample estimates:
mean of x mean of y 
 56.97268  87.98410 </code></pre>
</div>
</div>
<div class="blue-text">
<p>Similarly, if variances were unknown and unequal, we would still reject the null hypothesis. Let’s see if we can say something about the variances:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  df2$strategy1 and df2$strategy2
F = 0.3496, num df = 1499, denom df = 1499, p-value &lt; 2.2e-16
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.3159246 0.3868637
sample estimates:
ratio of variances 
         0.3495994 </code></pre>
</div>
</div>
<div class="blue-text">
<p>Looks like variances are not equal, so we should use the second t-test result. Another way to check means (and variance) between the two groups is using visualizations (but much less formal):</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(strategy1, strategy2), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"strategyName"</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"strategySatisfaction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>strategyName, <span class="at">y=</span>strategySatisfaction)) <span class="sc">+</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Strategy"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Satisfaction"</span>) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variance-test" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="variance-test"><span class="header-section-number">1.1.3</span> Variance Test</h3>
<p>You are analyzing consistency in delivery times between two delivery partners. The dataset is available in <code>PRJ2_MP1_VT.csv</code>. Test whether their delivery time variances are equal.</p>
<div class="blue-text">
<p>All tests are based on Walpole’s book, chapter 10.10. We want to test the following hypotheses: <span class="math display">\[
H_0: \sigma_1^2 = \sigma_2^2
\]</span><br>
vs <span class="math display">\[
H_a: \sigma_1^2 \neq \sigma_2^2
\]</span> Where <span class="math inline">\(\sigma_1^2\)</span> is the variance of delivery times for partner 1 and <span class="math inline">\(\sigma_2^2\)</span> is the variance for partner 2.<br>
We do have to assume the two samples are independent. Since the significance level is not given, I will use the default of 0.05. Look at example 10.13 for more details. Let’s look at the data first and check the variances:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_VT.csv"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 200
Columns: 3
$ ...1          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ delivery_time &lt;dbl&gt; 27.19762, 28.84911, 37.79354, 30.35254, 30.64644, 38.575…
$ partner       &lt;chr&gt; "Partner1", "Partner1", "Partner1", "Partner1", "Partner…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(partner) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">variance =</span> <span class="fu">var</span>(delivery_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  partner  variance
  &lt;chr&gt;       &lt;dbl&gt;
1 Partner1     20.8
2 Partner2     45.8</code></pre>
</div>
</div>
<div class="blue-text">
<p>So, we need to separate the data by partner and then use the <code>var.test</code> function to test the variances.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>partner1 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(partner <span class="sc">==</span> <span class="st">"Partner1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(delivery_time)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>partner2 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(partner <span class="sc">==</span> <span class="st">"Partner2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(delivery_time)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(partner1, partner2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  partner1 and partner2
F = 0.45464, num df = 99, denom df = 99, p-value = 0.0001121
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.305902 0.675704
sample estimates:
ratio of variances 
         0.4546418 </code></pre>
</div>
</div>
<div class="blue-text">
<p>The null hypothesis is that the variances are equal, and the alternative hypothesis is that they are not equal. The p-value is 0.0001, which is less than the significance level of 0.05. Therefore, we reject the null hypothesis and conclude that the variances of delivery times between the two partners are significantly different. This means that one partner is more consistent than the other.</p>
</div>
<hr>
</section>
</section>
<section id="mini-project-2-30p" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="mini-project-2-30p"><span class="header-section-number">1.2</span> Mini-Project 2 [30p]</h2>
<p>You work for a coffee company as a data scientist. The company wants to find out which roasting level leads to the highest average rating from customers. You conduct taste tests and collect scores from 50 random customers for each roast level. The results of this is collected in the <code>PRJ2_MP2.csv</code> file. Write clearly the statistical question you want to answer, your methodology in answering the question and your results. If you find that there are differences between roast levels, determine which groups differ. Finally, complete your analysis by discussing what the findings mean practically and what you suggest to your company to do next.</p>
<div class="blue-text">
<p>The statistical question we want to answer is: “Which roasting level leads to the highest average rating from customers?” We will use ANOVA to test whether there are significant differences in ratings between the different roast levels. The null hypothesis is that there are no differences in ratings between the roast levels, while the alternative hypothesis is that at least one roast level has a different mean rating. We will use a significance level of 0.05. If we find significant differences, we will use post-hoc tests to determine which roast levels differ from each other. Finally, we will interpret the results and provide practical recommendations to the company.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP2.csv"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 150
Columns: 2
$ Roast &lt;chr&gt; "Light", "Light", "Light", "Light", "Light", "Light", "Light", "…
$ Score &lt;dbl&gt; 7.19, 6.22, 6.68, 6.82, 6.70, 6.45, 7.26, 6.45, 7.51, 6.47, 7.15…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Roast) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_rating =</span> <span class="fu">mean</span>(Score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Roast  mean_rating
  &lt;chr&gt;        &lt;dbl&gt;
1 Dark          3.92
2 Light         6.48
3 Medium        8.55</code></pre>
</div>
</div>
<div class="blue-text">
<p>Looks like medium has the highest mean rating, but we need to test if this is statistically significant.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>anova_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(Score <span class="sc">~</span> <span class="fu">as.factor</span>(Roast), <span class="at">data =</span> df4)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Df Sum Sq Mean Sq F value Pr(&gt;F)    
as.factor(Roast)   2  537.0  268.50    1058 &lt;2e-16 ***
Residuals        147   37.3    0.25                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="blue-text">
<p>There is a difference in means between the roast levels, as the p-value is less than 0.05. Therefore, we know that roast level matters! Now, we need to perform post-hoc tests to determine which roast levels differ from each other. We will use Tukey’s HSD test for this purpose.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tukey_result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova_result)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>tukey_result    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Score ~ as.factor(Roast), data = df4)

$`as.factor(Roast)`
               diff      lwr      upr p adj
Light-Dark   2.5582 2.319658 2.796742     0
Medium-Dark  4.6260 4.387458 4.864542     0
Medium-Light 2.0678 1.829258 2.306342     0</code></pre>
</div>
</div>
<div class="blue-text">
<p>Another way to do this:</p>
<ul>
<li>Separate the data by roast level and create the covariates (go to your notes and see Indicator variables) <span class="math display">\[
y = \mu + \tau_1 (I(L) - I(D)) + \tau_2 (I(M) - I(D)) + \epsilon
\]</span></li>
<li>Make pairwise comparisons between the roast levels, creating a new value from the other two (factor levels)</li>
<li>Use a linear model</li>
<li>Use tukey’s and bonferroni</li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df4<span class="sc">$</span>Roast <span class="ot">&lt;-</span> <span class="fu">factor</span>(df4<span class="sc">$</span>Roast, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Dark"</span>, <span class="st">"Light"</span>, <span class="st">"Medium"</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up custom contrasts: </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First column: Light vs Dark</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Second column: Medium vs Dark</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(df4<span class="sc">$</span>Roast) <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="co"># Dark</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1</span>,  <span class="dv">0</span>,  <span class="co"># Light</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>,  <span class="dv">1</span>   <span class="co"># Medium</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(<span class="fu">contrasts</span>(df4<span class="sc">$</span>Roast)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Light_vs_Dark"</span>, <span class="st">"Medium_vs_Dark"</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>contrast_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Score <span class="sc">~</span> Roast, <span class="at">data =</span> df4)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(contrast_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Score ~ Roast, data = df4)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5502 -0.2883  0.0028  0.2873  1.4258 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          6.48240    0.07124   90.99  &lt; 2e-16 ***
RoastLight_vs_Dark   2.55820    0.10075   25.39  &lt; 2e-16 ***
RoastMedium_vs_Dark -0.49040    0.17450   -2.81  0.00562 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5037 on 147 degrees of freedom
Multiple R-squared:  0.935, Adjusted R-squared:  0.9342 
F-statistic:  1058 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="blue-text">
<p>From the results, we have: <span class="math inline">\(\mu = 6.482\)</span>, <span class="math inline">\(\tau_1 = 2.558\)</span>, and <span class="math inline">\(\tau_2 = -0.490\)</span>. We need to calculate the t-statistic: <span class="math display">\[
t = \frac{\hat{\tau}_i - \hat{\tau}_j}{\sqrt{2\frac{\sigma^2}{n}}}
\]</span> Critical values for multiple comparisons:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sigma_sq <span class="ot">&lt;-</span> <span class="fl">0.5037</span> <span class="co"># from contrast_model summary </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> sigma_sq <span class="sc">/</span> <span class="dv">50</span>) <span class="co"># 50 is the number of observations per group</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>tau_light_vs_medium <span class="ot">&lt;-</span> <span class="sc">-</span>(<span class="fl">2.55820</span> <span class="sc">-</span> <span class="fl">0.49040</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>t_light_vs_dark <span class="ot">&lt;-</span> (<span class="fl">2.55820</span>) <span class="sc">/</span> denom</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>t_medium_vs_dark <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="fl">0.49040</span>) <span class="sc">/</span> denom</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>t_light_vs_medium <span class="ot">&lt;-</span> tau_light_vs_medium <span class="sc">/</span> denom </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="blue-text">
<p>Now compare these with bonferroni and tukey’s critical values:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonferroni critical value</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bonferroni_critical <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="dv">147</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 147 is the number of observations - 3 (number of groups)</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Tukey's critical value</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>tukey_critical <span class="ot">&lt;-</span> <span class="fu">qtukey</span>(<span class="fl">0.95</span>, <span class="dv">3</span>, <span class="dv">147</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"bonferonni"</span>, <span class="fu">round</span>(bonferroni_critical,<span class="dv">3</span>), <span class="st">" Tukey"</span>, <span class="fu">round</span>(tukey_critical,<span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bonferonni 2.148  Tukey 2.368"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_light_vs_dark <span class="sc">&gt;</span> bonferroni_critical, <span class="st">"and "</span>, t_light_vs_dark <span class="sc">&gt;</span> tukey_critical))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TRUE and  TRUE"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_medium_vs_dark <span class="sc">&gt;</span> bonferroni_critical, <span class="st">"and "</span>, t_medium_vs_dark <span class="sc">&gt;</span> tukey_critical))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FALSE and  FALSE"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_light_vs_medium <span class="sc">&gt;</span> bonferroni_critical,<span class="st">"and "</span>, t_light_vs_medium <span class="sc">&gt;</span> tukey_critical))    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FALSE and  FALSE"</code></pre>
</div>
</div>
<div class="blue-text">
<p>Since if <span class="math inline">\(t_{ij} &gt; t_{crit}\)</span>, then we can reject the null hypothesis that the two means are equal. Therefore, only ones different are light vs dark. So, <span class="math inline">\(\mu_{light} \neq \mu_{dark}\)</span>. Since these two groups are different, maybe the company should focus on improving the dark roast to match the light roast’s quality so the dark roast rating isn’t so low.</p>
</div>
</section>
<section id="mini-project-3-linear-regression-analysis-40p" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="mini-project-3-linear-regression-analysis-40p"><span class="header-section-number">1.3</span> Mini-Project 3: Linear Regression Analysis [40p]</h2>
<p>Download the <code>PRJ2_MP3_airbnb.csv</code> dataset either from LEARN or from <a href="https://www.kaggle.com/datasets/aroramahima1/amsterdam-airbnb-prices-dataset/data">Kaggle</a>. This dataset has 33 columns and <span class="math inline">\(7,833\)</span> rows of Airbnb listings from Amsterdam. Use this dataset to predict the price of Airbnb listings in Amsterdam using linear regression. Make sure you clean and pre-process the dataset, include exploratory data analysis, check regression assumptions, and set aside 20% of the dataset as your test data. You do not need to include all the variables (columns) in the model, but your final prediction accuracy (as long as overfitting is not an issue) will be graded. Include a correlation matrix with the model variables before you do the modeling.</p>
<p>Make sure you can justify any variable that is included in your model (using literature or data). Check for multi-collinearity and normality of residuals. Most importantly, interpret the regression results: Which predictors are significant? What does the coefficient of each mean in real-world terms? How good is your model? Be sure to explain your findings in simple, real-world terms. For example: ``Each additional bedroom increases the price by $85 on average, holding other variables constant.’’ Write your regression model’s mathematical formula and introduce the notation in a Table.</p>
<div class="blue-text">
<p>Let’s begin with reading the data and addressing the train and test split.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PRJ2_MP3_airbnb.csv"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,833
Columns: 33
$ host_id                     &lt;int&gt; 1662, 3159, 3718, 4716, 5271, 5271, 5271, …
$ host_name                   &lt;chr&gt; "Chloe", "Daniel", "Britta", "Stefan", "Ty…
$ host_since_year             &lt;int&gt; 2008, 2008, 2008, 2008, 2008, 2008, 2008, …
$ host_since_anniversary      &lt;chr&gt; "8/11", "9/24", "10/19", "11/30", "12/17",…
$ id                          &lt;int&gt; 304958, 2818, 103026, 550017, 4728389, 550…
$ neighbourhood_cleansed      &lt;chr&gt; "Westerpark", "Oostelijk Havengebied - Ind…
$ city                        &lt;chr&gt; "Amsterdam", "Amsterdam", "Amsterdam", "Am…
$ state                       &lt;chr&gt; "North Holland", "North Holland", "Noord-H…
$ zipcode                     &lt;chr&gt; "1053", "", "1053", "1017", "1016 AM", "10…
$ country                     &lt;chr&gt; "Netherlands", "Netherlands", "Netherlands…
$ latitude                    &lt;dbl&gt; 52.37302, 52.36575, 52.36939, 52.36191, 52…
$ longitude                   &lt;dbl&gt; 4.868461, 4.941419, 4.866972, 4.888050, 4.…
$ property_type               &lt;chr&gt; "Apartment", "Apartment", "Apartment", "Ap…
$ room_type                   &lt;chr&gt; "Entire home/apt", "Private room", "Entire…
$ accommodates                &lt;int&gt; 4, 2, 4, 2, 6, 4, 2, 2, 3, 2, 3, 3, 2, 3, …
$ bathrooms                   &lt;dbl&gt; 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.…
$ bedrooms                    &lt;int&gt; 2, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 2, 1, 1, …
$ beds                        &lt;int&gt; 2, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 2, 1, 1, …
$ bed_type                    &lt;chr&gt; "Real Bed", "Real Bed", "Real Bed", "Real …
$ price                       &lt;int&gt; 130, 59, 95, 100, 250, 140, 115, 80, 80, 9…
$ guests_included             &lt;int&gt; 4, 1, 2, 1, 2, 2, 1, 1, 2, 1, 2, 1, 1, 2, …
$ extra_people                &lt;int&gt; 10, 10, 25, 10, 25, 25, 0, 0, 15, 0, 30, 0…
$ minimum_nights              &lt;int&gt; 4, 3, 3, 2, 2, 2, 1, 3, 6, 3, 7, 3, 3, 4, …
$ host_response_time          &lt;chr&gt; "within a day", "within an hour", "within …
$ host_response_rate          &lt;chr&gt; "0.8", "1", "1", "1", "0.89", "0.9", "0.89…
$ number_of_reviews           &lt;int&gt; 11, 108, 15, 20, 1, 0, 4, 33, 36, 8, 3, 2,…
$ review_scores_rating        &lt;int&gt; 98, 97, 92, 97, 100, NA, 95, 95, 96, 93, 9…
$ review_scores_accuracy      &lt;int&gt; 10, 10, 9, 10, 8, NA, 9, 9, 9, 10, 10, 10,…
$ review_scores_cleanliness   &lt;int&gt; 10, 10, 9, 10, 10, NA, 9, 10, 10, 9, 9, 10…
$ review_scores_checkin       &lt;int&gt; 9, 10, 10, 10, 8, NA, 9, 10, 10, 9, 10, 10…
$ review_scores_communication &lt;int&gt; 10, 10, 10, 10, 10, NA, 10, 10, 10, 9, 10,…
$ review_scores_location      &lt;int&gt; 10, 9, 9, 10, 10, NA, 10, 10, 9, 10, 10, 1…
$ review_scores_value         &lt;int&gt; 10, 10, 9, 10, 6, NA, 9, 9, 9, 9, 10, 10, …</code></pre>
</div>
</div>
<div class="blue-text">
<p>The task is to predict the price of airbnb listing. So, first thing I do is to figure out which column is my outcome variable: <code>price</code>. Next, it’s asking me to clean the data. This could mean anything, but a good first step is to look at the datatypes you have in the dataset to figure out a cleaning process. For strings (character data), you may need to lower case everything so you have consistent casing and you may need to fix some typos. For numeric data, there’s more you can do: check the summary statistics to see if there are very obvious outliers (things that don’t make sense or don’t look like the rest). You can do this by looking at several things: really big numbers, really small numbers, standard deviations, mean vs median and skewness of your data. Another way to do this is through visualizations. From our class discussion, though, we have a solid method: calculate the IQR. Lastly, check for null values. If you have 100 null values in a 7,000-row dataset, it’s fine to drop them. However, anything more than 10% of your data is huge! A better way to address null values is through logic. Check why there are empty cells. Is it human error or does that empty cell actually mean something? If it’s meaningful, can you fill it out? Even if it’s error, can you still fill it out? For example, can you replace the null values with the median of the non-null entries without changing the overall distribution of the column? We will address these first and then start the model-building. The data analysis part of any project is often about 80% of the effort!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. outcome (Y) variable is price </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> df<span class="sc">$</span>price </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. clean: strings &gt; to lowercase, assume for now no typos </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), tolower))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. clean: integers &gt; check summary statistics: </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="fu">where</span>(is.numeric))) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               n         mean           sd       median
host_id                     7833 9.879849e+06 7.932933e+06 7.392601e+06
host_since_year             7833 2.012930e+03 1.174583e+00 2.013000e+03
id                          7833 2.926936e+06 1.739974e+06 2.964891e+06
latitude                    7833 5.236653e+01 1.411608e-02 5.236654e+01
longitude                   7833 4.888232e+00 3.005851e-02 4.886406e+00
accommodates                7833 3.114643e+00 1.757483e+00 2.000000e+00
bathrooms                   7764 1.112957e+00 3.948719e-01 1.000000e+00
bedrooms                    7819 1.414887e+00 8.862171e-01 1.000000e+00
beds                        7820 1.983887e+00 1.654441e+00 1.000000e+00
price                       7833 1.290110e+02 1.280324e+02 1.090000e+02
guests_included             7833 1.641900e+00 1.145144e+00 1.000000e+00
extra_people                7833 1.361713e+01 1.891129e+01 0.000000e+00
minimum_nights              7833 2.509000e+00 1.898255e+00 2.000000e+00
number_of_reviews           7833 1.383289e+01 2.547680e+01 5.000000e+00
review_scores_rating        6135 9.334230e+01 7.535279e+00 9.500000e+01
review_scores_accuracy      6124 9.446930e+00 8.156713e-01 1.000000e+01
review_scores_cleanliness   6124 9.289517e+00 9.678557e-01 1.000000e+01
review_scores_checkin       6125 9.638857e+00 7.263754e-01 1.000000e+01
review_scores_communication 6122 9.698301e+00 6.456675e-01 1.000000e+01
review_scores_location      6124 9.292946e+00 8.494799e-01 9.000000e+00
review_scores_value         6122 9.040346e+00 8.817556e-01 9.000000e+00
                                    min          max        skew
host_id                     1662.000000 3.059504e+07  0.81130562
host_since_year             2008.000000 2.015000e+03 -0.59126334
id                          2818.000000 5.897527e+06  0.03528409
latitude                      52.291569 5.242538e+01 -0.01404966
longitude                      4.763264 5.019667e+00  0.44426940
accommodates                   1.000000 1.600000e+01  3.16165857
bathrooms                      0.000000 8.000000e+00  6.47581618
bedrooms                       0.000000 1.000000e+01  2.71532753
beds                           1.000000 1.600000e+01  3.96863449
price                         15.000000 9.000000e+03 43.46141121
guests_included                0.000000 1.600000e+01  3.72688346
extra_people                   0.000000 2.350000e+02  1.94516295
minimum_nights                 1.000000 2.700000e+01  4.36695445
number_of_reviews              0.000000 2.970000e+02  4.10772044
review_scores_rating          20.000000 1.000000e+02 -2.80736219
review_scores_accuracy         2.000000 1.000000e+01 -2.29337041
review_scores_cleanliness      2.000000 1.000000e+01 -2.05167227
review_scores_checkin          2.000000 1.000000e+01 -3.54040014
review_scores_communication    2.000000 1.000000e+01 -3.31295986
review_scores_location         2.000000 1.000000e+01 -1.57247116
review_scores_value            2.000000 1.000000e+01 -1.77256286</code></pre>
</div>
</div>
<div class="blue-text">
<p>Let’s analyze the summary statistics for now. We see already based on the counts in each variable (look at column <code>n</code>) that there are some missing values because the numbers are not the same for everything. There are only a few interesting columns I think that are worth looking into. This should definitely be done based on literature and what others have done, but let’s go ahead with just “intution” for now. I don’t care about <code>host_id</code>, <code>id</code>, <code>latitude</code>, <code>longitude</code>, <code>guests_included</code>, and if we have the aggregate review rating (<code>review_scores_rating</code>) I don’t really need to have the sub-groups contirbuting to it. Although, you may later want to focus on just one aspect of the review/rating, so let’s keep these. For the rest, let’s actually get rid of these columns and re-run the analysis. <em>I will keep id in, but convert it to factor – this is because it’s a good idea to have a unique identifier for things</em>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep a copy of the data </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> df</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># drop the columns we don't need </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(host_id, latitude, longitude, guests_included))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># re-run the analysis </span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. clean: integers &gt; check summary statistics: </span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="fu">where</span>(is.numeric))) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               n         mean           sd  median  min     max
host_since_year             7833 2.012930e+03 1.174583e+00    2013 2008    2015
id                          7833 2.926936e+06 1.739974e+06 2964891 2818 5897527
accommodates                7833 3.114643e+00 1.757483e+00       2    1      16
bathrooms                   7764 1.112957e+00 3.948719e-01       1    0       8
bedrooms                    7819 1.414887e+00 8.862171e-01       1    0      10
beds                        7820 1.983887e+00 1.654441e+00       1    1      16
price                       7833 1.290110e+02 1.280324e+02     109   15    9000
extra_people                7833 1.361713e+01 1.891129e+01       0    0     235
minimum_nights              7833 2.509000e+00 1.898255e+00       2    1      27
number_of_reviews           7833 1.383289e+01 2.547680e+01       5    0     297
review_scores_rating        6135 9.334230e+01 7.535279e+00      95   20     100
review_scores_accuracy      6124 9.446930e+00 8.156713e-01      10    2      10
review_scores_cleanliness   6124 9.289517e+00 9.678557e-01      10    2      10
review_scores_checkin       6125 9.638857e+00 7.263754e-01      10    2      10
review_scores_communication 6122 9.698301e+00 6.456675e-01      10    2      10
review_scores_location      6124 9.292946e+00 8.494799e-01       9    2      10
review_scores_value         6122 9.040346e+00 8.817556e-01       9    2      10
                                   skew
host_since_year             -0.59126334
id                           0.03528409
accommodates                 3.16165857
bathrooms                    6.47581618
bedrooms                     2.71532753
beds                         3.96863449
price                       43.46141121
extra_people                 1.94516295
minimum_nights               4.36695445
number_of_reviews            4.10772044
review_scores_rating        -2.80736219
review_scores_accuracy      -2.29337041
review_scores_cleanliness   -2.05167227
review_scores_checkin       -3.54040014
review_scores_communication -3.31295986
review_scores_location      -1.57247116
review_scores_value         -1.77256286</code></pre>
</div>
</div>
<div class="blue-text">
<p>Let’s take a look at what this means:</p>
<ul>
<li>most hosts have been active since 2013 (median), and the SD is only 1 year so we’re good there.</li>
<li>most places accomate 2-3 people (SD = 1), this makes sense too. Although, a little bit highly skewed but not super bad. A value greater than 4-5 would be huge.</li>
<li>a place with 8 bathrooms! It’s also highly skewed it seems, but the SD is fine.</li>
<li>again, a place with 10 bedrooms (probably the same place with the 8 bathrooms). Not as bad of a skew as the bathroom numbers.</li>
<li>Number of beds should match the bedrooms, right? Unless there are rooms that have more than 1 bed in them or they’re coundint a queen or king-size bed as 2 beds (allowing for 2 people to share). So, I’m not concerned here with the 16 maximum.</li>
<li>Ignore price for now.</li>
<li>one of the places allows for up to 235 extra people! Is this a hotel or what?! What kind of airbnb would allow for up to 235 people?! another red flag here is the large standard deviation (larger than the mean) and the fact that the median is 0 but mean is 13. There’s definitely an outlier here!</li>
<li>minimum nights is also kind of skewed, as there’s at least one place that’s asking for 27 nights!</li>
<li>the difference between the average number of reviews (<span class="math inline">\(13.83\)</span>) and the median <span class="math inline">\(5\)</span> is big, but an even bigger indication is the almost double the mean standard deviation of <span class="math inline">\(25.48\)</span>! There’s definitely discrepancy. I wonder, <strong>are the ratings adjusted for this huge difference?</strong></li>
<li>the ratings don’t seem to be that odd - the mean and median are close, standard deviation makes sense, and it’s not too badly skewed. I think they may have adjusted the rating based on the number of reviews. What I mean is: if a place gets 1000 reviews of 100, that’s a much better place than a place with 10 reviews that got 100 and 50, for an average of 80 (don’t do that math, it might not math!lol)</li>
<li>For the rest of the review scores, there’s none that really stand out.</li>
</ul>
<p>There’s unfortunately no information on the Kaggle webpage for the data that would let us know whether the number of reviews were considered in the final review score. So, let’s ask chatGPT! Here’s my prompt:</p>
</div>
<div class="custom-box" style="background-color: #fff8dc; padding: 1em; border-radius: 5px;">
<blockquote class="blockquote">
<p>I’m working with the attached dataset. I see there’s a huge discrepancy in the number of reviews (column: number_of_reviews), where the difference between the average number of reviews (<span class="math inline">\(13.83\)</span>) and the median <span class="math inline">\(5\)</span> is big, with a standard deviation of <span class="math inline">\(25.48\)</span>! There’s definitely discrepancy. When I look at the review scores (review_scores_rating), I don’t see anything odd. I am wondering though, are the number of reviews considered in this review_scores_rating? How can I find out if it has been? I’ve checked the data source but they don’t mention it.</p>
</blockquote>
</div>
<div class="blue-text">
<p>Here is chatGPT (4o)’s answer:</p>
</div>
<div class="custom-box" style="background-color: #fff8dc; padding: 1em; border-radius: 5px;">
<blockquote class="blockquote">
<p>I’ll now calculate the correlation between number_of_reviews and review_scores_rating. That can hint if listings with more reviews tend to have higher or lower scores. The correlation between number_of_reviews and review_scores_rating is 0.005 — basically zero. <strong>What this means:</strong> There’s no relationship between how many reviews a listing has and its review score. So, review scores are not weighted by number of reviews in this dataset. A listing with just 1 review can have the same score as one with 200 reviews.</p>
</blockquote>
</div>
<div class="blue-text">
<p>Never accept a first response, even though it seems like it makes total sense. If not for anything, do it for your own learning. So, let’s dig in deeper, here’s my follow-up prompt:</p>
</div>
<div class="custom-box" style="background-color: #fff8dc; padding: 1em; border-radius: 5px;">
<blockquote class="blockquote">
<p>why would number of reviews and review score having low correlation mean that the review score was not weighted by the number of reviews? Can you tell me how it would be different if it were weighted by the number of reviews? What would be the difference then?</p>
</blockquote>
</div>
<div class="blue-text">
<p>It’s answer:</p>
</div>
<div class="custom-box" style="background-color: #fff8dc; padding: 1em; border-radius: 5px;">
<p>Great question. Let’s break this down simply:</p>
<section id="what-correlation-shows" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="what-correlation-shows"><span class="header-section-number">1.3.1</span> 🔹 What correlation shows:</h3>
<p>A low correlation (≈ 0) between <code>number_of_reviews</code> and <code>review_scores_rating</code> means:</p>
<ul>
<li>Listings with more reviews don’t consistently get higher or lower scores.</li>
<li>Review score doesn’t seem to depend on how many people rated it.</li>
</ul>
</section>
<section id="what-weighted-average-would-mean" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="what-weighted-average-would-mean"><span class="header-section-number">1.3.2</span> 🔹 What <em>weighted</em> average would mean:</h3>
<p>If <code>review_scores_rating</code> were <strong>weighted by number of reviews</strong>, the score you see for each listing would <strong>reflect the total volume of reviews</strong> behind it.</p>
<p>So:</p>
<ul>
<li>Listings with <strong>more reviews</strong> would have <strong>more stable scores</strong> (less likely to be extreme).</li>
<li>Listings with <strong>fewer reviews</strong> might fluctuate more or show up with extreme scores.</li>
<li>You’d expect some relationship — maybe small, but not zero — between review count and score.</li>
</ul>
</section>
<section id="example" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="example"><span class="header-section-number">1.3.3</span> 🔹 Example:</h3>
<p>Say two listings:</p>
<ul>
<li>Listing A: 1 review <span class="math inline">\(\rightarrow\)</span> 100</li>
<li>Listing B: 200 reviews <span class="math inline">\(\rightarrow\)</span> 95</li>
</ul>
<p>If the dataset just shows the raw average per listing, both are treated equally.</p>
<p>But if you wanted to show an overall score <strong>weighted across listings</strong>, the second one should count more toward the total score, because it’s based on more opinions.</p>
</section>
<section id="if-it-were-weighted" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="if-it-were-weighted"><span class="header-section-number">1.3.4</span> 🔹 If it were weighted:</h3>
<p>In a <strong>weighted system</strong>, we’d calculate an average like this across all listings:</p>
<p><span class="math display">\[
Weighted Avg = \frac{\sum ({score}_i \times {numReviews}_i)}{\sum {numReviews}_i}
\]</span></p>
<p>This is <strong>not</strong> what the dataset is doing.</p>
</section>
<section id="what-would-correlation-look-like-if-scores-were-weighted" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="what-would-correlation-look-like-if-scores-were-weighted"><span class="header-section-number">1.3.5</span> 🔹 What would correlation look like if scores were weighted?</h3>
<p>If listings with more reviews had more influence on their visible rating (e.g., due to Bayesian averaging or damping), you’d expect:</p>
<ul>
<li>A small positive correlation (higher review count → more “stable” or average score).</li>
<li>Outliers (e.g., 1-review listings with 100) would be pushed toward the average.</li>
</ul>
<p>In short:</p>
<ul>
<li><strong>Low correlation</strong> suggests that review count doesn’t influence the rating shown.</li>
<li>If scores were adjusted or stabilized based on review count, <strong>you’d expect a non-zero correlation</strong>.</li>
</ul>
<p>Let me know if you want to simulate what a weighted score would look like!</p>
</section>
</div>
<div class="blue-text">
<p>I would not, but this was a fantastic answer! I really hope you see how tools like chatGPT and other LLMs can be useful like this. Let’s review: If there is no correlation between number of reviews and the review score, then that means there is no relationship between the two. So, you can think of it as: the number of reviews played no parts in the construction of review score! Since it’s not weight adjusted, that’s actually the first thing I would change here! Then I wouldn’t need both columns in a model.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the global average score </span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>global_avg <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>review_scores_rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a weight m — think of it as the minimum number of reviews assumed before we trust the score, I'll set it as the median number of reviews we have </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">5</span>   </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now compute the weighted score per row</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_review_score =</span> (number_of_reviews <span class="sc">/</span> (number_of_reviews <span class="sc">+</span> m)) <span class="sc">*</span> review_scores_rating <span class="sc">+</span> (m <span class="sc">/</span> (number_of_reviews <span class="sc">+</span> m)) <span class="sc">*</span> global_avg</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="blue-text">
<p>Before moving to the other columns, let’s also visualize some of the columns that I had suspected to be highly skewed: <code>bathrooms</code>, <code>minimum_nights</code>, <code>number_of_reviews</code>. I’ll also add visualizations for the columns that have oddities: <code>bedrooms</code>, and <code>extra_people</code>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for visualization, removing the NA's is fine! </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>bthrm <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bathrooms)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bathrooms)) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of bathrooms"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>beds <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bedrooms)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bedrooms)) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Bedrooms"</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(bthrm, beds, <span class="at">ncol =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>It seems like both number of bathrooms and are skewed to the right (large positive skew value). They don’t really scream anything odd to me for now. We need IQR for these two.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>revs <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(number_of_reviews)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> number_of_reviews)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Reviews"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>minight <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(minimum_nights)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> minimum_nights)) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Minimum Number of Nights"</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(revs, minight, <span class="at">ncol =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>The number of reviews are very obviously exponential (logarithmic). There are a few high numbers for the minimum number of nights, but most are concentrated around the start.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(extra_people)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> extra_people)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Extra People"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>This one is the most interseting! A huge proportion are <span class="math inline">\(0\)</span>, then it looks perfectly normal, then a huge bump at <span class="math inline">\(50\)</span>, and then that <span class="math inline">\(235\)</span>, which doesn’t show up here because it’s probably just <span class="math inline">\(1\)</span> place that looks like that. Let’s now address these. I’ll start by looking at counts in each column. This will show me null values, too. I’ll decide what to do for each then.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(bathrooms) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bathrooms    n
1        1.0 6508
2        1.5  689
3        2.0  371
4         NA   69
5        0.5   67
6        3.0   37
7        2.5   34
8        0.0   33
9        4.0   10
10       5.0    6
11       8.0    5
12       3.5    3
13       7.5    1</code></pre>
</div>
</div>
<div class="blue-text">
<p>Here, for example, I see that most places have <span class="math inline">\(1\)</span> bathroom, <span class="math inline">\(1.5\)</span> and <span class="math inline">\(2\)</span>. Then null. However, there’s also <span class="math inline">\(0\)</span> in this count. So, the nulls cannot be <span class="math inline">\(0\)</span>’s. There are <span class="math inline">\(69\)</span> missing values in <code>bathrooms</code>. I won’t do anything just yet though. Because let’s consider this logically: would number of bathrooms on its own be important in determining the price? Not really. Say, if a place has <span class="math inline">\(10\)</span> bedrooms housing <span class="math inline">\(10\)</span> people but just 1 bathroom – it’s not the same as a <span class="math inline">\(1\)</span> bedroom place housing <span class="math inline">\(1\)</span> person with <span class="math inline">\(1\)</span> bathroom. Right? So, it really should be a proportion of how many people it accomodates (either the <code>accommodates</code> or <code>beds</code> columns, since they’re basically the same, check their summary stats!) to the number of bathrooms. If it’s higher than <span class="math inline">\(1.0\)</span>, then that’s good: it means each person gets at least <span class="math inline">\(1\)</span> bathroom.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bathroom_per_person =</span> <span class="fu">round</span>(bathrooms<span class="sc">/</span>accommodates, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bathroom_per_person) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bathroom_per_person    n
1                0.500 3820
2                0.250 1776
3                0.333  764
4                0.375  250
5                0.750  241
6                0.200  200
7                0.167  194
8                1.000  186
9                   NA   69
10               0.300   51
11               0.125   48
12               0.000   33
13               0.400   33
14               0.143   27
15               0.188   19
16               0.625   12
17               0.667   12
18               0.100   10
19               0.214    8
20               0.286    8
21               0.417    8
22               1.500    8
23               0.222    7
24               0.312    7
25               2.000    7
26               0.062    6
27               0.083    6
28               0.111    5
29               0.150    3
30               0.278    2
31               0.429    2
32               0.094    1
33               0.233    1
34               0.469    1
35               0.600    1
36               0.833    1
37               0.875    1
38               1.250    1
39               1.750    1
40               2.500    1
41               4.000    1
42               5.000    1</code></pre>
</div>
</div>
<div class="blue-text">
<p>The <span class="math inline">\(69\)</span> null values are preserved, as expected. I won’t print all the other counts to save space. Only the ones that give interesting results.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(extra_people) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   extra_people    n
1             0 4316
2            25  645
3            20  511
4            30  465
5            15  305
6            50  301
7            35  273
8            10  260
9            40  243
10           45   83</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(extra_people) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   extra_people n
65           58 1
66           64 1
67           81 1
68           89 1
69           99 1
70          112 1
71          125 1
72          130 1
73          175 1
74          235 1</code></pre>
</div>
</div>
<div class="blue-text">
<p>The really high number of extra people allowed are really only one-offs. The best thing to do? Don’t include this in your model! Moving on to the counts for non-numeric data.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(host_since_year) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  host_since_year    n
1            2013 2489
2            2014 2403
3            2012 1625
4            2011  664
5            2015  399
6            2010  221
7            2009   25
8            2008    7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(property_type) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     property_type    n
1        apartment 6280
2            house  711
3  bed &amp; breakfast  370
4             boat  327
5             loft   77
6            other   29
7            cabin   12
8        camper/rv   11
9            villa    8
10            dorm    2
11            yurt    2
12          chalet    1
13     earth house    1
14             hut    1
15       treehouse    1</code></pre>
</div>
</div>
<div class="blue-text">
<p>This is interesting. There is even a treehouses!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(room_type) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        room_type    n
1 entire home/apt 6305
2    private room 1482
3     shared room   46</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(host_response_time) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  host_response_time    n
1 within a few hours 2746
2     within an hour 2136
3       within a day 2036
4                n/a  732
5 a few days or more  183</code></pre>
</div>
</div>
<div class="blue-text">
<p>Here, that N/A value can be viewed as they just didn’t respond! I suggest, since it’s <span class="math inline">\(700+\)</span> rows, not to use this column in your model or, when you check the <code>host_response_rate</code>, you will notice there’s no <span class="math inline">\(0\)</span> there – which means, this “N/A” is actually <span class="math inline">\(0\)</span> or no response. Convert it and then turn <code>host_response_rate</code> to numeric, too.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">host_response_rate =</span> <span class="fu">ifelse</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>        host_response_rate <span class="sc">==</span> <span class="st">'N/A'</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        host_response_rate),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">host_response_rate =</span> <span class="fu">as.numeric</span>(host_response_rate))</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>host_response_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      n     mean        sd  min max      skew
X1 7101 0.908396 0.1519007 0.02   1 -2.127798</code></pre>
</div>
</div>
<div class="blue-text">
<p>Awesome. Now, let’s look at the outcome variable! When I did the summary statistics, I skipped over <code>price</code>. Let’s go back. The average price is <span class="math inline">\(129.01\)</span> (probably in Euro), with the median of <span class="math inline">\(109\)</span>…but the standard deviation is <span class="math inline">\(128.03\)</span>! It’s also largely skewed to the right. Let’s assume the prices are per night, because that’s how it’s presented on Airbnb. I’ll do the visualization of price now:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(price)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">25</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>I can already tell that <span class="math inline">\(9,000\)</span> euros one is an outlier! In fact, if you arrange by the <code>price</code> in descending order:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df <span class="sc">%&gt;%</span> <span class="fu">count</span>(price) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(price)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  price n
1  9000 1
2  1495 1
3  1400 1
4  1305 1
5  1000 1
6   995 1</code></pre>
</div>
</div>
<div class="blue-text">
<p>The next most expensive place is <span class="math inline">\(1,495\)</span>! Let’s see what this <span class="math inline">\(9,000\)</span> euros listing is:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(price <span class="sc">==</span> <span class="dv">9000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 31
$ host_name                   &lt;chr&gt; "alex"
$ host_since_year             &lt;int&gt; 2013
$ host_since_anniversary      &lt;chr&gt; "8/1"
$ id                          &lt;int&gt; 4405818
$ neighbourhood_cleansed      &lt;chr&gt; "westerpark"
$ city                        &lt;chr&gt; "amsterdam"
$ state                       &lt;chr&gt; "north holland"
$ zipcode                     &lt;chr&gt; "1052"
$ country                     &lt;chr&gt; "netherlands"
$ property_type               &lt;chr&gt; "apartment"
$ room_type                   &lt;chr&gt; "entire home/apt"
$ accommodates                &lt;int&gt; 2
$ bathrooms                   &lt;dbl&gt; 1
$ bedrooms                    &lt;int&gt; 1
$ beds                        &lt;int&gt; 1
$ bed_type                    &lt;chr&gt; "real bed"
$ price                       &lt;int&gt; 9000
$ extra_people                &lt;int&gt; 39
$ minimum_nights              &lt;int&gt; 3
$ host_response_time          &lt;chr&gt; "within an hour"
$ host_response_rate          &lt;dbl&gt; 1
$ number_of_reviews           &lt;int&gt; 0
$ review_scores_rating        &lt;int&gt; NA
$ review_scores_accuracy      &lt;int&gt; NA
$ review_scores_cleanliness   &lt;int&gt; NA
$ review_scores_checkin       &lt;int&gt; NA
$ review_scores_communication &lt;int&gt; NA
$ review_scores_location      &lt;int&gt; NA
$ review_scores_value         &lt;int&gt; NA
$ weighted_review_score       &lt;dbl&gt; NA
$ bathroom_per_person         &lt;dbl&gt; 0.5</code></pre>
</div>
</div>
<div class="blue-text">
<p>Ok. Alex has listed a <span class="math inline">\(1\)</span> bedroom-<span class="math inline">\(1\)</span> bathroom entire house/apartment that accommodates <span class="math inline">\(2\)</span> (with <span class="math inline">\(1\)</span> bed) for a minimum of <span class="math inline">\(3\)</span> nights (that’s a total of <span class="math inline">\(27,000\)</span> euros!) Alright, Alex is a goner tho! This is unhinged behavior!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(price <span class="sc">!=</span> <span class="dv">9000</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>price) <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      n     mean       sd median min  max     skew
X1 7832 127.8783 79.64933    109  15 1495 4.182958</code></pre>
</div>
</div>
<div class="blue-text">
<p>Much better. Now, I’ll count the number of null values in the <code>price</code> column and the reviews (since they had many in the <span class="math inline">\(6,000\)</span> but the data has <span class="math inline">\(7,000\)</span> rows).</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Number of null values in price column: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>price)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of null values in price column:  0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Number of null values in weighted review score column: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>weighted_review_score)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of null values in weighted review score column:  1697"</code></pre>
</div>
</div>
<div class="blue-text">
<p>There are no missing price values, but a lot of null review scores. Let’s see what these are. I suspect many just don’t have any reviews.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(weighted_review_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews, review_scores_rating, weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(number_of_reviews)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   number_of_reviews review_scores_rating weighted_review_score
1                  3                   NA                    NA
2                  2                   NA                    NA
3                  2                   NA                    NA
4                  2                   NA                    NA
5                  2                   NA                    NA
6                  2                   NA                    NA
7                  2                   NA                    NA
8                  2                   NA                    NA
9                  2                   NA                    NA
10                 2                   NA                    NA</code></pre>
</div>
</div>
<div class="blue-text">
<p>Ok, so not all of them have no reviews. This is bad. Let’s see how many are actually <span class="math inline">\(0\)</span> and how many are other numbers</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(weighted_review_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews, review_scores_rating, weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(number_of_reviews) <span class="sc">%&gt;%</span> <span class="fu">count</span>(number_of_reviews)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
# Groups:   number_of_reviews [4]
  number_of_reviews     n
              &lt;int&gt; &lt;int&gt;
1                 0  1623
2                 1    59
3                 2    14
4                 3     1</code></pre>
</div>
</div>
<div class="blue-text">
<p>The ones that have no reviews, I can’t really do anything about, right? The ones with more actual reviews that don’t have any value, I will drop. For the others, since the review scores were’nt that badly off, I can just replace the scores with the median.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      n     mean       sd   median      min      max     skew
X1 6135 93.38631 3.497979 94.45192 62.86166 99.58903 -1.76216</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="ot">&lt;-</span> df </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weighted_review_score_nona =</span> <span class="fu">ifelse</span>(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(weighted_review_score),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">median</span>(weighted_review_score, <span class="at">na.rm =</span> T), <span class="co"># if it's NA, replace it with median </span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    weighted_review_score  <span class="co"># otherwise do nothing </span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>weighted_review_score_nona) <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      n    mean      sd   median      min      max      skew
X1 7832 93.6172 3.12683 94.45192 62.86166 99.58903 -2.145852</code></pre>
</div>
</div>
<div class="blue-text">
<p>See how close this is to the original data? We should be good to go now! Let’s go back and check everything again. Here are the columns I’m interested in for the modeling:</p>
<ul>
<li><code>host_since_year</code> framed as host’s experience</li>
<li><code>accommodates</code></li>
<li><code>bathroom_per_person</code></li>
<li><code>weighted_review_score_nona</code></li>
<li><code>property_type</code></li>
<li><code>host_response_rate</code></li>
</ul>
<p>Let’s focus on these and see if there are any outliers. First, I’ll change the <code>host_since_year</code> to be the experience of the host.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">host_years =</span> <span class="dv">2025</span> <span class="sc">-</span> host_since_year</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>find_iqr <span class="ot">&lt;-</span> <span class="cf">function</span>(col){</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">quantile</span>(col, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    q1 <span class="ot">&lt;-</span> q[[<span class="dv">1</span>]] </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    q3 <span class="ot">&lt;-</span> q[[<span class="dv">2</span>]] </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    iqr <span class="ot">=</span> q3 <span class="sc">-</span> q1</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="ot">=</span> q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> iqr</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="ot">=</span> q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> iqr</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    outliers <span class="ot">&lt;-</span> col[col <span class="sc">&lt;</span> lower_bound <span class="sc">|</span> col <span class="sc">&gt;</span> upper_bound]</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(outliers)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>host_years))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>accommodates))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  8 10  9 16 12 15 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>bathroom_per_person))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.00   NA 2.00 1.50 4.00 1.25 2.50 1.75 5.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>weighted_review_score_nona))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 84.72372 87.93218 78.60219 74.88355 84.45192 86.44743 86.22681 87.22022
  [9] 85.33461 99.58903 85.61074 86.12734 85.79660 82.62320 85.36589 88.02295
 [17] 85.19017 81.35671 86.29606 86.81581 87.44664 86.06468 86.73798 87.40656
 [25] 84.44743 86.12325 82.77965 84.84684 84.22566 83.80929 86.31377 82.92848
 [33] 86.61186 87.42282 87.45362 86.67115 78.29701 85.83423 79.77109 86.67307
 [41] 87.18424 86.97781 87.99098 85.87286 87.27104 83.90088 86.53205 88.03953
 [49] 87.89262 87.42853 85.08631 87.41239 84.16947 80.82396 86.74773 83.81593
 [57] 70.11298 62.86166 87.33654 82.58557 83.20398 86.64406 85.71394 85.58557
 [65] 86.70599 87.93269 80.61014 87.48048 87.97939 78.33654 85.72166 87.31731
 [73] 87.85707 82.25961 87.46846 82.43515 83.67158 81.86846 83.84773 82.79447
 [81] 81.10068 85.52799 87.83557 86.46470 87.50336 81.80656 82.82191 87.70104
 [89] 85.55705 85.06846 80.95878 85.11218 87.30929 84.30128 86.98626 85.78077
 [97] 87.78525 85.55929 85.03803 85.50868 83.11410 79.58557 74.67115 83.46394
[105] 71.85683 87.72072 86.19176 87.26591 86.55623 86.69368 87.74817 86.05082
[113] 87.11410 80.46350 82.67115 84.07732 81.13070 76.30128 72.67115 66.12225
[121] 85.92692 65.47939 76.91198 79.63585 87.01976 85.66827 77.92692 81.41939
[129] 83.47939 88.09350 86.03093 87.14723 86.91947 84.58894 79.42058 87.31711
[137] 87.31112 88.05705 75.64262 85.13930 79.63461 87.28569 85.26247 87.59615
[145] 86.26398 85.50682 77.29447 79.99599 83.70619 87.66870 85.86846 82.25942
[153] 83.31887 86.94132 85.15465 84.76511 86.07905 83.45414 86.22436 85.54447
[161] 83.51113 85.94631 83.03234 86.83894 87.08557 74.67011 86.04185 86.87408
[169] 87.35968 87.22372 85.66209 87.46635 75.42223 83.23286 84.67115 82.24650
[177] 86.48949 83.15738 86.43833 87.58894 87.60697 75.90088 87.41198 84.42832
[185] 83.05021 86.34553 85.70697 85.22925 83.49241 82.01166 80.02445 85.33597
[193] 86.89598 82.26175 83.77223 81.11858 87.81312 99.55615 84.10043 78.97939
[201] 81.63461 85.37387 79.33506 74.69519 81.05891 84.46572 84.05534 84.47747
[209] 82.96794 84.95878 82.10697 85.15064 84.83413 79.35697 77.61639 87.73748
[217] 80.66771 82.05473 86.09767 71.92421 87.11247 85.13165 81.08557 82.05929
[225] 80.83894 83.92421 87.70470 81.70104 77.35158 85.73006 79.17115 83.17115
[233] 70.17115 78.52350 81.75813 86.54487 87.77345 80.74572 83.33741 81.98798
[241] 82.19368 78.10164 71.90796 86.45850</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>host_response_rate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   NA 0.40 0.69 0.61 0.64 0.42 0.65 0.67 0.56 0.50 0.25 0.30 0.20 0.33 0.60
[16] 0.58 0.57 0.63 0.35 0.46 0.55 0.11 0.53 0.31 0.47 0.43 0.68 0.44 0.21 0.52
[31] 0.62 0.24 0.66 0.41 0.38 0.54 0.29 0.59 0.14 0.39 0.34 0.45 0.02 0.09 0.12
[46] 0.10 0.49 0.18 0.23 0.05 0.37 0.51 0.28 0.19 0.48</code></pre>
</div>
</div>
<div class="blue-text">
<ul>
<li><code>host_years</code> : <span class="math inline">\(17\)</span> is the outlier, but I don’t think I will include this measure in the model anyway.</li>
<li><code>accommodates</code>: <span class="math inline">\(8, 10, 9, 16, 12, 15, 14\)</span> are outliers. Weird numbers, I’ll keep them in for now!<br>
</li>
<li><code>bathroom_per_person</code>: NA values are outliers! This is interesting.</li>
<li><code>weighted_review_score_nona</code>: this is null, so there’s none.</li>
<li><code>host_response_rate</code>: lots of values seem to be outliers…I think this is a bad column. Let’s not add it.</li>
</ul>
<p>A note here on zipcode: it probably is a good measure, but there’s a lot of typo’s in it and I’m not familiar with Amesterdam, so I won’t go there. Try to find projects that address this to get inspiration!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bathroom_per_person))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="blue-text">
<p>Now let’s figure out the relationships through visualizations and a correlation matrix.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>corM <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> <span class="fu">select</span>(host_since_year, accommodates, bathrooms, bedrooms,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    beds, price, extra_people, minimum_nights, host_response_rate, weighted_review_score_nona)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the correlation values (correlation matrix)</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>reg_corM <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>r)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co"># remove columns and rows with all NA values</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>reg_corM <span class="ot">&lt;-</span> reg_corM <span class="sc">%&gt;%</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">rowSums</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(.))</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA with 0 (optional)</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(reg_corM)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>data[<span class="fu">is.na</span>(data)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NA with 0 if needed</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>cor_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>r)   </span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>pcor_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>P) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Correlations data: </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Correlations data: \n"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(cor_values,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           host_since_year accommodates bathrooms bedrooms
host_since_year                      1.000       -0.028    -0.014    0.002
accommodates                        -0.028        1.000     0.449    0.706
bathrooms                           -0.014        0.449     1.000    0.434
bedrooms                             0.002        0.706     0.434    1.000
beds                                 0.002        0.825     0.471    0.710
price                               -0.028        0.559     0.360    0.564
extra_people                        -0.077        0.323     0.123    0.194
minimum_nights                      -0.107        0.017     0.035    0.084
host_response_rate                  -0.053        0.018     0.015   -0.007
weighted_review_score_nona          -0.027       -0.036     0.019    0.049
                             beds  price extra_people minimum_nights
host_since_year             0.002 -0.028       -0.077         -0.107
accommodates                0.825  0.559        0.323          0.017
bathrooms                   0.471  0.360        0.123          0.035
bedrooms                    0.710  0.564        0.194          0.084
beds                        1.000  0.519        0.228          0.046
price                       0.519  1.000        0.169          0.027
extra_people                0.228  0.169        1.000         -0.049
minimum_nights              0.046  0.027       -0.049          1.000
host_response_rate          0.018  0.031        0.028         -0.066
weighted_review_score_nona -0.021  0.107       -0.032          0.061
                           host_response_rate weighted_review_score_nona
host_since_year                        -0.053                     -0.027
accommodates                            0.018                     -0.036
bathrooms                               0.015                      0.019
bedrooms                               -0.007                      0.049
beds                                    0.018                     -0.021
price                                   0.031                      0.107
extra_people                            0.028                     -0.032
minimum_nights                         -0.066                      0.061
host_response_rate                      1.000                      0.054
weighted_review_score_nona              0.054                      1.000</code></pre>
</div>
</div>
<div class="blue-text">
<ul>
<li><code>bathrooms</code> and <code>accommodates</code> are correlated (<span class="math inline">\(45%\)</span>)</li>
<li><code>bedrooms</code> and <code>accommodates</code> are highly correlated (<span class="math inline">\(70%\)</span>)</li>
<li><code>beds</code> and <code>accommodates</code> are highly correlated (<span class="math inline">\(83%\)</span>)</li>
<li><code>price</code> is correlated (highly) with <code>accommodates</code>, <code>bedrooms</code>, and <code>beds</code></li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"p-values for correlations: </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "p-values for correlations: \n"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pcor_values,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           host_since_year accommodates bathrooms bedrooms
host_since_year                         NA        0.014     0.233    0.869
accommodates                         0.014           NA     0.000    0.000
bathrooms                            0.233        0.000        NA    0.000
bedrooms                             0.869        0.000     0.000       NA
beds                                 0.852        0.000     0.000    0.000
price                                0.014        0.000     0.000    0.000
extra_people                         0.000        0.000     0.000    0.000
minimum_nights                       0.000        0.133     0.002    0.000
host_response_rate                   0.000        0.124     0.195    0.558
weighted_review_score_nona           0.019        0.002     0.094    0.000
                            beds price extra_people minimum_nights
host_since_year            0.852 0.014        0.000          0.000
accommodates               0.000 0.000        0.000          0.133
bathrooms                  0.000 0.000        0.000          0.002
bedrooms                   0.000 0.000        0.000          0.000
beds                          NA 0.000        0.000          0.000
price                      0.000    NA        0.000          0.018
extra_people               0.000 0.000           NA          0.000
minimum_nights             0.000 0.018        0.000             NA
host_response_rate         0.129 0.009        0.017          0.000
weighted_review_score_nona 0.065 0.000        0.005          0.000
                           host_response_rate weighted_review_score_nona
host_since_year                         0.000                      0.019
accommodates                            0.124                      0.002
bathrooms                               0.195                      0.094
bedrooms                                0.558                      0.000
beds                                    0.129                      0.065
price                                   0.009                      0.000
extra_people                            0.017                      0.005
minimum_nights                          0.000                      0.000
host_response_rate                         NA                      0.000
weighted_review_score_nona              0.000                         NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(data,</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Heatmap of Correlation Matrix"</span>,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">display_numbers =</span> <span class="cn">TRUE</span>,  <span class="co"># Show correlation values</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,  <span class="co"># Distance metric for clustering</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,  <span class="co"># Hierarchical clustering method</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"lightgreen"</span>, <span class="st">"green"</span>))(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_years, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of years the host has been active"</span>,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Host active years"</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>There really doesn’t seem to be any relationship here. I’m not considering this in the modeling.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accommodates, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of people place accommodates"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of people place accommodates"</span>,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>There might be a subtle positive correlation here. I’ve added the guide line (blue dashed line) to show this.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of bathrooms per person"</span>,</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of bathrooms per person"</span>,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>This almost seems like it goes up then down, it’s interesting, but definitely not a linear relationship. It seems like a bell shape! Maybe a quadratic relationship?</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weighted_review_score_nona, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on weighted rating score"</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Rating score (weighted)"</span>,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>Not much to say here. Most rooms have a high score. There doesn’t seem to be much of an intersting pattern.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_response_rate, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on hosts' response rate"</span>,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Host response rate"</span>,</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>The jitter is possibly making it look more interesting, but it’s truly not! Ok, I think I’m done with the numeric visualizations. What about non-numeric columns?</p>
<ul>
<li><code>city</code></li>
<li><code>property_type</code></li>
<li><code>room_type</code></li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(city), <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on city"</span>, </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"City"</span>, </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>Ok, maybe not that interesting. Seems like Amesterdam is the most expensive, and everything else is just not… so, I’ll just group the cities together into a new column that accounts for whether or not the listing is in Amersterdam.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">isAmesterdam =</span> <span class="fu">ifelse</span>(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    city <span class="sc">==</span> <span class="st">'amsterdam'</span>,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(property_type), <span class="at">y =</span> price), <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on property type"</span>, </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Property type"</span>, </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>Cool. This also looks interseting.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(room_type), <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on room type"</span>, </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Room type"</span>, </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>There is definitely something here! Let’s make sure these values are factors. Then, start building the model with these variables:</p>
<ul>
<li><code>accommodates</code></li>
<li><code>bathroom_per_person</code> (maybe a quadratic relationship)</li>
<li><code>weighted_review_score_nona</code></li>
<li><code>isAmesterdam</code></li>
<li><code>property_type</code></li>
<li><code>room_type</code></li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcity =</span> <span class="fu">as.factor</span>(city),</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fproperty_type =</span> <span class="fu">as.factor</span>(property_type),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">froom_type =</span> <span class="fu">as.factor</span>(room_type),</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sqbathroom_per_person =</span> bathroom_per_person<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="blue-text">
<p>I will build three models, plus a null model (with no predictors) for comparison. Please try various models and read about how to pick which features to include. At this point, I’m just trying to build up a model that makes sense. I’m still not “training” anything!</p>
<p>Model 1 includes everything, model 2 drops the <code>weighted_review_score_nona</code>, and model 3 is model 1 but <code>bathroom_per_person</code> is quadratic.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>nullmodel <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> weighted_review_score_nona <span class="sc">+</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>            isAmesterdam <span class="sc">+</span> fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>            isAmesterdam <span class="sc">+</span> fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> sqbathroom_per_person <span class="sc">+</span> </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nullmodel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ 1, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-112.89  -42.89  -18.89   22.11 1367.11 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 127.8881     0.9039   141.5   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 79.64 on 7762 degrees of freedom</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ accommodates + bathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-424.14  -30.24   -8.35   19.62 1044.23 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   -200.0120    22.7246  -8.802  &lt; 2e-16 ***
accommodates                    25.6519     0.5279  48.589  &lt; 2e-16 ***
bathroom_per_person             47.0602     4.8148   9.774  &lt; 2e-16 ***
weighted_review_score_nona       2.3390     0.2331  10.033  &lt; 2e-16 ***
isAmesterdam                    14.6307     5.6962   2.569 0.010232 *  
fproperty_typebed &amp; breakfast   18.4496     3.6967   4.991 6.14e-07 ***
fproperty_typeboat               4.3135     3.7417   1.153 0.249015    
fproperty_typecabin            -16.9592    18.2139  -0.931 0.351824    
fproperty_typecamper/rv        -76.9963    19.9403  -3.861 0.000114 ***
fproperty_typechalet            15.8424    63.0119   0.251 0.801497    
fproperty_typedorm               7.3690    45.6116   0.162 0.871656    
fproperty_typeearth house      -18.6122    63.0158  -0.295 0.767729    
fproperty_typehouse             21.0339     2.5691   8.187 3.10e-16 ***
fproperty_typehut              -17.9958    63.0088  -0.286 0.775186    
fproperty_typeloft              19.0683     7.2251   2.639 0.008328 ** 
fproperty_typeother             74.2020    11.9598   6.204 5.78e-10 ***
fproperty_typetreehouse         -6.8424    63.0233  -0.109 0.913546    
fproperty_typevilla             44.0544    22.3165   1.974 0.048409 *  
fproperty_typeyurt               7.0136    44.6555   0.157 0.875202    
froom_typeprivate room         -43.0752     2.1263 -20.258  &lt; 2e-16 ***
froom_typeshared room          -70.3414     9.6578  -7.283 3.58e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 62.98 on 7742 degrees of freedom
Multiple R-squared:  0.3762,    Adjusted R-squared:  0.3746 
F-statistic: 233.4 on 20 and 7742 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ accommodates + bathroom_per_person + isAmesterdam + 
    fproperty_type + froom_type, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-423.35  -30.02   -9.45   19.98 1048.63 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    18.1457     6.6427   2.732  0.00632 ** 
accommodates                   25.3534     0.5305  47.794  &lt; 2e-16 ***
bathroom_per_person            48.7618     4.8427  10.069  &lt; 2e-16 ***
isAmesterdam                   16.2160     5.7305   2.830  0.00467 ** 
fproperty_typebed &amp; breakfast  19.0535     3.7199   5.122 3.10e-07 ***
fproperty_typeboat              6.1482     3.7612   1.635  0.10216    
fproperty_typecabin           -23.1570    18.3202  -1.264  0.20626    
fproperty_typecamper/rv       -79.3950    20.0667  -3.957 7.67e-05 ***
fproperty_typechalet           22.1858    63.4129   0.350  0.72645    
fproperty_typedorm             12.6346    45.9011   0.275  0.78313    
fproperty_typeearth house     -15.0244    63.4190  -0.237  0.81274    
fproperty_typehouse            21.9562     2.5839   8.497  &lt; 2e-16 ***
fproperty_typehut             -17.8142    63.4129  -0.281  0.77878    
fproperty_typeloft             19.3657     7.2714   2.663  0.00775 ** 
fproperty_typeother            71.0366    12.0323   5.904 3.70e-09 ***
fproperty_typetreehouse        -1.3305    63.4251  -0.021  0.98326    
fproperty_typevilla            43.4753    22.4595   1.936  0.05294 .  
fproperty_typeyurt              8.6887    44.9417   0.193  0.84670    
froom_typeprivate room        -46.6351     2.1099 -22.103  &lt; 2e-16 ***
froom_typeshared room         -75.0809     9.7081  -7.734 1.18e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 63.38 on 7743 degrees of freedom
Multiple R-squared:  0.3681,    Adjusted R-squared:  0.3665 
F-statistic: 237.4 on 19 and 7743 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ accommodates + sqbathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-403.63  -30.60   -8.27   19.82 1064.12 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   -181.2230    22.7407  -7.969 1.83e-15 ***
accommodates                    23.2313     0.4548  51.082  &lt; 2e-16 ***
sqbathroom_per_person            7.6968     1.8862   4.081 4.54e-05 ***
weighted_review_score_nona       2.4068     0.2342  10.277  &lt; 2e-16 ***
isAmesterdam                    14.4299     5.7426   2.513  0.01200 *  
fproperty_typebed &amp; breakfast   16.3103     3.7080   4.399 1.10e-05 ***
fproperty_typeboat               6.1215     3.7577   1.629  0.10335    
fproperty_typecabin            -17.3531    18.3063  -0.948  0.34319    
fproperty_typecamper/rv        -80.6721    20.0373  -4.026 5.73e-05 ***
fproperty_typechalet            13.6974    63.3311   0.216  0.82877    
fproperty_typedorm               1.4315    45.8547   0.031  0.97510    
fproperty_typeearth house      -25.0282    63.3312  -0.395  0.69271    
fproperty_typehouse             21.5713     2.5822   8.354  &lt; 2e-16 ***
fproperty_typehut              -19.9622    63.3280  -0.315  0.75260    
fproperty_typeloft              19.3047     7.2618   2.658  0.00787 ** 
fproperty_typeother             75.0056    12.0203   6.240 4.61e-10 ***
fproperty_typetreehouse        -14.4145    63.3370  -0.228  0.81998    
fproperty_typevilla             48.4867    22.4240   2.162  0.03063 *  
fproperty_typeyurt               2.7510    44.8804   0.061  0.95112    
froom_typeprivate room         -39.5277     2.0999 -18.823  &lt; 2e-16 ***
froom_typeshared room          -65.1888     9.7412  -6.692 2.35e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 63.3 on 7742 degrees of freedom
Multiple R-squared:  0.3698,    Adjusted R-squared:  0.3682 
F-statistic: 227.2 on 20 and 7742 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="blue-text">
<p>Testing which model is the best using ANOVA. The null hypothesis is that the two models are the same.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nullmodel, model1, <span class="at">test =</span> <span class="st">"Chisq"</span>) <span class="co"># you can force it to do a chi-squared test.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: price ~ 1
Model 2: price ~ accommodates + bathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type
  Res.Df      RSS Df Sum of Sq  Pr(&gt;Chi)    
1   7762 49226904                           
2   7742 30708561 20  18518343 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="blue-text">
<p>We see from the test that the null hypothesis is rejected. So, model 1 and nullmodel are different. Therefore, since model 1 actually does more explaining about the outcome, model 1 is the better model from the two. Additionaly, you can look at the Residual Sums of Squares (RSS), which is smaller for model 1 (the second row). This means model 1 is the better model.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: price ~ accommodates + bathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type
Model 2: price ~ accommodates + bathroom_per_person + isAmesterdam + fproperty_type + 
    froom_type
  Res.Df      RSS Df Sum of Sq      F    Pr(&gt;F)    
1   7742 30708561                                  
2   7743 31107798 -1   -399237 100.65 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="blue-text">
<p>Model 1 and model 2 are different. The residual sum of square in model 1 is actually lower, which means this is the better model. Now compare it with model 3. However, since both models are essentially the same – this will give us no “test results”:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model3, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: price ~ accommodates + bathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type
Model 2: price ~ accommodates + sqbathroom_per_person + weighted_review_score_nona + 
    isAmesterdam + fproperty_type + froom_type
  Res.Df      RSS Df Sum of Sq Pr(&gt;Chi)
1   7742 30708561                      
2   7742 31020768  0   -312207         </code></pre>
</div>
</div>
<div class="blue-text">
<p>Instead, we can manually calculate some metrics like AIC or the mean squared error.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model1, model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       df      AIC
model1 22 86374.81
model3 22 86453.34</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Model 1 MSE: "</span>, <span class="fu">mean</span>(<span class="fu">residuals</span>(model1)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Model 1 MSE:  3955.75949394766"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Model 3 MSE: "</span>, <span class="fu">mean</span>(<span class="fu">residuals</span>(model3)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Model 3 MSE:  3995.97679021673"</code></pre>
</div>
</div>
<div class="blue-text">
<p>The AIC values are barely any different, which really just means this addition of the squared representation didn’t improve things. In fact, the AIC went up, which is not a good thing. Similar to this, the mean square error for model 3 is actually a little higher, too. So, model 1 is the best. Let’s roll with model 1 then, and start training the data, which means, SPLIT! Before that, I will mean center the numeric variables. This is just to not get a negative intercept! (run the nonmeancentered version to see the difference).</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">accommodates_c =</span> accommodates <span class="sc">-</span> <span class="fu">mean</span>(accommodates), </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">bathroom_per_person_c =</span> bathroom_per_person <span class="sc">-</span> <span class="fu">mean</span>(bathroom_per_person),</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weighted_review_score_nona_c =</span> weighted_review_score_nona <span class="sc">-</span> <span class="fu">mean</span>(weighted_review_score_nona), </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">isAmesterdam =</span> <span class="fu">as.factor</span>(isAmesterdam)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="blue-text">
<p>Before we split the data, since there are three categorical variables, I need to check something – what if there is one value for the category? Then it might show up in the test set but not training set. Since this model cannot guess on un-seen data, I need to make sure it works with only observed data. So, let’s check for this — in fact, there are various property types that are repeated only once or twice: Chalet, Dorm, Earth House, Hut, Treehouse and Yurt. I will add these into a new category called “odd”, since they’re pretty odd!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> <span class="fu">ifelse</span>(</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>        property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'chalet'</span>, <span class="st">'dorm'</span>, <span class="st">'eart house'</span>, <span class="st">'hut'</span>, <span class="st">'treehouse'</span>, <span class="st">'yurt'</span>),</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'odd'</span>,</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>        property_type</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fproperty_type =</span> <span class="fu">as.factor</span>(property_type)</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df),</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">nrow</span>(df)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df[index, ]</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df[<span class="sc">-</span>index, ]</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a><span class="co">#df_train$fproperty_type &lt;- fct_lump_min(df_train$fproperty_type, min = 15)</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test$fproperty_type &lt;- fct_lump_min(df_test$fproperty_type, min = 15)</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="co"># another way </span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> fproperty_type) </span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>model_q3_nonmeancentered <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>model_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>model_q3_nonmeancentered2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> train)</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>model_q32 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ accommodates_c + bathroom_per_person_c + 
    weighted_review_score_nona_c + isAmesterdam + fproperty_type + 
    froom_type, data = df_train)

Residuals:
    Min      1Q  Median      3Q     Max 
-415.53  -30.32   -8.24   19.85 1005.97 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   120.1619     6.5671  18.297  &lt; 2e-16 ***
accommodates_c                 24.8483     0.5818  42.711  &lt; 2e-16 ***
bathroom_per_person_c          46.2965     5.5119   8.399  &lt; 2e-16 ***
weighted_review_score_nona_c    2.2802     0.2576   8.851  &lt; 2e-16 ***
isAmesterdam1                  13.1910     6.5408   2.017 0.043768 *  
fproperty_typebed &amp; breakfast  15.8921     4.0878   3.888 0.000102 ***
fproperty_typeboat              5.8631     4.0824   1.436 0.150997    
fproperty_typecabin           -14.9287    20.8098  -0.717 0.473163    
fproperty_typecamper/rv       -77.3646    19.7258  -3.922 8.88e-05 ***
fproperty_typeearth house     -17.2652    62.3274  -0.277 0.781784    
fproperty_typehouse            21.5839     2.8954   7.455 1.03e-13 ***
fproperty_typeloft             15.8307     7.9664   1.987 0.046946 *  
fproperty_typeodd               2.9744    23.8382   0.125 0.900707    
fproperty_typeother            88.3953    13.0323   6.783 1.29e-11 ***
fproperty_typevilla            24.5952    27.9228   0.881 0.378446    
froom_typeprivate room        -44.6429     2.3412 -19.069  &lt; 2e-16 ***
froom_typeshared room         -70.1774    10.5899  -6.627 3.72e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 62.28 on 6193 degrees of freedom
Multiple R-squared:  0.3762,    Adjusted R-squared:  0.3746 
F-statistic: 233.4 on 16 and 6193 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="blue-text">
<p>Interpretation:</p>
<ul>
<li>with each one more person accommodated, the price goes up <span class="math inline">\(24\)</span> euros</li>
<li>a one unit increase in bathroom per person adds <span class="math inline">\(46\)</span> euros to the price</li>
<li>a one unit increase in review score is associated with <span class="math inline">\(2.3\)</span> euros increase in price</li>
<li>It seems that while not significant (p-value <span class="math inline">\(&gt;0.05\)</span>), listings in Amesterdam are actually <span class="math inline">\(13\)</span> euros more expensive</li>
<li>The reference level for property type is apartment, so everything here should be compared with apartment (I’ll only go over the significant relationships):
<ul>
<li>compared to an apartment, a bed and breakfast is almost <span class="math inline">\(15\)</span> euros more expensive</li>
<li>compared to an apartment, a camper/rv is actually <span class="math inline">\(77\)</span> euros less expensive</li>
<li>compared to an apartment, a house is almost <span class="math inline">\(22\)</span> euros more expensive</li>
<li>compared to an apartment, other types of property are on average <span class="math inline">\(88.4\)</span> euros more expensive.</li>
</ul></li>
<li>The reference level for room type is the entire house or apartment, so I compare the results to this:
<ul>
<li>compared to the entire house or apartment, a private room is <span class="math inline">\(45\)</span> euros cheaper</li>
<li>compared to the entire house or apartment, a shared room is <span class="math inline">\(70\)</span> euros cheaper</li>
</ul></li>
</ul>
<p>Read this very helpful website <img src="https://towardsdatascience.com/understanding-linear-regression-output-in-r-7a9cbda948b3/.png" class="img-fluid" alt="Towards Data Science">.</p>
</div>
<section id="model-diagnositcs" class="level4" data-number="1.3.5.1">
<h4 data-number="1.3.5.1" class="anchored" data-anchor-id="model-diagnositcs"><span class="header-section-number">1.3.5.1</span> Model Diagnositcs</h4>
<div class="blue-text">
<ul>
<li>Residuals vs Fitted &gt; Are the variances of the residuals constant?</li>
<li>QQnorm &gt; Are the residuals norma?</li>
<li>How accurate is your model (MSE, Score, etc.)</li>
<li>Visualize the predictions and the line you came up with!</li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3<span class="sc">$</span>fitted.values, </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>     model_q3<span class="sc">$</span>residuals) <span class="sc">+</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
<div class="blue-text">
<p>Ok, it doesn’t look funnel shaped so this is fine-ish.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>    model_q3, </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> test </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#interval = "confidence"</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>df_test<span class="sc">$</span>predictions <span class="ot">&lt;-</span> predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((df_test<span class="sc">$</span>predictions <span class="sc">-</span> df_test<span class="sc">$</span>price)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9482.898</code></pre>
</div>
</div>
<div class="blue-text">
<p>This is your mean squared erros. The lower the better, so this is kind of high.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-88-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-88-3.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-88-4.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>The qq-plot kind of scares me if I’m being completely honest! Let’s focus on that:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model_q3<span class="sc">$</span>residuals)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model_q3<span class="sc">$</span>residuals, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="blue-text">
<p>Shapiro test’s null hypothesis is: the population is normally distributed.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid getting this: &gt; Error in shapiro.test(model_q3$residuals) : sample size must be between 3 and 5000, just sample 5,000 of the residuals </span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">sample</span>(model_q3<span class="sc">$</span>residuals, <span class="dv">5000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  sample(model_q3$residuals, 5000)
W = 0.78466, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="blue-text">
<p>Oh great! It’s not! So, now what?</p>
</div>
<div class="custom-box" style="background-color: #fff8dc; padding: 1em; border-radius: 5px;">
<p>If a parametric family can be identified, then one can often achieve greatest power by explicit modeling. This can be done through generalized linear models (15). If no parametric family is found, a transformation of either the independent or dependent variables might help. The Box-Cox transform (16) provides a model-based transformation of the dependent variable. Tukey’s ladder of transformations (17) provides a graphics-based method of choosing transformation of both the dependent and independent variables.</p>
<p>This is from: <a href="https://doi.org/10.3945/ajcn.115.113498">10.3945/ajcn.115.113498</a>.</p>
<p>This is beyond the scope of your course, so, all I need from you is to acknowledge that this assumption does not hold! That basically mean, this isn’t the best model.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3<span class="sc">$</span>residuals, <span class="at">type =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model_q3<span class="sc">$</span>residuals, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs actual prices (test)"</span>,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted price"</span>,</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Actual price"</span>) <span class="sc">+</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predictions), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model fit on test set"</span>,</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms per person"</span>,</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-better-model" class="level3" data-number="1.3.6">
<h3 data-number="1.3.6" class="anchored" data-anchor-id="a-better-model"><span class="header-section-number">1.3.6</span> A better model?</h3>
<div class="blue-text">
<p>You may be able to build a better model. Let’s see this.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>price_log <span class="ot">&lt;-</span> <span class="fu">log</span>(df<span class="sc">$</span>price)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df[index, ]</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df[<span class="sc">-</span>index, ]</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>model_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(price_log <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price_log ~ accommodates_c + bathroom_per_person_c + 
    weighted_review_score_nona_c + isAmesterdam + fproperty_type + 
    froom_type, data = df_train)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.71554 -0.23606 -0.01659  0.22513  2.69802 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    4.662339   0.039857 116.978  &lt; 2e-16 ***
accommodates_c                 0.107706   0.003531  30.504  &lt; 2e-16 ***
bathroom_per_person_c         -0.032504   0.033453  -0.972  0.33126    
weighted_review_score_nona_c   0.018833   0.001563  12.046  &lt; 2e-16 ***
isAmesterdam1                  0.127547   0.039697   3.213  0.00132 ** 
fproperty_typebed &amp; breakfast  0.155172   0.024810   6.255 4.25e-10 ***
fproperty_typeboat             0.070130   0.024776   2.831  0.00466 ** 
fproperty_typecabin           -0.203979   0.126297  -1.615  0.10635    
fproperty_typecamper/rv       -1.014181   0.119718  -8.471  &lt; 2e-16 ***
fproperty_typeearth house     -0.136526   0.378272  -0.361  0.71817    
fproperty_typehouse            0.145742   0.017573   8.294  &lt; 2e-16 ***
fproperty_typeloft             0.107631   0.048349   2.226  0.02604 *  
fproperty_typeodd             -0.068965   0.144677  -0.477  0.63360    
fproperty_typeother            0.308636   0.079094   3.902 9.64e-05 ***
fproperty_typevilla            0.237284   0.169467   1.400  0.16151    
froom_typeprivate room        -0.473009   0.014209 -33.290  &lt; 2e-16 ***
froom_typeshared room         -0.777424   0.064271 -12.096  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.378 on 6193 degrees of freedom
Multiple R-squared:  0.4131,    Adjusted R-squared:  0.4116 
F-statistic: 272.4 on 16 and 6193 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log<span class="sc">$</span>fitted.values, model_log<span class="sc">$</span>residuals) <span class="sc">+</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>predictionsLog <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>    model_log, </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> df_test</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>df_test<span class="sc">$</span>predictionsLog <span class="ot">&lt;-</span> predictionsLog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((df_test<span class="sc">$</span>predictionsLog <span class="sc">-</span> df_test<span class="sc">$</span>price_log)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1434734</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-99-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-99-3.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-99-4.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model_log<span class="sc">$</span>residuals)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model_log<span class="sc">$</span>residuals, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">sample</span>(model_log<span class="sc">$</span>residuals, <span class="dv">5000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  sample(model_log$residuals, 5000)
W = 0.971, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log<span class="sc">$</span>residuals, <span class="at">type =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model_log<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> predictionsLog, <span class="at">y =</span> price_log)) <span class="sc">+</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs actual prices (test), log model"</span>,</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted price (log)"</span>,</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Actual price (log)"</span>) <span class="sc">+</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price_log)) <span class="sc">+</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predictionsLog), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model fit on test set (log)"</span>,</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms per person (log)"</span>,</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="solution_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>

<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb183" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "PR2-Solution"</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Yekta Amirkhalili"</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "today"</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Table of Contents"</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 6</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 4</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="co">    math:</span></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a><span class="co">      engine: mathjax</span></span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a><span class="co">    self-contained: false</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a><span class="co">    execute:</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a><span class="co">      eval: true </span></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a><span class="co">      echo: true</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a><span class="co">      warning: false</span></span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a><span class="co">      message: false</span></span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a><span class="co">      error: false</span></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a><span class="co">      results: 'asis'</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a><span class="fu">.quarto-title</span> h1<span class="fu">.title</span> {</span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">rem</span><span class="op">;</span> </span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>h2{</span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.2</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span><span class="fu">rgba(</span><span class="dv">128</span><span class="op">,</span> <span class="dv">170</span><span class="op">,</span> <span class="dv">156</span><span class="op">,</span> <span class="dv">0.48</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a><span class="fu">.future-idea-box</span> {</span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span> <span class="fu">var(</span><span class="va">--quarto-hl-header-color</span><span class="op">,</span> <span class="cn">#86bdab</span><span class="fu">)</span><span class="op">;</span> <span class="co">/* Uses Quarto header color variable or fallback */</span></span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f9f9fc</span><span class="op">;</span></span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a><span class="fu">.future-idea-title</span> {</span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">color</span><span class="ch">:</span> <span class="fu">var(</span><span class="va">--quarto-hl-header-color</span><span class="op">,</span><span class="fu">rgb(</span><span class="dv">111</span><span class="op">,</span> <span class="dv">172</span><span class="op">,</span> <span class="dv">152</span><span class="fu">))</span><span class="op">;</span></span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin-bottom</span><span class="ch">:</span> <span class="dv">0.5</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.1</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a><span class="fu">.blue-text</span> {</span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">color</span><span class="ch">:</span> <span class="fu">rgba(</span><span class="dv">70</span><span class="op">,</span> <span class="dv">70</span><span class="op">,</span> <span class="dv">194</span><span class="op">,</span> <span class="dv">1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- CSS CHANGES --&gt;</span></span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-58"><a href="#cb183-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-59"><a href="#cb183-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-60"><a href="#cb183-60" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introducing the page </span></span>
<span id="cb183-61"><a href="#cb183-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-62"><a href="#cb183-62" aria-hidden="true" tabindex="-1"></a>Hello and welcome. </span>
<span id="cb183-63"><a href="#cb183-63" aria-hidden="true" tabindex="-1"></a>This page is written as a solution by Yekta Amirkhalili.</span>
<span id="cb183-64"><a href="#cb183-64" aria-hidden="true" tabindex="-1"></a>I am PhD candidate at the University of Waterloo, department of Managment Science and Engineering. </span>
<span id="cb183-65"><a href="#cb183-65" aria-hidden="true" tabindex="-1"></a>In Spring 2025, I was a lecturer for MSE 253 - Probability and Statistics 2.</span>
<span id="cb183-66"><a href="#cb183-66" aria-hidden="true" tabindex="-1"></a>This is my students' final term project.</span>
<span id="cb183-67"><a href="#cb183-67" aria-hidden="true" tabindex="-1"></a>I thought it would be useful to provide a solution manual.  </span>
<span id="cb183-68"><a href="#cb183-68" aria-hidden="true" tabindex="-1"></a>All text in blue is written by me as the instructor as answer/explanation to the question.</span>
<span id="cb183-69"><a href="#cb183-69" aria-hidden="true" tabindex="-1"></a>The question body is in black. </span>
<span id="cb183-70"><a href="#cb183-70" aria-hidden="true" tabindex="-1"></a>The main point of this document is to be used for learning. </span>
<span id="cb183-71"><a href="#cb183-71" aria-hidden="true" tabindex="-1"></a>It's not really a portfolio project example, the focus really is to teach. </span>
<span id="cb183-72"><a href="#cb183-72" aria-hidden="true" tabindex="-1"></a>Feel free to try and solve the questions on your own and check with my answers. </span>
<span id="cb183-73"><a href="#cb183-73" aria-hidden="true" tabindex="-1"></a>I hope this is useful and you learn from it. </span>
<span id="cb183-74"><a href="#cb183-74" aria-hidden="true" tabindex="-1"></a>I've also included a section to show you how I would use AI (chatGPT in this case) for coding or data analysis questions. </span>
<span id="cb183-75"><a href="#cb183-75" aria-hidden="true" tabindex="-1"></a>Always cite it when you use it, and make sure its answer actually make sense! </span>
<span id="cb183-76"><a href="#cb183-76" aria-hidden="true" tabindex="-1"></a>The code is written in **R**. </span>
<span id="cb183-77"><a href="#cb183-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-78"><a href="#cb183-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-79"><a href="#cb183-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mini-Project 1: Hypothesis Testing [30p]</span></span>
<span id="cb183-80"><a href="#cb183-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-81"><a href="#cb183-81" aria-hidden="true" tabindex="-1"></a>The following R libraries are used:</span>
<span id="cb183-84"><a href="#cb183-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-85"><a href="#cb183-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true </span></span>
<span id="cb183-86"><a href="#cb183-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb183-87"><a href="#cb183-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb183-88"><a href="#cb183-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb183-89"><a href="#cb183-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb183-90"><a href="#cb183-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb183-91"><a href="#cb183-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb183-92"><a href="#cb183-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb183-93"><a href="#cb183-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb183-94"><a href="#cb183-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb183-95"><a href="#cb183-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb183-96"><a href="#cb183-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb183-97"><a href="#cb183-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-98"><a href="#cb183-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-99"><a href="#cb183-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-100"><a href="#cb183-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-101"><a href="#cb183-101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportion Test</span></span>
<span id="cb183-102"><a href="#cb183-102" aria-hidden="true" tabindex="-1"></a>A survey finds that 60% of users prefer using mobile apps over desktop websites for booking appointments. </span>
<span id="cb183-103"><a href="#cb183-103" aria-hidden="true" tabindex="-1"></a>Your company believes the proportion is different in your city.</span>
<span id="cb183-104"><a href="#cb183-104" aria-hidden="true" tabindex="-1"></a>Use the <span class="in">`PRJ2_MP1_PT.csv`</span> dataset to test whether the local preference differs from the national figure.</span>
<span id="cb183-105"><a href="#cb183-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-106"><a href="#cb183-106" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-107"><a href="#cb183-107" aria-hidden="true" tabindex="-1"></a>I will use a one-sample z-test for proportions to test the hypothesis. </span>
<span id="cb183-108"><a href="#cb183-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-109"><a href="#cb183-109" aria-hidden="true" tabindex="-1"></a>Summarizing question's information: </span>
<span id="cb183-110"><a href="#cb183-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-111"><a href="#cb183-111" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>proportion of users who prefer apps over desktop websites is 60/100. </span>
<span id="cb183-112"><a href="#cb183-112" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>I have data from my city. </span>
<span id="cb183-113"><a href="#cb183-113" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Is the proportion I have in my city different from the 60% national figure?</span>
<span id="cb183-114"><a href="#cb183-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-115"><a href="#cb183-115" aria-hidden="true" tabindex="-1"></a>Mathamtically, that is: </span>
<span id="cb183-116"><a href="#cb183-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-117"><a href="#cb183-117" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-118"><a href="#cb183-118" aria-hidden="true" tabindex="-1"></a>H_0: p = 0.6</span>
<span id="cb183-119"><a href="#cb183-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-120"><a href="#cb183-120" aria-hidden="true" tabindex="-1"></a>vs </span>
<span id="cb183-121"><a href="#cb183-121" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-122"><a href="#cb183-122" aria-hidden="true" tabindex="-1"></a>H_a: p \neq 0.6</span>
<span id="cb183-123"><a href="#cb183-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-124"><a href="#cb183-124" aria-hidden="true" tabindex="-1"></a>Where $p$ is the proportion of users in my city who prefer apps over desktop websites.</span>
<span id="cb183-125"><a href="#cb183-125" aria-hidden="true" tabindex="-1"></a>Since significance level is not given, I will use the default of 0.05.</span>
<span id="cb183-126"><a href="#cb183-126" aria-hidden="true" tabindex="-1"></a>The test statistic is calculated as follows:</span>
<span id="cb183-127"><a href="#cb183-127" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-128"><a href="#cb183-128" aria-hidden="true" tabindex="-1"></a>z = \frac{\hat{p} - p_0}{\sqrt{\frac{p_0(1 - p_0)}{n}}}</span>
<span id="cb183-129"><a href="#cb183-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-130"><a href="#cb183-130" aria-hidden="true" tabindex="-1"></a>where $\hat{p}$ is the sample proportion, $p_0$ is the population proportion, and $n$ is the sample size.</span>
<span id="cb183-131"><a href="#cb183-131" aria-hidden="true" tabindex="-1"></a>The critical region for a two-tailed test at the 0.05 significance level is $|z| &gt; z_{\alpha/2} = 1.96$. </span>
<span id="cb183-132"><a href="#cb183-132" aria-hidden="true" tabindex="-1"></a>Chapter 10, Example 10.9 and 10.10 would be helpful. </span>
<span id="cb183-133"><a href="#cb183-133" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-134"><a href="#cb183-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-137"><a href="#cb183-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-138"><a href="#cb183-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb183-139"><a href="#cb183-139" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_PT.csv"</span>)</span>
<span id="cb183-140"><a href="#cb183-140" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df1)</span>
<span id="cb183-141"><a href="#cb183-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-142"><a href="#cb183-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-143"><a href="#cb183-143" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-144"><a href="#cb183-144" aria-hidden="true" tabindex="-1"></a>Let's summarize the data to see how many of each we have: </span>
<span id="cb183-145"><a href="#cb183-145" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-148"><a href="#cb183-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-149"><a href="#cb183-149" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span></span>
<span id="cb183-150"><a href="#cb183-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb183-151"><a href="#cb183-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb183-152"><a href="#cb183-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb183-153"><a href="#cb183-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-154"><a href="#cb183-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-155"><a href="#cb183-155" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-156"><a href="#cb183-156" aria-hidden="true" tabindex="-1"></a>Add proportion to this: </span>
<span id="cb183-157"><a href="#cb183-157" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-160"><a href="#cb183-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-161"><a href="#cb183-161" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span></span>
<span id="cb183-162"><a href="#cb183-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb183-163"><a href="#cb183-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Preference) <span class="sc">%&gt;%</span> </span>
<span id="cb183-164"><a href="#cb183-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb183-165"><a href="#cb183-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb183-166"><a href="#cb183-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb183-167"><a href="#cb183-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-168"><a href="#cb183-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-169"><a href="#cb183-169" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-170"><a href="#cb183-170" aria-hidden="true" tabindex="-1"></a>Already looks kind of close to 60%, but also not really depending on who you ask (52%) - so which is it? </span>
<span id="cb183-171"><a href="#cb183-171" aria-hidden="true" tabindex="-1"></a>You can either calculate the z value and compare it to the critical value, or use the <span class="in">`prop.test`</span> function in R.</span>
<span id="cb183-172"><a href="#cb183-172" aria-hidden="true" tabindex="-1"></a>This test takes in the number of successes (in this case, the number of users who prefer mobile apps), the total number of observations, the hypothesized proportion, and the alternative hypothesis's one tailed or two-tailedness.</span>
<span id="cb183-173"><a href="#cb183-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-174"><a href="#cb183-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-177"><a href="#cb183-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-178"><a href="#cb183-178" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(</span>
<span id="cb183-179"><a href="#cb183-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sum</span>(df1<span class="sc">$</span>Preference <span class="sc">==</span> <span class="st">"Mobile App"</span>),</span>
<span id="cb183-180"><a href="#cb183-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(df1),</span>
<span id="cb183-181"><a href="#cb183-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.60</span>,</span>
<span id="cb183-182"><a href="#cb183-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb183-183"><a href="#cb183-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">correct =</span> <span class="cn">FALSE</span> <span class="co"># optional </span></span>
<span id="cb183-184"><a href="#cb183-184" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-185"><a href="#cb183-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-186"><a href="#cb183-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-187"><a href="#cb183-187" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-188"><a href="#cb183-188" aria-hidden="true" tabindex="-1"></a>The p-value is quite small, so we reject the null hypothesis.</span>
<span id="cb183-189"><a href="#cb183-189" aria-hidden="true" tabindex="-1"></a>The null hypothesis was that the proportion of users who prefer mobile apps is 60%, and we found that it is significantly different from this value.</span>
<span id="cb183-190"><a href="#cb183-190" aria-hidden="true" tabindex="-1"></a>The 95% confidence interval for the proportion of users who prefer mobile apps is (0.42, 0.54), which does not include 0.6.</span>
<span id="cb183-191"><a href="#cb183-191" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-192"><a href="#cb183-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-193"><a href="#cb183-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Difference in Means  </span></span>
<span id="cb183-194"><a href="#cb183-194" aria-hidden="true" tabindex="-1"></a>Two customer service strategies were implemented in your company.</span>
<span id="cb183-195"><a href="#cb183-195" aria-hidden="true" tabindex="-1"></a>The customer satisfaction scores are collected and saved in <span class="in">`PRJ2_MP1_DM.csv`</span>. </span>
<span id="cb183-196"><a href="#cb183-196" aria-hidden="true" tabindex="-1"></a>Test whether the mean satisfaction differs significantly between the two strategies.</span>
<span id="cb183-197"><a href="#cb183-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-198"><a href="#cb183-198" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-199"><a href="#cb183-199" aria-hidden="true" tabindex="-1"></a>I will use a two-sample t-test to test the difference in means between the two customer service strategies.</span>
<span id="cb183-200"><a href="#cb183-200" aria-hidden="true" tabindex="-1"></a>The hypotheses are as follows:</span>
<span id="cb183-201"><a href="#cb183-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-202"><a href="#cb183-202" aria-hidden="true" tabindex="-1"></a>H_0: \mu_1 - \mu_2 = 0</span>
<span id="cb183-203"><a href="#cb183-203" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-204"><a href="#cb183-204" aria-hidden="true" tabindex="-1"></a>vs</span>
<span id="cb183-205"><a href="#cb183-205" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-206"><a href="#cb183-206" aria-hidden="true" tabindex="-1"></a>H_a: \mu_1 - \mu_2 \neq 0</span>
<span id="cb183-207"><a href="#cb183-207" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-208"><a href="#cb183-208" aria-hidden="true" tabindex="-1"></a>Where $\mu_1$ is the mean satisfaction score for strategy 1 and $\mu_2$ is the mean satisfaction score for strategy 2.</span>
<span id="cb183-209"><a href="#cb183-209" aria-hidden="true" tabindex="-1"></a>The significance level is not given, so I will use the default of 0.05.</span>
<span id="cb183-210"><a href="#cb183-210" aria-hidden="true" tabindex="-1"></a>The test statistic is calculated based on chapter 10.5 of Walpole book.</span>
<span id="cb183-211"><a href="#cb183-211" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-212"><a href="#cb183-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-213"><a href="#cb183-213" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-214"><a href="#cb183-214" aria-hidden="true" tabindex="-1"></a>Let's first look at the data and see the difference between the two strategies.</span>
<span id="cb183-215"><a href="#cb183-215" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-216"><a href="#cb183-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-219"><a href="#cb183-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-220"><a href="#cb183-220" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_DM.csv"</span>)</span>
<span id="cb183-221"><a href="#cb183-221" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df2)</span>
<span id="cb183-222"><a href="#cb183-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-223"><a href="#cb183-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-226"><a href="#cb183-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-227"><a href="#cb183-227" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb183-228"><a href="#cb183-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">stg1_mean =</span> <span class="fu">mean</span>(strategy1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb183-229"><a href="#cb183-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">stg2_mean =</span> <span class="fu">mean</span>(strategy2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-230"><a href="#cb183-230" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-231"><a href="#cb183-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-232"><a href="#cb183-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-233"><a href="#cb183-233" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-234"><a href="#cb183-234" aria-hidden="true" tabindex="-1"></a>It seems that the mean satisfaction score for strategy 1 is much lower than for strategy 2. But, is it significantly different?</span>
<span id="cb183-235"><a href="#cb183-235" aria-hidden="true" tabindex="-1"></a>Let's see the tests for the cases where: </span>
<span id="cb183-236"><a href="#cb183-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-237"><a href="#cb183-237" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Variances are known or unknown and equal</span>
<span id="cb183-238"><a href="#cb183-238" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Variances are unknown and unequal</span>
<span id="cb183-239"><a href="#cb183-239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-240"><a href="#cb183-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-243"><a href="#cb183-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-244"><a href="#cb183-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Variances are known or unknown and equal</span></span>
<span id="cb183-245"><a href="#cb183-245" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-246"><a href="#cb183-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>     </span>
<span id="cb183-247"><a href="#cb183-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-248"><a href="#cb183-248" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb183-249"><a href="#cb183-249" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-250"><a href="#cb183-250" aria-hidden="true" tabindex="-1"></a>Since the p-value is less than 0.05, we reject the null hypothesis and conclude that there is a significant difference in mean satisfaction scores between the two strategies.</span>
<span id="cb183-251"><a href="#cb183-251" aria-hidden="true" tabindex="-1"></a>That is, $\mu_1 - \mu_2 \neq 0$.</span>
<span id="cb183-252"><a href="#cb183-252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-253"><a href="#cb183-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-254"><a href="#cb183-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-257"><a href="#cb183-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-258"><a href="#cb183-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Variances are unknown and unequal</span></span>
<span id="cb183-259"><a href="#cb183-259" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-260"><a href="#cb183-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-261"><a href="#cb183-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-262"><a href="#cb183-262" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-263"><a href="#cb183-263" aria-hidden="true" tabindex="-1"></a>Similarly, if variances were unknown and unequal, we would still reject the null hypothesis.</span>
<span id="cb183-264"><a href="#cb183-264" aria-hidden="true" tabindex="-1"></a>Let's see if we can say something about the variances: </span>
<span id="cb183-265"><a href="#cb183-265" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-266"><a href="#cb183-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-269"><a href="#cb183-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-270"><a href="#cb183-270" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(df2<span class="sc">$</span>strategy1, df2<span class="sc">$</span>strategy2)</span>
<span id="cb183-271"><a href="#cb183-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-272"><a href="#cb183-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-273"><a href="#cb183-273" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb183-274"><a href="#cb183-274" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-275"><a href="#cb183-275" aria-hidden="true" tabindex="-1"></a>Looks like variances are not equal, so we should use the second t-test result.</span>
<span id="cb183-276"><a href="#cb183-276" aria-hidden="true" tabindex="-1"></a>Another way to check means (and variance) between the two groups is using visualizations (but much less formal):</span>
<span id="cb183-277"><a href="#cb183-277" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-278"><a href="#cb183-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-281"><a href="#cb183-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-282"><a href="#cb183-282" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span></span>
<span id="cb183-283"><a href="#cb183-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb183-284"><a href="#cb183-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(strategy1, strategy2), </span>
<span id="cb183-285"><a href="#cb183-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"strategyName"</span>, </span>
<span id="cb183-286"><a href="#cb183-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"strategySatisfaction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb183-287"><a href="#cb183-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>strategyName, <span class="at">y=</span>strategySatisfaction)) <span class="sc">+</span> </span>
<span id="cb183-288"><a href="#cb183-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb183-289"><a href="#cb183-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Strategy"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Satisfaction"</span>) <span class="sc">+</span> </span>
<span id="cb183-290"><a href="#cb183-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb183-291"><a href="#cb183-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-292"><a href="#cb183-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-293"><a href="#cb183-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-294"><a href="#cb183-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variance Test </span></span>
<span id="cb183-295"><a href="#cb183-295" aria-hidden="true" tabindex="-1"></a>You are analyzing consistency in delivery times between two delivery partners.</span>
<span id="cb183-296"><a href="#cb183-296" aria-hidden="true" tabindex="-1"></a>The dataset is available in <span class="in">`PRJ2_MP1_VT.csv`</span>.</span>
<span id="cb183-297"><a href="#cb183-297" aria-hidden="true" tabindex="-1"></a>Test whether their delivery time variances are equal.</span>
<span id="cb183-298"><a href="#cb183-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-299"><a href="#cb183-299" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-300"><a href="#cb183-300" aria-hidden="true" tabindex="-1"></a>All tests are based on Walpole's book, chapter 10.10. </span>
<span id="cb183-301"><a href="#cb183-301" aria-hidden="true" tabindex="-1"></a>We want to test the following hypotheses:</span>
<span id="cb183-302"><a href="#cb183-302" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-303"><a href="#cb183-303" aria-hidden="true" tabindex="-1"></a>H_0: \sigma_1^2 = \sigma_2^2</span>
<span id="cb183-304"><a href="#cb183-304" aria-hidden="true" tabindex="-1"></a>$$          </span>
<span id="cb183-305"><a href="#cb183-305" aria-hidden="true" tabindex="-1"></a>vs</span>
<span id="cb183-306"><a href="#cb183-306" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-307"><a href="#cb183-307" aria-hidden="true" tabindex="-1"></a>H_a: \sigma_1^2 \neq \sigma_2^2</span>
<span id="cb183-308"><a href="#cb183-308" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-309"><a href="#cb183-309" aria-hidden="true" tabindex="-1"></a>Where $\sigma_1^2$ is the variance of delivery times for partner 1 and $\sigma_2^2$ is the variance for partner 2.  </span>
<span id="cb183-310"><a href="#cb183-310" aria-hidden="true" tabindex="-1"></a>We do have to assume the two samples are independent.</span>
<span id="cb183-311"><a href="#cb183-311" aria-hidden="true" tabindex="-1"></a>Since the significance level is not given, I will use the default of 0.05.</span>
<span id="cb183-312"><a href="#cb183-312" aria-hidden="true" tabindex="-1"></a>Look at example 10.13 for more details.</span>
<span id="cb183-313"><a href="#cb183-313" aria-hidden="true" tabindex="-1"></a>Let's look at the data first and check the variances:</span>
<span id="cb183-314"><a href="#cb183-314" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-315"><a href="#cb183-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-318"><a href="#cb183-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-319"><a href="#cb183-319" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP1_VT.csv"</span>)</span>
<span id="cb183-320"><a href="#cb183-320" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df3)</span>
<span id="cb183-321"><a href="#cb183-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>     </span>
<span id="cb183-322"><a href="#cb183-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-325"><a href="#cb183-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-326"><a href="#cb183-326" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(partner) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">variance =</span> <span class="fu">var</span>(delivery_time))</span>
<span id="cb183-327"><a href="#cb183-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-328"><a href="#cb183-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-329"><a href="#cb183-329" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-330"><a href="#cb183-330" aria-hidden="true" tabindex="-1"></a>So, we need to separate the data by partner and then use the <span class="in">`var.test`</span> function to test the variances.</span>
<span id="cb183-331"><a href="#cb183-331" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-332"><a href="#cb183-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-335"><a href="#cb183-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-336"><a href="#cb183-336" aria-hidden="true" tabindex="-1"></a>partner1 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(partner <span class="sc">==</span> <span class="st">"Partner1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(delivery_time)</span>
<span id="cb183-337"><a href="#cb183-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-338"><a href="#cb183-338" aria-hidden="true" tabindex="-1"></a>partner2 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(partner <span class="sc">==</span> <span class="st">"Partner2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(delivery_time)</span>
<span id="cb183-339"><a href="#cb183-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-340"><a href="#cb183-340" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(partner1, partner2)</span>
<span id="cb183-341"><a href="#cb183-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-342"><a href="#cb183-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-343"><a href="#cb183-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-344"><a href="#cb183-344" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-345"><a href="#cb183-345" aria-hidden="true" tabindex="-1"></a>The null hypothesis is that the variances are equal, and the alternative hypothesis is that they are not equal.</span>
<span id="cb183-346"><a href="#cb183-346" aria-hidden="true" tabindex="-1"></a>The p-value is 0.0001, which is less than the significance level of 0.05.</span>
<span id="cb183-347"><a href="#cb183-347" aria-hidden="true" tabindex="-1"></a>Therefore, we reject the null hypothesis and conclude that the variances of delivery times between the two partners are significantly different.</span>
<span id="cb183-348"><a href="#cb183-348" aria-hidden="true" tabindex="-1"></a>This means that one partner is more consistent than the other.</span>
<span id="cb183-349"><a href="#cb183-349" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-350"><a href="#cb183-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-351"><a href="#cb183-351" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb183-352"><a href="#cb183-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-353"><a href="#cb183-353" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mini-Project 2 [30p]</span></span>
<span id="cb183-354"><a href="#cb183-354" aria-hidden="true" tabindex="-1"></a>You work for a coffee company as a data scientist.</span>
<span id="cb183-355"><a href="#cb183-355" aria-hidden="true" tabindex="-1"></a>The company wants to find out which roasting level leads to the highest average rating from customers.</span>
<span id="cb183-356"><a href="#cb183-356" aria-hidden="true" tabindex="-1"></a>You conduct taste tests and collect scores from 50 random customers for each roast level.</span>
<span id="cb183-357"><a href="#cb183-357" aria-hidden="true" tabindex="-1"></a>The results of this is collected in the <span class="in">`PRJ2_MP2.csv`</span> file.</span>
<span id="cb183-358"><a href="#cb183-358" aria-hidden="true" tabindex="-1"></a>Write clearly the statistical question you want to answer, your methodology in answering the question and your results. </span>
<span id="cb183-359"><a href="#cb183-359" aria-hidden="true" tabindex="-1"></a>If you find that there are differences between roast levels, determine which groups differ. </span>
<span id="cb183-360"><a href="#cb183-360" aria-hidden="true" tabindex="-1"></a>Finally, complete your analysis by discussing what the findings mean practically and what you suggest to your company to do next.</span>
<span id="cb183-361"><a href="#cb183-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-362"><a href="#cb183-362" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-363"><a href="#cb183-363" aria-hidden="true" tabindex="-1"></a>The statistical question we want to answer is: "Which roasting level leads to the highest average rating from customers?"</span>
<span id="cb183-364"><a href="#cb183-364" aria-hidden="true" tabindex="-1"></a>We will use ANOVA to test whether there are significant differences in ratings between the different roast levels.</span>
<span id="cb183-365"><a href="#cb183-365" aria-hidden="true" tabindex="-1"></a>The null hypothesis is that there are no differences in ratings between the roast levels, while the alternative hypothesis is that at least one roast level has a different mean rating.</span>
<span id="cb183-366"><a href="#cb183-366" aria-hidden="true" tabindex="-1"></a>We will use a significance level of 0.05.</span>
<span id="cb183-367"><a href="#cb183-367" aria-hidden="true" tabindex="-1"></a>If we find significant differences, we will use post-hoc tests to determine which roast levels differ from each other.</span>
<span id="cb183-368"><a href="#cb183-368" aria-hidden="true" tabindex="-1"></a>Finally, we will interpret the results and provide practical recommendations to the company.</span>
<span id="cb183-369"><a href="#cb183-369" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-370"><a href="#cb183-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-373"><a href="#cb183-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-374"><a href="#cb183-374" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/PRJ2_MP2.csv"</span>)</span>
<span id="cb183-375"><a href="#cb183-375" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df4)</span>
<span id="cb183-376"><a href="#cb183-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-377"><a href="#cb183-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-380"><a href="#cb183-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-381"><a href="#cb183-381" aria-hidden="true" tabindex="-1"></a>df4 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Roast) <span class="sc">%&gt;%</span> </span>
<span id="cb183-382"><a href="#cb183-382" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb183-383"><a href="#cb183-383" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_rating =</span> <span class="fu">mean</span>(Score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb183-384"><a href="#cb183-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-385"><a href="#cb183-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-386"><a href="#cb183-386" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-387"><a href="#cb183-387" aria-hidden="true" tabindex="-1"></a>Looks like medium has the highest mean rating, but we need to test if this is statistically significant.</span>
<span id="cb183-388"><a href="#cb183-388" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-389"><a href="#cb183-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-392"><a href="#cb183-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-393"><a href="#cb183-393" aria-hidden="true" tabindex="-1"></a>anova_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(Score <span class="sc">~</span> <span class="fu">as.factor</span>(Roast), <span class="at">data =</span> df4)</span>
<span id="cb183-394"><a href="#cb183-394" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_result)</span>
<span id="cb183-395"><a href="#cb183-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-396"><a href="#cb183-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-397"><a href="#cb183-397" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-398"><a href="#cb183-398" aria-hidden="true" tabindex="-1"></a>There is a difference in means between the roast levels, as the p-value is less than 0.05.</span>
<span id="cb183-399"><a href="#cb183-399" aria-hidden="true" tabindex="-1"></a>Therefore, we know that roast level matters!</span>
<span id="cb183-400"><a href="#cb183-400" aria-hidden="true" tabindex="-1"></a>Now, we need to perform post-hoc tests to determine which roast levels differ from each other.</span>
<span id="cb183-401"><a href="#cb183-401" aria-hidden="true" tabindex="-1"></a>We will use Tukey's HSD test for this purpose.</span>
<span id="cb183-402"><a href="#cb183-402" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-403"><a href="#cb183-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-406"><a href="#cb183-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-407"><a href="#cb183-407" aria-hidden="true" tabindex="-1"></a>tukey_result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova_result)</span>
<span id="cb183-408"><a href="#cb183-408" aria-hidden="true" tabindex="-1"></a>tukey_result    </span>
<span id="cb183-409"><a href="#cb183-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-410"><a href="#cb183-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-411"><a href="#cb183-411" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-412"><a href="#cb183-412" aria-hidden="true" tabindex="-1"></a>Another way to do this: </span>
<span id="cb183-413"><a href="#cb183-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-414"><a href="#cb183-414" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Separate the data by roast level and create the covariates (go to your notes and see Indicator variables)</span>
<span id="cb183-415"><a href="#cb183-415" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-416"><a href="#cb183-416" aria-hidden="true" tabindex="-1"></a>y = \mu + \tau_1 (I(L) - I(D)) + \tau_2 (I(M) - I(D)) + \epsilon</span>
<span id="cb183-417"><a href="#cb183-417" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-418"><a href="#cb183-418" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Make pairwise comparisons between the roast levels, creating a new value from the other two (factor levels)</span>
<span id="cb183-419"><a href="#cb183-419" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Use a linear model </span>
<span id="cb183-420"><a href="#cb183-420" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Use tukey's and bonferroni </span>
<span id="cb183-421"><a href="#cb183-421" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-422"><a href="#cb183-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-425"><a href="#cb183-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-426"><a href="#cb183-426" aria-hidden="true" tabindex="-1"></a>df4<span class="sc">$</span>Roast <span class="ot">&lt;-</span> <span class="fu">factor</span>(df4<span class="sc">$</span>Roast, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Dark"</span>, <span class="st">"Light"</span>, <span class="st">"Medium"</span>))</span>
<span id="cb183-427"><a href="#cb183-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-428"><a href="#cb183-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up custom contrasts: </span></span>
<span id="cb183-429"><a href="#cb183-429" aria-hidden="true" tabindex="-1"></a><span class="co"># First column: Light vs Dark</span></span>
<span id="cb183-430"><a href="#cb183-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Second column: Medium vs Dark</span></span>
<span id="cb183-431"><a href="#cb183-431" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(df4<span class="sc">$</span>Roast) <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb183-432"><a href="#cb183-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb183-433"><a href="#cb183-433" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="co"># Dark</span></span>
<span id="cb183-434"><a href="#cb183-434" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1</span>,  <span class="dv">0</span>,  <span class="co"># Light</span></span>
<span id="cb183-435"><a href="#cb183-435" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>,  <span class="dv">1</span>   <span class="co"># Medium</span></span>
<span id="cb183-436"><a href="#cb183-436" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb183-437"><a href="#cb183-437" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb183-438"><a href="#cb183-438" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-439"><a href="#cb183-439" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(<span class="fu">contrasts</span>(df4<span class="sc">$</span>Roast)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Light_vs_Dark"</span>, <span class="st">"Medium_vs_Dark"</span>)</span>
<span id="cb183-440"><a href="#cb183-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-441"><a href="#cb183-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-442"><a href="#cb183-442" aria-hidden="true" tabindex="-1"></a>contrast_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Score <span class="sc">~</span> Roast, <span class="at">data =</span> df4)</span>
<span id="cb183-443"><a href="#cb183-443" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(contrast_model)</span>
<span id="cb183-444"><a href="#cb183-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-445"><a href="#cb183-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-446"><a href="#cb183-446" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-447"><a href="#cb183-447" aria-hidden="true" tabindex="-1"></a>From the results, we have: $\mu = 6.482$, $\tau_1 = 2.558$, and $\tau_2 = -0.490$.</span>
<span id="cb183-448"><a href="#cb183-448" aria-hidden="true" tabindex="-1"></a>We need to calculate the t-statistic: </span>
<span id="cb183-449"><a href="#cb183-449" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-450"><a href="#cb183-450" aria-hidden="true" tabindex="-1"></a>t = \frac{\hat{\tau}_i - \hat{\tau}_j}{\sqrt{2\frac{\sigma^2}{n}}}</span>
<span id="cb183-451"><a href="#cb183-451" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-452"><a href="#cb183-452" aria-hidden="true" tabindex="-1"></a>Critical values for multiple comparisons:</span>
<span id="cb183-453"><a href="#cb183-453" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-454"><a href="#cb183-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-455"><a href="#cb183-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-458"><a href="#cb183-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-459"><a href="#cb183-459" aria-hidden="true" tabindex="-1"></a>sigma_sq <span class="ot">&lt;-</span> <span class="fl">0.5037</span> <span class="co"># from contrast_model summary </span></span>
<span id="cb183-460"><a href="#cb183-460" aria-hidden="true" tabindex="-1"></a>denom <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> sigma_sq <span class="sc">/</span> <span class="dv">50</span>) <span class="co"># 50 is the number of observations per group</span></span>
<span id="cb183-461"><a href="#cb183-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-462"><a href="#cb183-462" aria-hidden="true" tabindex="-1"></a>tau_light_vs_medium <span class="ot">&lt;-</span> <span class="sc">-</span>(<span class="fl">2.55820</span> <span class="sc">-</span> <span class="fl">0.49040</span>)</span>
<span id="cb183-463"><a href="#cb183-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-464"><a href="#cb183-464" aria-hidden="true" tabindex="-1"></a>t_light_vs_dark <span class="ot">&lt;-</span> (<span class="fl">2.55820</span>) <span class="sc">/</span> denom</span>
<span id="cb183-465"><a href="#cb183-465" aria-hidden="true" tabindex="-1"></a>t_medium_vs_dark <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="fl">0.49040</span>) <span class="sc">/</span> denom</span>
<span id="cb183-466"><a href="#cb183-466" aria-hidden="true" tabindex="-1"></a>t_light_vs_medium <span class="ot">&lt;-</span> tau_light_vs_medium <span class="sc">/</span> denom </span>
<span id="cb183-467"><a href="#cb183-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-468"><a href="#cb183-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-469"><a href="#cb183-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-470"><a href="#cb183-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-471"><a href="#cb183-471" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-472"><a href="#cb183-472" aria-hidden="true" tabindex="-1"></a>Now compare these with bonferroni and tukey's critical values:</span>
<span id="cb183-473"><a href="#cb183-473" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-474"><a href="#cb183-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-477"><a href="#cb183-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-478"><a href="#cb183-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonferroni critical value</span></span>
<span id="cb183-479"><a href="#cb183-479" aria-hidden="true" tabindex="-1"></a>bonferroni_critical <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="dv">147</span>)</span>
<span id="cb183-480"><a href="#cb183-480" aria-hidden="true" tabindex="-1"></a><span class="co"># 147 is the number of observations - 3 (number of groups)</span></span>
<span id="cb183-481"><a href="#cb183-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-482"><a href="#cb183-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Tukey's critical value</span></span>
<span id="cb183-483"><a href="#cb183-483" aria-hidden="true" tabindex="-1"></a>tukey_critical <span class="ot">&lt;-</span> <span class="fu">qtukey</span>(<span class="fl">0.95</span>, <span class="dv">3</span>, <span class="dv">147</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb183-484"><a href="#cb183-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-485"><a href="#cb183-485" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"bonferonni"</span>, <span class="fu">round</span>(bonferroni_critical,<span class="dv">3</span>), <span class="st">" Tukey"</span>, <span class="fu">round</span>(tukey_critical,<span class="dv">3</span>)))</span>
<span id="cb183-486"><a href="#cb183-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-487"><a href="#cb183-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-490"><a href="#cb183-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-491"><a href="#cb183-491" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_light_vs_dark <span class="sc">&gt;</span> bonferroni_critical, <span class="st">"and "</span>, t_light_vs_dark <span class="sc">&gt;</span> tukey_critical))</span>
<span id="cb183-492"><a href="#cb183-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-493"><a href="#cb183-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-494"><a href="#cb183-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-497"><a href="#cb183-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-498"><a href="#cb183-498" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_medium_vs_dark <span class="sc">&gt;</span> bonferroni_critical, <span class="st">"and "</span>, t_medium_vs_dark <span class="sc">&gt;</span> tukey_critical))</span>
<span id="cb183-499"><a href="#cb183-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-500"><a href="#cb183-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-501"><a href="#cb183-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-504"><a href="#cb183-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-505"><a href="#cb183-505" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(t_light_vs_medium <span class="sc">&gt;</span> bonferroni_critical,<span class="st">"and "</span>, t_light_vs_medium <span class="sc">&gt;</span> tukey_critical))    </span>
<span id="cb183-506"><a href="#cb183-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-507"><a href="#cb183-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-508"><a href="#cb183-508" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-509"><a href="#cb183-509" aria-hidden="true" tabindex="-1"></a>Since if $t_{ij} &gt; t_{crit}$, then we can reject the null hypothesis that the two means are equal.</span>
<span id="cb183-510"><a href="#cb183-510" aria-hidden="true" tabindex="-1"></a>Therefore, only ones different are light vs dark. </span>
<span id="cb183-511"><a href="#cb183-511" aria-hidden="true" tabindex="-1"></a>So, $\mu_{light} \neq \mu_{dark}$.</span>
<span id="cb183-512"><a href="#cb183-512" aria-hidden="true" tabindex="-1"></a>Since these two groups are different, maybe the company should focus on improving the dark roast to match the light roast's quality so the dark roast rating isn't so low.</span>
<span id="cb183-513"><a href="#cb183-513" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-514"><a href="#cb183-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-515"><a href="#cb183-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-516"><a href="#cb183-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-517"><a href="#cb183-517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mini-Project 3: Linear Regression Analysis [40p]</span></span>
<span id="cb183-518"><a href="#cb183-518" aria-hidden="true" tabindex="-1"></a>Download the <span class="in">`PRJ2_MP3_airbnb.csv`</span> dataset either from LEARN or from <span class="co">[</span><span class="ot">Kaggle</span><span class="co">](https://www.kaggle.com/datasets/aroramahima1/amsterdam-airbnb-prices-dataset/data)</span>.</span>
<span id="cb183-519"><a href="#cb183-519" aria-hidden="true" tabindex="-1"></a>This dataset has 33 columns and $7,833$ rows of Airbnb listings from Amsterdam. </span>
<span id="cb183-520"><a href="#cb183-520" aria-hidden="true" tabindex="-1"></a>Use this dataset to predict the price of Airbnb listings in Amsterdam using linear regression. </span>
<span id="cb183-521"><a href="#cb183-521" aria-hidden="true" tabindex="-1"></a>Make sure you clean and pre-process the dataset, include exploratory data analysis, check regression assumptions, and set aside 20% of the dataset as your test data. </span>
<span id="cb183-522"><a href="#cb183-522" aria-hidden="true" tabindex="-1"></a>You do not need to include all the variables (columns) in the model, but your final prediction accuracy (as long as overfitting is not an issue) will be graded. </span>
<span id="cb183-523"><a href="#cb183-523" aria-hidden="true" tabindex="-1"></a>Include a correlation matrix with the model variables before you do the modeling. </span>
<span id="cb183-524"><a href="#cb183-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-525"><a href="#cb183-525" aria-hidden="true" tabindex="-1"></a>Make sure you can justify any variable that is included in your model (using literature or data). </span>
<span id="cb183-526"><a href="#cb183-526" aria-hidden="true" tabindex="-1"></a>Check for multi-collinearity and normality of residuals. </span>
<span id="cb183-527"><a href="#cb183-527" aria-hidden="true" tabindex="-1"></a>Most importantly, interpret the regression results: </span>
<span id="cb183-528"><a href="#cb183-528" aria-hidden="true" tabindex="-1"></a>Which predictors are significant?</span>
<span id="cb183-529"><a href="#cb183-529" aria-hidden="true" tabindex="-1"></a>What does the coefficient of each mean in real-world terms?</span>
<span id="cb183-530"><a href="#cb183-530" aria-hidden="true" tabindex="-1"></a>How good is your model? </span>
<span id="cb183-531"><a href="#cb183-531" aria-hidden="true" tabindex="-1"></a>Be sure to explain your findings in simple, real-world terms.</span>
<span id="cb183-532"><a href="#cb183-532" aria-hidden="true" tabindex="-1"></a>For example: ``Each additional bedroom increases the price by $85 on average, holding other variables constant.''</span>
<span id="cb183-533"><a href="#cb183-533" aria-hidden="true" tabindex="-1"></a>Write your regression model's mathematical formula and introduce the notation in a Table.  </span>
<span id="cb183-534"><a href="#cb183-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-535"><a href="#cb183-535" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-536"><a href="#cb183-536" aria-hidden="true" tabindex="-1"></a>Let's begin with reading the data and addressing the train and test split. </span>
<span id="cb183-537"><a href="#cb183-537" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-538"><a href="#cb183-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-539"><a href="#cb183-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-542"><a href="#cb183-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-543"><a href="#cb183-543" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PRJ2_MP3_airbnb.csv"</span>)</span>
<span id="cb183-544"><a href="#cb183-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-545"><a href="#cb183-545" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span>
<span id="cb183-546"><a href="#cb183-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-547"><a href="#cb183-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-548"><a href="#cb183-548" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-549"><a href="#cb183-549" aria-hidden="true" tabindex="-1"></a>The task is to predict the price of airbnb listing. </span>
<span id="cb183-550"><a href="#cb183-550" aria-hidden="true" tabindex="-1"></a>So, first thing I do is to figure out which column is my outcome variable: <span class="in">`price`</span>. </span>
<span id="cb183-551"><a href="#cb183-551" aria-hidden="true" tabindex="-1"></a>Next, it's asking me to clean the data.</span>
<span id="cb183-552"><a href="#cb183-552" aria-hidden="true" tabindex="-1"></a>This could mean anything, but a good first step is to look at the datatypes you have in the dataset to figure out a cleaning process. </span>
<span id="cb183-553"><a href="#cb183-553" aria-hidden="true" tabindex="-1"></a>For strings (character data), you may need to lower case everything so you have consistent casing and you may need to fix some typos. </span>
<span id="cb183-554"><a href="#cb183-554" aria-hidden="true" tabindex="-1"></a>For numeric data, there's more you can do: </span>
<span id="cb183-555"><a href="#cb183-555" aria-hidden="true" tabindex="-1"></a>check the summary statistics to see if there are very obvious outliers (things that don't make sense or don't look like the rest). </span>
<span id="cb183-556"><a href="#cb183-556" aria-hidden="true" tabindex="-1"></a>You can do this by looking at several things: really big numbers, really small numbers, standard deviations, mean vs median and skewness of your data. </span>
<span id="cb183-557"><a href="#cb183-557" aria-hidden="true" tabindex="-1"></a>Another way to do this is through visualizations. </span>
<span id="cb183-558"><a href="#cb183-558" aria-hidden="true" tabindex="-1"></a>From our class discussion, though, we have a solid method: calculate the IQR. </span>
<span id="cb183-559"><a href="#cb183-559" aria-hidden="true" tabindex="-1"></a>Lastly, check for null values. </span>
<span id="cb183-560"><a href="#cb183-560" aria-hidden="true" tabindex="-1"></a>If you have 100 null values in a 7,000-row dataset, it's fine to drop them.</span>
<span id="cb183-561"><a href="#cb183-561" aria-hidden="true" tabindex="-1"></a>However, anything more than 10% of your data is huge!</span>
<span id="cb183-562"><a href="#cb183-562" aria-hidden="true" tabindex="-1"></a>A better way to address null values is through logic. </span>
<span id="cb183-563"><a href="#cb183-563" aria-hidden="true" tabindex="-1"></a>Check why there are empty cells. </span>
<span id="cb183-564"><a href="#cb183-564" aria-hidden="true" tabindex="-1"></a>Is it human error or does that empty cell actually mean something? </span>
<span id="cb183-565"><a href="#cb183-565" aria-hidden="true" tabindex="-1"></a>If it's meaningful, can you fill it out? </span>
<span id="cb183-566"><a href="#cb183-566" aria-hidden="true" tabindex="-1"></a>Even if it's error, can you still fill it out? </span>
<span id="cb183-567"><a href="#cb183-567" aria-hidden="true" tabindex="-1"></a>For example, can you replace the null values with the median of the non-null entries without changing the overall distribution of the column? </span>
<span id="cb183-568"><a href="#cb183-568" aria-hidden="true" tabindex="-1"></a>We will address these first and then start the model-building. </span>
<span id="cb183-569"><a href="#cb183-569" aria-hidden="true" tabindex="-1"></a>The data analysis part of any project is often about 80% of the effort!</span>
<span id="cb183-570"><a href="#cb183-570" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-571"><a href="#cb183-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-572"><a href="#cb183-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-575"><a href="#cb183-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-576"><a href="#cb183-576" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. outcome (Y) variable is price </span></span>
<span id="cb183-577"><a href="#cb183-577" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> df<span class="sc">$</span>price </span>
<span id="cb183-578"><a href="#cb183-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-579"><a href="#cb183-579" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. clean: strings &gt; to lowercase, assume for now no typos </span></span>
<span id="cb183-580"><a href="#cb183-580" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), tolower))</span>
<span id="cb183-581"><a href="#cb183-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-582"><a href="#cb183-582" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. clean: integers &gt; check summary statistics: </span></span>
<span id="cb183-583"><a href="#cb183-583" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="fu">where</span>(is.numeric))) <span class="sc">%&gt;%</span></span>
<span id="cb183-584"><a href="#cb183-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-585"><a href="#cb183-585" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span>
<span id="cb183-586"><a href="#cb183-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-587"><a href="#cb183-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-588"><a href="#cb183-588" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-589"><a href="#cb183-589" aria-hidden="true" tabindex="-1"></a>Let's analyze the summary statistics for now. </span>
<span id="cb183-590"><a href="#cb183-590" aria-hidden="true" tabindex="-1"></a>We see already based on the counts in each variable (look at column <span class="in">`n`</span>) that there are some missing values because the numbers are not the same for everything. </span>
<span id="cb183-591"><a href="#cb183-591" aria-hidden="true" tabindex="-1"></a>There are only a few interesting columns I think that are worth looking into.</span>
<span id="cb183-592"><a href="#cb183-592" aria-hidden="true" tabindex="-1"></a>This should definitely be done based on literature and what others have done, but let's go ahead with just "intution" for now. </span>
<span id="cb183-593"><a href="#cb183-593" aria-hidden="true" tabindex="-1"></a>I don't care about <span class="in">`host_id`</span>, <span class="in">`id`</span>, <span class="in">`latitude`</span>, <span class="in">`longitude`</span>, <span class="in">`guests_included`</span>, and if we have the aggregate review rating (<span class="in">`review_scores_rating`</span>) I don't really need to have the sub-groups contirbuting to it. </span>
<span id="cb183-594"><a href="#cb183-594" aria-hidden="true" tabindex="-1"></a>Although, you may later want to focus on just one aspect of the review/rating, so let's keep these. </span>
<span id="cb183-595"><a href="#cb183-595" aria-hidden="true" tabindex="-1"></a>For the rest, let's actually get rid of these columns and re-run the analysis. </span>
<span id="cb183-596"><a href="#cb183-596" aria-hidden="true" tabindex="-1"></a>*I will keep id in, but convert it to factor -- this is because it's a good idea to have a unique identifier for things*. </span>
<span id="cb183-597"><a href="#cb183-597" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-598"><a href="#cb183-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-599"><a href="#cb183-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-602"><a href="#cb183-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-603"><a href="#cb183-603" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep a copy of the data </span></span>
<span id="cb183-604"><a href="#cb183-604" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> df</span>
<span id="cb183-605"><a href="#cb183-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-606"><a href="#cb183-606" aria-hidden="true" tabindex="-1"></a><span class="co"># drop the columns we don't need </span></span>
<span id="cb183-607"><a href="#cb183-607" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(host_id, latitude, longitude, guests_included))</span>
<span id="cb183-608"><a href="#cb183-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-609"><a href="#cb183-609" aria-hidden="true" tabindex="-1"></a><span class="co"># re-run the analysis </span></span>
<span id="cb183-610"><a href="#cb183-610" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. clean: integers &gt; check summary statistics: </span></span>
<span id="cb183-611"><a href="#cb183-611" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="fu">where</span>(is.numeric))) <span class="sc">%&gt;%</span></span>
<span id="cb183-612"><a href="#cb183-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-613"><a href="#cb183-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span>
<span id="cb183-614"><a href="#cb183-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-615"><a href="#cb183-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-616"><a href="#cb183-616" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-617"><a href="#cb183-617" aria-hidden="true" tabindex="-1"></a>Let's take a look at what this means: </span>
<span id="cb183-618"><a href="#cb183-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-619"><a href="#cb183-619" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>most hosts have been active since 2013 (median), and the SD is only 1 year so we're good there. </span>
<span id="cb183-620"><a href="#cb183-620" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>most places accomate 2-3 people (SD = 1), this makes sense too. Although, a little bit highly skewed but not super bad. A value greater than 4-5 would be huge. </span>
<span id="cb183-621"><a href="#cb183-621" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a place with 8 bathrooms! It's also highly skewed it seems, but the SD is fine. </span>
<span id="cb183-622"><a href="#cb183-622" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>again, a place with 10 bedrooms (probably the same place with the 8 bathrooms). Not as bad of a skew as the bathroom numbers.</span>
<span id="cb183-623"><a href="#cb183-623" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Number of beds should match the bedrooms, right? Unless there are rooms that have more than 1 bed in them or they're coundint a queen or king-size bed as 2 beds (allowing for 2 people to share). So, I'm not concerned here with the 16 maximum.</span>
<span id="cb183-624"><a href="#cb183-624" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Ignore price for now. </span>
<span id="cb183-625"><a href="#cb183-625" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>one of the places allows for up to 235 extra people! Is this a hotel or what?! What kind of airbnb would allow for up to 235 people?! another red flag here is the large standard deviation (larger than the mean) and the fact that the median is 0 but mean is 13. There's definitely an outlier here! </span>
<span id="cb183-626"><a href="#cb183-626" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>minimum nights is also kind of skewed, as there's at least one place that's asking for 27 nights! </span>
<span id="cb183-627"><a href="#cb183-627" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the difference between the average number of reviews ($13.83$) and the median $5$ is big, but an even bigger indication is the almost double the mean standard deviation of $25.48$! There's definitely discrepancy. I wonder, **are the ratings adjusted for this huge difference?** </span>
<span id="cb183-628"><a href="#cb183-628" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the ratings don't seem to be that odd - the mean and median are close, standard deviation makes sense, and it's not too badly skewed. I think they may have adjusted the rating based on the number of reviews. What I mean is: if a place gets 1000 reviews of 100, that's a much better place than a place with 10 reviews that got 100 and 50, for an average of 80 (don't do that math, it might not math!lol)</span>
<span id="cb183-629"><a href="#cb183-629" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>For the rest of the review scores, there's none that really stand out. </span>
<span id="cb183-630"><a href="#cb183-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-631"><a href="#cb183-631" aria-hidden="true" tabindex="-1"></a>There's unfortunately no information on the Kaggle webpage for the data that would let us know whether the number of reviews were considered in the final review score. </span>
<span id="cb183-632"><a href="#cb183-632" aria-hidden="true" tabindex="-1"></a>So, let's ask chatGPT! </span>
<span id="cb183-633"><a href="#cb183-633" aria-hidden="true" tabindex="-1"></a>Here's my prompt: </span>
<span id="cb183-634"><a href="#cb183-634" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-635"><a href="#cb183-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-636"><a href="#cb183-636" aria-hidden="true" tabindex="-1"></a>::: {.custom-box style="background-color: #fff8dc; padding: 1em; border-radius: 5px;"}</span>
<span id="cb183-637"><a href="#cb183-637" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; I'm working with the attached dataset. I see there's a huge discrepancy in the number of reviews (column: number_of_reviews), where the difference between the average number of reviews ($13.83$) and the median $5$ is big, with a standard deviation of $25.48$! There's definitely discrepancy. When I look at the review scores (review_scores_rating), I don't see anything odd. I am wondering though, are the number of reviews considered in this review_scores_rating? How can I find out if it has been? I've checked the data source but they don't mention it. </span></span>
<span id="cb183-638"><a href="#cb183-638" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb183-639"><a href="#cb183-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-640"><a href="#cb183-640" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-641"><a href="#cb183-641" aria-hidden="true" tabindex="-1"></a>Here is chatGPT (4o)'s answer: </span>
<span id="cb183-642"><a href="#cb183-642" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-643"><a href="#cb183-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-644"><a href="#cb183-644" aria-hidden="true" tabindex="-1"></a>::: {.custom-box style="background-color: #fff8dc; padding: 1em; border-radius: 5px;"}</span>
<span id="cb183-645"><a href="#cb183-645" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; I'll now calculate the correlation between number_of_reviews and review_scores_rating. That can hint if listings with more reviews tend to have higher or lower scores. </span></span>
<span id="cb183-646"><a href="#cb183-646" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The correlation between number_of_reviews and review_scores_rating is 0.005 — basically zero.</span></span>
<span id="cb183-647"><a href="#cb183-647" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **What this means:** There's no relationship between how many reviews a listing has and its review score. So, review scores are not weighted by number of reviews in this dataset. A listing with just 1 review can have the same score as one with 200 reviews.</span></span>
<span id="cb183-648"><a href="#cb183-648" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb183-649"><a href="#cb183-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-650"><a href="#cb183-650" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-651"><a href="#cb183-651" aria-hidden="true" tabindex="-1"></a>Never accept a first response, even though it seems like it makes total sense.</span>
<span id="cb183-652"><a href="#cb183-652" aria-hidden="true" tabindex="-1"></a>If not for anything, do it for your own learning. </span>
<span id="cb183-653"><a href="#cb183-653" aria-hidden="true" tabindex="-1"></a>So, let's dig in deeper, here's my follow-up prompt: </span>
<span id="cb183-654"><a href="#cb183-654" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-655"><a href="#cb183-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-656"><a href="#cb183-656" aria-hidden="true" tabindex="-1"></a>::: {.custom-box style="background-color: #fff8dc; padding: 1em; border-radius: 5px;"}</span>
<span id="cb183-657"><a href="#cb183-657" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; why would number of reviews and review score having low correlation mean that the review score was not weighted by the number of reviews? Can you tell me how it would be different if it were weighted by the number of reviews? What would be the difference then? </span></span>
<span id="cb183-658"><a href="#cb183-658" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb183-659"><a href="#cb183-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-660"><a href="#cb183-660" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-661"><a href="#cb183-661" aria-hidden="true" tabindex="-1"></a>It's answer: </span>
<span id="cb183-662"><a href="#cb183-662" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-663"><a href="#cb183-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-664"><a href="#cb183-664" aria-hidden="true" tabindex="-1"></a>::: {.custom-box style="background-color: #fff8dc; padding: 1em; border-radius: 5px;"}</span>
<span id="cb183-665"><a href="#cb183-665" aria-hidden="true" tabindex="-1"></a>Great question. Let's break this down simply:</span>
<span id="cb183-666"><a href="#cb183-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-667"><a href="#cb183-667" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔹 What correlation shows:</span></span>
<span id="cb183-668"><a href="#cb183-668" aria-hidden="true" tabindex="-1"></a>A low correlation (≈ 0) between <span class="in">`number_of_reviews`</span> and <span class="in">`review_scores_rating`</span> means:</span>
<span id="cb183-669"><a href="#cb183-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-670"><a href="#cb183-670" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Listings with more reviews don’t consistently get higher or lower scores.</span>
<span id="cb183-671"><a href="#cb183-671" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Review score doesn’t seem to depend on how many people rated it.</span>
<span id="cb183-672"><a href="#cb183-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-673"><a href="#cb183-673" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔹 What *weighted* average would mean:</span></span>
<span id="cb183-674"><a href="#cb183-674" aria-hidden="true" tabindex="-1"></a>If <span class="in">`review_scores_rating`</span> were **weighted by number of reviews**, the score you see for each listing would **reflect the total volume of reviews** behind it.</span>
<span id="cb183-675"><a href="#cb183-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-676"><a href="#cb183-676" aria-hidden="true" tabindex="-1"></a>So:</span>
<span id="cb183-677"><a href="#cb183-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-678"><a href="#cb183-678" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Listings with **more reviews** would have **more stable scores** (less likely to be extreme).</span>
<span id="cb183-679"><a href="#cb183-679" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Listings with **fewer reviews** might fluctuate more or show up with extreme scores.</span>
<span id="cb183-680"><a href="#cb183-680" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>You’d expect some relationship — maybe small, but not zero — between review count and score.</span>
<span id="cb183-681"><a href="#cb183-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-682"><a href="#cb183-682" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔹 Example:</span></span>
<span id="cb183-683"><a href="#cb183-683" aria-hidden="true" tabindex="-1"></a>Say two listings:</span>
<span id="cb183-684"><a href="#cb183-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-685"><a href="#cb183-685" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Listing A: 1 review $\rightarrow$ 100</span>
<span id="cb183-686"><a href="#cb183-686" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Listing B: 200 reviews $\rightarrow$ 95</span>
<span id="cb183-687"><a href="#cb183-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-688"><a href="#cb183-688" aria-hidden="true" tabindex="-1"></a>If the dataset just shows the raw average per listing, both are treated equally.</span>
<span id="cb183-689"><a href="#cb183-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-690"><a href="#cb183-690" aria-hidden="true" tabindex="-1"></a>But if you wanted to show an overall score **weighted across listings**, the second one should count more toward the total score, because it’s based on more opinions.</span>
<span id="cb183-691"><a href="#cb183-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-692"><a href="#cb183-692" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔹 If it were weighted:</span></span>
<span id="cb183-693"><a href="#cb183-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-694"><a href="#cb183-694" aria-hidden="true" tabindex="-1"></a>In a **weighted system**, we’d calculate an average like this across all listings:</span>
<span id="cb183-695"><a href="#cb183-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-696"><a href="#cb183-696" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-697"><a href="#cb183-697" aria-hidden="true" tabindex="-1"></a>Weighted Avg = \frac{\sum ({score}_i \times {numReviews}_i)}{\sum {numReviews}_i}</span>
<span id="cb183-698"><a href="#cb183-698" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb183-699"><a href="#cb183-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-700"><a href="#cb183-700" aria-hidden="true" tabindex="-1"></a>This is **not** what the dataset is doing.</span>
<span id="cb183-701"><a href="#cb183-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-702"><a href="#cb183-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔹 What would correlation look like if scores were weighted?</span></span>
<span id="cb183-703"><a href="#cb183-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-704"><a href="#cb183-704" aria-hidden="true" tabindex="-1"></a>If listings with more reviews had more influence on their visible rating (e.g., due to Bayesian averaging or damping), you'd expect:</span>
<span id="cb183-705"><a href="#cb183-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-706"><a href="#cb183-706" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A small positive correlation (higher review count → more “stable” or average score).</span>
<span id="cb183-707"><a href="#cb183-707" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Outliers (e.g., 1-review listings with 100) would be pushed toward the average.</span>
<span id="cb183-708"><a href="#cb183-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-709"><a href="#cb183-709" aria-hidden="true" tabindex="-1"></a>In short:</span>
<span id="cb183-710"><a href="#cb183-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-711"><a href="#cb183-711" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Low correlation** suggests that review count doesn't influence the rating shown.</span>
<span id="cb183-712"><a href="#cb183-712" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If scores were adjusted or stabilized based on review count, **you’d expect a non-zero correlation**.</span>
<span id="cb183-713"><a href="#cb183-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-714"><a href="#cb183-714" aria-hidden="true" tabindex="-1"></a>Let me know if you want to simulate what a weighted score would look like!</span>
<span id="cb183-715"><a href="#cb183-715" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-716"><a href="#cb183-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-717"><a href="#cb183-717" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-718"><a href="#cb183-718" aria-hidden="true" tabindex="-1"></a>I would not, but this was a fantastic answer! </span>
<span id="cb183-719"><a href="#cb183-719" aria-hidden="true" tabindex="-1"></a>I really hope you see how tools like chatGPT and other LLMs can be useful like this. </span>
<span id="cb183-720"><a href="#cb183-720" aria-hidden="true" tabindex="-1"></a>Let's review: </span>
<span id="cb183-721"><a href="#cb183-721" aria-hidden="true" tabindex="-1"></a>If there is no correlation between number of reviews and the review score, then that means there is no relationship between the two.</span>
<span id="cb183-722"><a href="#cb183-722" aria-hidden="true" tabindex="-1"></a>So, you can think of it as: the number of reviews played no parts in the construction of review score! </span>
<span id="cb183-723"><a href="#cb183-723" aria-hidden="true" tabindex="-1"></a>Since it's not weight adjusted, that's actually the first thing I would change here!</span>
<span id="cb183-724"><a href="#cb183-724" aria-hidden="true" tabindex="-1"></a>Then I wouldn't need both columns in a model. </span>
<span id="cb183-725"><a href="#cb183-725" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-726"><a href="#cb183-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-727"><a href="#cb183-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-730"><a href="#cb183-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-731"><a href="#cb183-731" aria-hidden="true" tabindex="-1"></a><span class="co"># find the global average score </span></span>
<span id="cb183-732"><a href="#cb183-732" aria-hidden="true" tabindex="-1"></a>global_avg <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>review_scores_rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-733"><a href="#cb183-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-734"><a href="#cb183-734" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a weight m — think of it as the minimum number of reviews assumed before we trust the score, I'll set it as the median number of reviews we have </span></span>
<span id="cb183-735"><a href="#cb183-735" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">5</span>   </span>
<span id="cb183-736"><a href="#cb183-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-737"><a href="#cb183-737" aria-hidden="true" tabindex="-1"></a><span class="co"># Now compute the weighted score per row</span></span>
<span id="cb183-738"><a href="#cb183-738" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb183-739"><a href="#cb183-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb183-740"><a href="#cb183-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_review_score =</span> (number_of_reviews <span class="sc">/</span> (number_of_reviews <span class="sc">+</span> m)) <span class="sc">*</span> review_scores_rating <span class="sc">+</span> (m <span class="sc">/</span> (number_of_reviews <span class="sc">+</span> m)) <span class="sc">*</span> global_avg</span>
<span id="cb183-741"><a href="#cb183-741" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb183-742"><a href="#cb183-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-743"><a href="#cb183-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-744"><a href="#cb183-744" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-745"><a href="#cb183-745" aria-hidden="true" tabindex="-1"></a>Before moving to the other columns, let's also visualize some of the columns that I had suspected to be highly skewed: <span class="in">`bathrooms`</span>, <span class="in">`minimum_nights`</span>, <span class="in">`number_of_reviews`</span>.</span>
<span id="cb183-746"><a href="#cb183-746" aria-hidden="true" tabindex="-1"></a>I'll also add visualizations for the columns that have oddities: <span class="in">`bedrooms`</span>, and <span class="in">`extra_people`</span>. </span>
<span id="cb183-747"><a href="#cb183-747" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-748"><a href="#cb183-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-749"><a href="#cb183-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 9}</span></span>
<span id="cb183-750"><a href="#cb183-750" aria-hidden="true" tabindex="-1"></a><span class="co"># for visualization, removing the NA's is fine! </span></span>
<span id="cb183-751"><a href="#cb183-751" aria-hidden="true" tabindex="-1"></a>bthrm <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bathrooms)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-752"><a href="#cb183-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bathrooms)) <span class="sc">+</span></span>
<span id="cb183-753"><a href="#cb183-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-754"><a href="#cb183-754" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-755"><a href="#cb183-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of bathrooms"</span>)</span>
<span id="cb183-756"><a href="#cb183-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-757"><a href="#cb183-757" aria-hidden="true" tabindex="-1"></a>beds <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bedrooms)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-758"><a href="#cb183-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bedrooms)) <span class="sc">+</span></span>
<span id="cb183-759"><a href="#cb183-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-760"><a href="#cb183-760" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-761"><a href="#cb183-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Bedrooms"</span>)</span>
<span id="cb183-762"><a href="#cb183-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-763"><a href="#cb183-763" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(bthrm, beds, <span class="at">ncol =</span> <span class="dv">2</span>) </span>
<span id="cb183-764"><a href="#cb183-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-765"><a href="#cb183-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-766"><a href="#cb183-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-767"><a href="#cb183-767" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-768"><a href="#cb183-768" aria-hidden="true" tabindex="-1"></a>It seems like both number of bathrooms and are skewed to the right (large positive skew value). </span>
<span id="cb183-769"><a href="#cb183-769" aria-hidden="true" tabindex="-1"></a>They don't really scream anything odd to me for now. </span>
<span id="cb183-770"><a href="#cb183-770" aria-hidden="true" tabindex="-1"></a>We need IQR for these two. </span>
<span id="cb183-771"><a href="#cb183-771" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-772"><a href="#cb183-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-773"><a href="#cb183-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 9}</span></span>
<span id="cb183-774"><a href="#cb183-774" aria-hidden="true" tabindex="-1"></a>revs <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(number_of_reviews)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-775"><a href="#cb183-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> number_of_reviews)) <span class="sc">+</span></span>
<span id="cb183-776"><a href="#cb183-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-777"><a href="#cb183-777" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-778"><a href="#cb183-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Reviews"</span>)</span>
<span id="cb183-779"><a href="#cb183-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-780"><a href="#cb183-780" aria-hidden="true" tabindex="-1"></a>minight <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(minimum_nights)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-781"><a href="#cb183-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> minimum_nights)) <span class="sc">+</span></span>
<span id="cb183-782"><a href="#cb183-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-783"><a href="#cb183-783" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-784"><a href="#cb183-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Minimum Number of Nights"</span>)</span>
<span id="cb183-785"><a href="#cb183-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-786"><a href="#cb183-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-787"><a href="#cb183-787" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(revs, minight, <span class="at">ncol =</span> <span class="dv">2</span>) </span>
<span id="cb183-788"><a href="#cb183-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-789"><a href="#cb183-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-790"><a href="#cb183-790" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-791"><a href="#cb183-791" aria-hidden="true" tabindex="-1"></a>The number of reviews are very obviously exponential (logarithmic). </span>
<span id="cb183-792"><a href="#cb183-792" aria-hidden="true" tabindex="-1"></a>There are a few high numbers for the minimum number of nights, but most are concentrated around the start. </span>
<span id="cb183-793"><a href="#cb183-793" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-794"><a href="#cb183-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-797"><a href="#cb183-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-798"><a href="#cb183-798" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(extra_people)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-799"><a href="#cb183-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> extra_people)) <span class="sc">+</span></span>
<span id="cb183-800"><a href="#cb183-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-801"><a href="#cb183-801" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-802"><a href="#cb183-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Extra People"</span>)</span>
<span id="cb183-803"><a href="#cb183-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-804"><a href="#cb183-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-805"><a href="#cb183-805" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-806"><a href="#cb183-806" aria-hidden="true" tabindex="-1"></a>This one is the most interseting! </span>
<span id="cb183-807"><a href="#cb183-807" aria-hidden="true" tabindex="-1"></a>A huge proportion are $0$, then it looks perfectly normal, then a huge bump at $50$, and then that $235$, which doesn't show up here because it's probably just $1$ place that looks like that. </span>
<span id="cb183-808"><a href="#cb183-808" aria-hidden="true" tabindex="-1"></a>Let's now address these.</span>
<span id="cb183-809"><a href="#cb183-809" aria-hidden="true" tabindex="-1"></a>I'll start by looking at counts in each column. </span>
<span id="cb183-810"><a href="#cb183-810" aria-hidden="true" tabindex="-1"></a>This will show me null values, too. </span>
<span id="cb183-811"><a href="#cb183-811" aria-hidden="true" tabindex="-1"></a>I'll decide what to do for each then. </span>
<span id="cb183-812"><a href="#cb183-812" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-813"><a href="#cb183-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-816"><a href="#cb183-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-817"><a href="#cb183-817" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(bathrooms) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb183-818"><a href="#cb183-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-819"><a href="#cb183-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-820"><a href="#cb183-820" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-821"><a href="#cb183-821" aria-hidden="true" tabindex="-1"></a>Here, for example, I see that most places have $1$ bathroom, $1.5$ and $2$. </span>
<span id="cb183-822"><a href="#cb183-822" aria-hidden="true" tabindex="-1"></a>Then null.</span>
<span id="cb183-823"><a href="#cb183-823" aria-hidden="true" tabindex="-1"></a>However, there's also $0$ in this count. </span>
<span id="cb183-824"><a href="#cb183-824" aria-hidden="true" tabindex="-1"></a>So, the nulls cannot be $0$'s. </span>
<span id="cb183-825"><a href="#cb183-825" aria-hidden="true" tabindex="-1"></a>There are $69$ missing values in <span class="in">`bathrooms`</span>. </span>
<span id="cb183-826"><a href="#cb183-826" aria-hidden="true" tabindex="-1"></a>I won't do anything just yet though. </span>
<span id="cb183-827"><a href="#cb183-827" aria-hidden="true" tabindex="-1"></a>Because let's consider this logically: would number of bathrooms on its own be important in determining the price? </span>
<span id="cb183-828"><a href="#cb183-828" aria-hidden="true" tabindex="-1"></a>Not really. </span>
<span id="cb183-829"><a href="#cb183-829" aria-hidden="true" tabindex="-1"></a>Say, if a place has $10$ bedrooms housing $10$ people but just 1 bathroom -- it's not the same as a $1$ bedroom place housing $1$ person with $1$ bathroom. Right? </span>
<span id="cb183-830"><a href="#cb183-830" aria-hidden="true" tabindex="-1"></a>So, it really should be a proportion of how many people it accomodates (either the <span class="in">`accommodates`</span> or <span class="in">`beds`</span> columns, since they're basically the same, check their summary stats!) to the number of bathrooms. </span>
<span id="cb183-831"><a href="#cb183-831" aria-hidden="true" tabindex="-1"></a>If it's higher than $1.0$, then that's good: it means each person gets at least $1$ bathroom. </span>
<span id="cb183-832"><a href="#cb183-832" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-833"><a href="#cb183-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-834"><a href="#cb183-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-837"><a href="#cb183-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-838"><a href="#cb183-838" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb183-839"><a href="#cb183-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bathroom_per_person =</span> <span class="fu">round</span>(bathrooms<span class="sc">/</span>accommodates, <span class="dv">3</span>))</span>
<span id="cb183-840"><a href="#cb183-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-841"><a href="#cb183-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-842"><a href="#cb183-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-845"><a href="#cb183-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-846"><a href="#cb183-846" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb183-847"><a href="#cb183-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bathroom_per_person) <span class="sc">%&gt;%</span> </span>
<span id="cb183-848"><a href="#cb183-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb183-849"><a href="#cb183-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-850"><a href="#cb183-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-851"><a href="#cb183-851" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-852"><a href="#cb183-852" aria-hidden="true" tabindex="-1"></a>The $69$ null values are preserved, as expected. </span>
<span id="cb183-853"><a href="#cb183-853" aria-hidden="true" tabindex="-1"></a>I won't print all the other counts to save space. </span>
<span id="cb183-854"><a href="#cb183-854" aria-hidden="true" tabindex="-1"></a>Only the ones that give interesting results. </span>
<span id="cb183-855"><a href="#cb183-855" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-856"><a href="#cb183-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-857"><a href="#cb183-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-860"><a href="#cb183-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-861"><a href="#cb183-861" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(extra_people) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb183-862"><a href="#cb183-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-863"><a href="#cb183-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-866"><a href="#cb183-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-867"><a href="#cb183-867" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(extra_people) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">10</span>)</span>
<span id="cb183-868"><a href="#cb183-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-869"><a href="#cb183-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-870"><a href="#cb183-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-871"><a href="#cb183-871" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-872"><a href="#cb183-872" aria-hidden="true" tabindex="-1"></a>The really high number of extra people allowed are really only one-offs. </span>
<span id="cb183-873"><a href="#cb183-873" aria-hidden="true" tabindex="-1"></a>The best thing to do? </span>
<span id="cb183-874"><a href="#cb183-874" aria-hidden="true" tabindex="-1"></a>Don't include this in your model!</span>
<span id="cb183-875"><a href="#cb183-875" aria-hidden="true" tabindex="-1"></a>Moving on to the counts for non-numeric data.</span>
<span id="cb183-876"><a href="#cb183-876" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-877"><a href="#cb183-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-880"><a href="#cb183-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-881"><a href="#cb183-881" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(host_since_year) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span>
<span id="cb183-882"><a href="#cb183-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-883"><a href="#cb183-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-886"><a href="#cb183-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-887"><a href="#cb183-887" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(property_type) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span>
<span id="cb183-888"><a href="#cb183-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-889"><a href="#cb183-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-890"><a href="#cb183-890" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-891"><a href="#cb183-891" aria-hidden="true" tabindex="-1"></a>This is interesting. </span>
<span id="cb183-892"><a href="#cb183-892" aria-hidden="true" tabindex="-1"></a>There is even a treehouses! </span>
<span id="cb183-893"><a href="#cb183-893" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-894"><a href="#cb183-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-897"><a href="#cb183-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-898"><a href="#cb183-898" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(room_type) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span>
<span id="cb183-899"><a href="#cb183-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-900"><a href="#cb183-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-903"><a href="#cb183-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-904"><a href="#cb183-904" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(host_response_time) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) </span>
<span id="cb183-905"><a href="#cb183-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-906"><a href="#cb183-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-907"><a href="#cb183-907" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-908"><a href="#cb183-908" aria-hidden="true" tabindex="-1"></a>Here, that N/A value can be viewed as they just didn't respond! </span>
<span id="cb183-909"><a href="#cb183-909" aria-hidden="true" tabindex="-1"></a>I suggest, since it's $700+$ rows, not to use this column in your model or, when you check the <span class="in">`host_response_rate`</span>, you will notice there's no $0$ there -- which means, this "N/A" is actually $0$ or no response. </span>
<span id="cb183-910"><a href="#cb183-910" aria-hidden="true" tabindex="-1"></a>Convert it and then turn <span class="in">`host_response_rate`</span> to numeric, too. </span>
<span id="cb183-911"><a href="#cb183-911" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-912"><a href="#cb183-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-915"><a href="#cb183-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-916"><a href="#cb183-916" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-917"><a href="#cb183-917" aria-hidden="true" tabindex="-1"></a>    <span class="at">host_response_rate =</span> <span class="fu">ifelse</span>(</span>
<span id="cb183-918"><a href="#cb183-918" aria-hidden="true" tabindex="-1"></a>        host_response_rate <span class="sc">==</span> <span class="st">'N/A'</span>,</span>
<span id="cb183-919"><a href="#cb183-919" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb183-920"><a href="#cb183-920" aria-hidden="true" tabindex="-1"></a>        host_response_rate),</span>
<span id="cb183-921"><a href="#cb183-921" aria-hidden="true" tabindex="-1"></a>    <span class="at">host_response_rate =</span> <span class="fu">as.numeric</span>(host_response_rate))</span>
<span id="cb183-922"><a href="#cb183-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-923"><a href="#cb183-923" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>host_response_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb183-924"><a href="#cb183-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-925"><a href="#cb183-925" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, min, max, skew)</span>
<span id="cb183-926"><a href="#cb183-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-927"><a href="#cb183-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-928"><a href="#cb183-928" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-929"><a href="#cb183-929" aria-hidden="true" tabindex="-1"></a>Awesome. </span>
<span id="cb183-930"><a href="#cb183-930" aria-hidden="true" tabindex="-1"></a>Now, let's look at the outcome variable! </span>
<span id="cb183-931"><a href="#cb183-931" aria-hidden="true" tabindex="-1"></a>When I did the summary statistics, I skipped over <span class="in">`price`</span>. </span>
<span id="cb183-932"><a href="#cb183-932" aria-hidden="true" tabindex="-1"></a>Let's go back. </span>
<span id="cb183-933"><a href="#cb183-933" aria-hidden="true" tabindex="-1"></a>The average price is $129.01$ (probably in Euro), with the median of $109$...but the standard deviation is $128.03$! It's also largely skewed to the right. </span>
<span id="cb183-934"><a href="#cb183-934" aria-hidden="true" tabindex="-1"></a>Let's assume the prices are per night, because that's how it's presented on Airbnb.</span>
<span id="cb183-935"><a href="#cb183-935" aria-hidden="true" tabindex="-1"></a>I'll do the visualization of price now: </span>
<span id="cb183-936"><a href="#cb183-936" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-937"><a href="#cb183-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-940"><a href="#cb183-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-941"><a href="#cb183-941" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(price)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-942"><a href="#cb183-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb183-943"><a href="#cb183-943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">25</span>, <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb183-944"><a href="#cb183-944" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb183-945"><a href="#cb183-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Price"</span>)</span>
<span id="cb183-946"><a href="#cb183-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-947"><a href="#cb183-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-948"><a href="#cb183-948" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-949"><a href="#cb183-949" aria-hidden="true" tabindex="-1"></a>I can already tell that $9,000$ euros one is an outlier!</span>
<span id="cb183-950"><a href="#cb183-950" aria-hidden="true" tabindex="-1"></a>In fact, if you arrange by the <span class="in">`price`</span> in descending order: </span>
<span id="cb183-951"><a href="#cb183-951" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-952"><a href="#cb183-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-955"><a href="#cb183-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-956"><a href="#cb183-956" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df <span class="sc">%&gt;%</span> <span class="fu">count</span>(price) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(price)))</span>
<span id="cb183-957"><a href="#cb183-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-958"><a href="#cb183-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-959"><a href="#cb183-959" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-960"><a href="#cb183-960" aria-hidden="true" tabindex="-1"></a>The next most expensive place is $1,495$!</span>
<span id="cb183-961"><a href="#cb183-961" aria-hidden="true" tabindex="-1"></a>Let's see what this $9,000$ euros listing is:</span>
<span id="cb183-962"><a href="#cb183-962" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-963"><a href="#cb183-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-966"><a href="#cb183-966" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-967"><a href="#cb183-967" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(price <span class="sc">==</span> <span class="dv">9000</span>))</span>
<span id="cb183-968"><a href="#cb183-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-969"><a href="#cb183-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-970"><a href="#cb183-970" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-971"><a href="#cb183-971" aria-hidden="true" tabindex="-1"></a>Ok. Alex has listed a $1$ bedroom-$1$ bathroom entire house/apartment that accommodates $2$ (with $1$ bed) for a minimum of $3$ nights (that's a total of $27,000$ euros!) </span>
<span id="cb183-972"><a href="#cb183-972" aria-hidden="true" tabindex="-1"></a>Alright, Alex is a goner tho! </span>
<span id="cb183-973"><a href="#cb183-973" aria-hidden="true" tabindex="-1"></a>This is unhinged behavior! </span>
<span id="cb183-974"><a href="#cb183-974" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-975"><a href="#cb183-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-978"><a href="#cb183-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-979"><a href="#cb183-979" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(price <span class="sc">!=</span> <span class="dv">9000</span>)</span>
<span id="cb183-980"><a href="#cb183-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-981"><a href="#cb183-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-982"><a href="#cb183-982" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>price) <span class="sc">%&gt;%</span> </span>
<span id="cb183-983"><a href="#cb183-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-984"><a href="#cb183-984" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span>
<span id="cb183-985"><a href="#cb183-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-986"><a href="#cb183-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-987"><a href="#cb183-987" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-988"><a href="#cb183-988" aria-hidden="true" tabindex="-1"></a>Much better. </span>
<span id="cb183-989"><a href="#cb183-989" aria-hidden="true" tabindex="-1"></a>Now, I'll count the number of null values in the <span class="in">`price`</span> column and the reviews (since they had many in the $6,000$ but the data has $7,000$ rows).</span>
<span id="cb183-990"><a href="#cb183-990" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-991"><a href="#cb183-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-994"><a href="#cb183-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-995"><a href="#cb183-995" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Number of null values in price column: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>price)))</span>
<span id="cb183-996"><a href="#cb183-996" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Number of null values in weighted review score column: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>weighted_review_score)))</span>
<span id="cb183-997"><a href="#cb183-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-998"><a href="#cb183-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-999"><a href="#cb183-999" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1000"><a href="#cb183-1000" aria-hidden="true" tabindex="-1"></a>There are no missing price values, but a lot of null review scores. </span>
<span id="cb183-1001"><a href="#cb183-1001" aria-hidden="true" tabindex="-1"></a>Let's see what these are. </span>
<span id="cb183-1002"><a href="#cb183-1002" aria-hidden="true" tabindex="-1"></a>I suspect many just don't have any reviews.</span>
<span id="cb183-1003"><a href="#cb183-1003" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1004"><a href="#cb183-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1007"><a href="#cb183-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1008"><a href="#cb183-1008" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(weighted_review_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1009"><a href="#cb183-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews, review_scores_rating, weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1010"><a href="#cb183-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(number_of_reviews)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb183-1011"><a href="#cb183-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1012"><a href="#cb183-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1013"><a href="#cb183-1013" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1014"><a href="#cb183-1014" aria-hidden="true" tabindex="-1"></a>Ok, so not all of them have no reviews. This is bad. </span>
<span id="cb183-1015"><a href="#cb183-1015" aria-hidden="true" tabindex="-1"></a>Let's see how many are actually $0$ and how many are other numbers</span>
<span id="cb183-1016"><a href="#cb183-1016" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1017"><a href="#cb183-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1020"><a href="#cb183-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1021"><a href="#cb183-1021" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(weighted_review_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1022"><a href="#cb183-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews, review_scores_rating, weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1023"><a href="#cb183-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(number_of_reviews) <span class="sc">%&gt;%</span> <span class="fu">count</span>(number_of_reviews)</span>
<span id="cb183-1024"><a href="#cb183-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1025"><a href="#cb183-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1026"><a href="#cb183-1026" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1027"><a href="#cb183-1027" aria-hidden="true" tabindex="-1"></a>The ones that have no reviews, I can't really do anything about, right? </span>
<span id="cb183-1028"><a href="#cb183-1028" aria-hidden="true" tabindex="-1"></a>The ones with more actual reviews that don't have any value, I will drop. </span>
<span id="cb183-1029"><a href="#cb183-1029" aria-hidden="true" tabindex="-1"></a>For the others, since the review scores were'nt that badly off, I can just replace the scores with the median. </span>
<span id="cb183-1030"><a href="#cb183-1030" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1031"><a href="#cb183-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1034"><a href="#cb183-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1035"><a href="#cb183-1035" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>weighted_review_score) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1036"><a href="#cb183-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-1037"><a href="#cb183-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span>
<span id="cb183-1038"><a href="#cb183-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1039"><a href="#cb183-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1042"><a href="#cb183-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1043"><a href="#cb183-1043" aria-hidden="true" tabindex="-1"></a>df_copy <span class="ot">&lt;-</span> df </span>
<span id="cb183-1044"><a href="#cb183-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1045"><a href="#cb183-1045" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1046"><a href="#cb183-1046" aria-hidden="true" tabindex="-1"></a>  <span class="at">weighted_review_score_nona =</span> <span class="fu">ifelse</span>(</span>
<span id="cb183-1047"><a href="#cb183-1047" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(weighted_review_score),</span>
<span id="cb183-1048"><a href="#cb183-1048" aria-hidden="true" tabindex="-1"></a>    <span class="fu">median</span>(weighted_review_score, <span class="at">na.rm =</span> T), <span class="co"># if it's NA, replace it with median </span></span>
<span id="cb183-1049"><a href="#cb183-1049" aria-hidden="true" tabindex="-1"></a>    weighted_review_score  <span class="co"># otherwise do nothing </span></span>
<span id="cb183-1050"><a href="#cb183-1050" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb183-1051"><a href="#cb183-1051" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1052"><a href="#cb183-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1053"><a href="#cb183-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1056"><a href="#cb183-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1057"><a href="#cb183-1057" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>weighted_review_score_nona) <span class="sc">%&gt;%</span> </span>
<span id="cb183-1058"><a href="#cb183-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-1059"><a href="#cb183-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, median, min, max, skew)</span>
<span id="cb183-1060"><a href="#cb183-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1061"><a href="#cb183-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1062"><a href="#cb183-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1063"><a href="#cb183-1063" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1064"><a href="#cb183-1064" aria-hidden="true" tabindex="-1"></a>See how close this is to the original data? </span>
<span id="cb183-1065"><a href="#cb183-1065" aria-hidden="true" tabindex="-1"></a>We should be good to go now! </span>
<span id="cb183-1066"><a href="#cb183-1066" aria-hidden="true" tabindex="-1"></a>Let's go back and check everything again. </span>
<span id="cb183-1067"><a href="#cb183-1067" aria-hidden="true" tabindex="-1"></a>Here are the columns I'm interested in for the modeling: </span>
<span id="cb183-1068"><a href="#cb183-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1069"><a href="#cb183-1069" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`host_since_year`</span> framed as host's experience </span>
<span id="cb183-1070"><a href="#cb183-1070" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`accommodates`</span> </span>
<span id="cb183-1071"><a href="#cb183-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`bathroom_per_person`</span></span>
<span id="cb183-1072"><a href="#cb183-1072" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`weighted_review_score_nona`</span></span>
<span id="cb183-1073"><a href="#cb183-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`property_type`</span></span>
<span id="cb183-1074"><a href="#cb183-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`host_response_rate`</span></span>
<span id="cb183-1075"><a href="#cb183-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1076"><a href="#cb183-1076" aria-hidden="true" tabindex="-1"></a>Let's focus on these and see if there are any outliers. </span>
<span id="cb183-1077"><a href="#cb183-1077" aria-hidden="true" tabindex="-1"></a>First, I'll change the <span class="in">`host_since_year`</span> to be the experience of the host. </span>
<span id="cb183-1078"><a href="#cb183-1078" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1079"><a href="#cb183-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1082"><a href="#cb183-1082" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1083"><a href="#cb183-1083" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1084"><a href="#cb183-1084" aria-hidden="true" tabindex="-1"></a>  <span class="at">host_years =</span> <span class="dv">2025</span> <span class="sc">-</span> host_since_year</span>
<span id="cb183-1085"><a href="#cb183-1085" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1086"><a href="#cb183-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1087"><a href="#cb183-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1090"><a href="#cb183-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1091"><a href="#cb183-1091" aria-hidden="true" tabindex="-1"></a>find_iqr <span class="ot">&lt;-</span> <span class="cf">function</span>(col){</span>
<span id="cb183-1092"><a href="#cb183-1092" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">quantile</span>(col, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-1093"><a href="#cb183-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1094"><a href="#cb183-1094" aria-hidden="true" tabindex="-1"></a>    q1 <span class="ot">&lt;-</span> q[[<span class="dv">1</span>]] </span>
<span id="cb183-1095"><a href="#cb183-1095" aria-hidden="true" tabindex="-1"></a>    q3 <span class="ot">&lt;-</span> q[[<span class="dv">2</span>]] </span>
<span id="cb183-1096"><a href="#cb183-1096" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-1097"><a href="#cb183-1097" aria-hidden="true" tabindex="-1"></a>    iqr <span class="ot">=</span> q3 <span class="sc">-</span> q1</span>
<span id="cb183-1098"><a href="#cb183-1098" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="ot">=</span> q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> iqr</span>
<span id="cb183-1099"><a href="#cb183-1099" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="ot">=</span> q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> iqr</span>
<span id="cb183-1100"><a href="#cb183-1100" aria-hidden="true" tabindex="-1"></a>    outliers <span class="ot">&lt;-</span> col[col <span class="sc">&lt;</span> lower_bound <span class="sc">|</span> col <span class="sc">&gt;</span> upper_bound]</span>
<span id="cb183-1101"><a href="#cb183-1101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-1102"><a href="#cb183-1102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(outliers)</span>
<span id="cb183-1103"><a href="#cb183-1103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-1104"><a href="#cb183-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1105"><a href="#cb183-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1108"><a href="#cb183-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1109"><a href="#cb183-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>host_years))</span>
<span id="cb183-1110"><a href="#cb183-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>accommodates))</span>
<span id="cb183-1111"><a href="#cb183-1111" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>bathroom_per_person))</span>
<span id="cb183-1112"><a href="#cb183-1112" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>weighted_review_score_nona))</span>
<span id="cb183-1113"><a href="#cb183-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">find_iqr</span>(df<span class="sc">$</span>host_response_rate))</span>
<span id="cb183-1114"><a href="#cb183-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1115"><a href="#cb183-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1116"><a href="#cb183-1116" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1117"><a href="#cb183-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`host_years`</span> : $17$ is the outlier, but I don't think I will include this measure in the model anyway. </span>
<span id="cb183-1118"><a href="#cb183-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`accommodates`</span>: $8, 10, 9, 16, 12, 15, 14$ are outliers. Weird numbers, I'll keep them in for now!  </span>
<span id="cb183-1119"><a href="#cb183-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`bathroom_per_person`</span>: NA values are outliers! This is interesting. </span>
<span id="cb183-1120"><a href="#cb183-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`weighted_review_score_nona`</span>: this is null, so there's none. </span>
<span id="cb183-1121"><a href="#cb183-1121" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`host_response_rate`</span>: lots of values seem to be outliers...I think this is a bad column. Let's not add it. </span>
<span id="cb183-1122"><a href="#cb183-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1123"><a href="#cb183-1123" aria-hidden="true" tabindex="-1"></a>A note here on zipcode: it probably is a good measure, but there's a lot of typo's in it and I'm not familiar with Amesterdam, so I won't go there. </span>
<span id="cb183-1124"><a href="#cb183-1124" aria-hidden="true" tabindex="-1"></a>Try to find projects that address this to get inspiration! </span>
<span id="cb183-1125"><a href="#cb183-1125" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1126"><a href="#cb183-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1129"><a href="#cb183-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1130"><a href="#cb183-1130" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bathroom_per_person))</span>
<span id="cb183-1131"><a href="#cb183-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1132"><a href="#cb183-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1133"><a href="#cb183-1133" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1134"><a href="#cb183-1134" aria-hidden="true" tabindex="-1"></a>Now let's figure out the relationships through visualizations and a correlation matrix.</span>
<span id="cb183-1135"><a href="#cb183-1135" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1136"><a href="#cb183-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1139"><a href="#cb183-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1140"><a href="#cb183-1140" aria-hidden="true" tabindex="-1"></a>corM <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(</span>
<span id="cb183-1141"><a href="#cb183-1141" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> <span class="fu">select</span>(host_since_year, accommodates, bathrooms, bedrooms,</span>
<span id="cb183-1142"><a href="#cb183-1142" aria-hidden="true" tabindex="-1"></a>    beds, price, extra_people, minimum_nights, host_response_rate, weighted_review_score_nona)</span>
<span id="cb183-1143"><a href="#cb183-1143" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb183-1144"><a href="#cb183-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1145"><a href="#cb183-1145" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the correlation values (correlation matrix)</span></span>
<span id="cb183-1146"><a href="#cb183-1146" aria-hidden="true" tabindex="-1"></a>reg_corM <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>r)</span>
<span id="cb183-1147"><a href="#cb183-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1148"><a href="#cb183-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># remove columns and rows with all NA values</span></span>
<span id="cb183-1149"><a href="#cb183-1149" aria-hidden="true" tabindex="-1"></a>reg_corM <span class="ot">&lt;-</span> reg_corM <span class="sc">%&gt;%</span></span>
<span id="cb183-1150"><a href="#cb183-1150" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb183-1151"><a href="#cb183-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">rowSums</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(.))</span>
<span id="cb183-1152"><a href="#cb183-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1153"><a href="#cb183-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA with 0 (optional)</span></span>
<span id="cb183-1154"><a href="#cb183-1154" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(reg_corM)</span>
<span id="cb183-1155"><a href="#cb183-1155" aria-hidden="true" tabindex="-1"></a>data[<span class="fu">is.na</span>(data)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NA with 0 if needed</span></span>
<span id="cb183-1156"><a href="#cb183-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1157"><a href="#cb183-1157" aria-hidden="true" tabindex="-1"></a>cor_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>r)   </span>
<span id="cb183-1158"><a href="#cb183-1158" aria-hidden="true" tabindex="-1"></a>pcor_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(corM<span class="sc">$</span>P) </span>
<span id="cb183-1159"><a href="#cb183-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1160"><a href="#cb183-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1161"><a href="#cb183-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1164"><a href="#cb183-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1165"><a href="#cb183-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Correlations data: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb183-1166"><a href="#cb183-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1167"><a href="#cb183-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(cor_values,<span class="dv">3</span>)</span>
<span id="cb183-1168"><a href="#cb183-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1169"><a href="#cb183-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1170"><a href="#cb183-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1171"><a href="#cb183-1171" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1172"><a href="#cb183-1172" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`bathrooms`</span> and <span class="in">`accommodates`</span> are correlated ($45%$)</span>
<span id="cb183-1173"><a href="#cb183-1173" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`bedrooms`</span> and <span class="in">`accommodates`</span> are highly correlated ($70%$)</span>
<span id="cb183-1174"><a href="#cb183-1174" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`beds`</span> and <span class="in">`accommodates`</span> are highly correlated ($83%$)</span>
<span id="cb183-1175"><a href="#cb183-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`price`</span> is correlated (highly) with <span class="in">`accommodates`</span>, <span class="in">`bedrooms`</span>, and <span class="in">`beds`</span> </span>
<span id="cb183-1176"><a href="#cb183-1176" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1177"><a href="#cb183-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1180"><a href="#cb183-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1181"><a href="#cb183-1181" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"p-values for correlations: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb183-1182"><a href="#cb183-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1183"><a href="#cb183-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pcor_values,<span class="dv">3</span>)</span>
<span id="cb183-1184"><a href="#cb183-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1185"><a href="#cb183-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1188"><a href="#cb183-1188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1189"><a href="#cb183-1189" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(data,</span>
<span id="cb183-1190"><a href="#cb183-1190" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Heatmap of Correlation Matrix"</span>,</span>
<span id="cb183-1191"><a href="#cb183-1191" aria-hidden="true" tabindex="-1"></a>         <span class="at">display_numbers =</span> <span class="cn">TRUE</span>,  <span class="co"># Show correlation values</span></span>
<span id="cb183-1192"><a href="#cb183-1192" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,  <span class="co"># Distance metric for clustering</span></span>
<span id="cb183-1193"><a href="#cb183-1193" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb183-1194"><a href="#cb183-1194" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,  <span class="co"># Hierarchical clustering method</span></span>
<span id="cb183-1195"><a href="#cb183-1195" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"lightgreen"</span>, <span class="st">"green"</span>))(<span class="dv">50</span>))</span>
<span id="cb183-1196"><a href="#cb183-1196" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb183-1197"><a href="#cb183-1197" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb183-1198"><a href="#cb183-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1199"><a href="#cb183-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1200"><a href="#cb183-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1203"><a href="#cb183-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1204"><a href="#cb183-1204" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb183-1205"><a href="#cb183-1205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_years, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1206"><a href="#cb183-1206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1207"><a href="#cb183-1207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of years the host has been active"</span>,</span>
<span id="cb183-1208"><a href="#cb183-1208" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Host active years"</span>,</span>
<span id="cb183-1209"><a href="#cb183-1209" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb183-1210"><a href="#cb183-1210" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1211"><a href="#cb183-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1212"><a href="#cb183-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1213"><a href="#cb183-1213" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1214"><a href="#cb183-1214" aria-hidden="true" tabindex="-1"></a>There really doesn't seem to be any relationship here. I'm not considering this in the modeling. </span>
<span id="cb183-1215"><a href="#cb183-1215" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1216"><a href="#cb183-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1219"><a href="#cb183-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1220"><a href="#cb183-1220" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb183-1221"><a href="#cb183-1221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accommodates, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1222"><a href="#cb183-1222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1223"><a href="#cb183-1223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb183-1224"><a href="#cb183-1224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of people place accommodates"</span>,</span>
<span id="cb183-1225"><a href="#cb183-1225" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of people place accommodates"</span>,</span>
<span id="cb183-1226"><a href="#cb183-1226" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb183-1227"><a href="#cb183-1227" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1228"><a href="#cb183-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1229"><a href="#cb183-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1230"><a href="#cb183-1230" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1231"><a href="#cb183-1231" aria-hidden="true" tabindex="-1"></a>There might be a subtle positive correlation here.</span>
<span id="cb183-1232"><a href="#cb183-1232" aria-hidden="true" tabindex="-1"></a>I've added the guide line (blue dashed line) to show this.</span>
<span id="cb183-1233"><a href="#cb183-1233" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1234"><a href="#cb183-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1237"><a href="#cb183-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1238"><a href="#cb183-1238" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb183-1239"><a href="#cb183-1239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1240"><a href="#cb183-1240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1241"><a href="#cb183-1241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on number of bathrooms per person"</span>,</span>
<span id="cb183-1242"><a href="#cb183-1242" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of bathrooms per person"</span>,</span>
<span id="cb183-1243"><a href="#cb183-1243" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb183-1244"><a href="#cb183-1244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1245"><a href="#cb183-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1246"><a href="#cb183-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1247"><a href="#cb183-1247" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1248"><a href="#cb183-1248" aria-hidden="true" tabindex="-1"></a>This almost seems like it goes up then down, it's interesting, but definitely not a linear relationship. </span>
<span id="cb183-1249"><a href="#cb183-1249" aria-hidden="true" tabindex="-1"></a>It seems like a bell shape! </span>
<span id="cb183-1250"><a href="#cb183-1250" aria-hidden="true" tabindex="-1"></a>Maybe a quadratic relationship? </span>
<span id="cb183-1251"><a href="#cb183-1251" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1252"><a href="#cb183-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1255"><a href="#cb183-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1256"><a href="#cb183-1256" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb183-1257"><a href="#cb183-1257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weighted_review_score_nona, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1258"><a href="#cb183-1258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1259"><a href="#cb183-1259" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on weighted rating score"</span>,</span>
<span id="cb183-1260"><a href="#cb183-1260" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Rating score (weighted)"</span>,</span>
<span id="cb183-1261"><a href="#cb183-1261" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb183-1262"><a href="#cb183-1262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1263"><a href="#cb183-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1264"><a href="#cb183-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1265"><a href="#cb183-1265" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1266"><a href="#cb183-1266" aria-hidden="true" tabindex="-1"></a>Not much to say here. </span>
<span id="cb183-1267"><a href="#cb183-1267" aria-hidden="true" tabindex="-1"></a>Most rooms have a high score. </span>
<span id="cb183-1268"><a href="#cb183-1268" aria-hidden="true" tabindex="-1"></a>There doesn't seem to be much of an intersting pattern. </span>
<span id="cb183-1269"><a href="#cb183-1269" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1270"><a href="#cb183-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1271"><a href="#cb183-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1274"><a href="#cb183-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1275"><a href="#cb183-1275" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb183-1276"><a href="#cb183-1276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_response_rate, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1277"><a href="#cb183-1277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1278"><a href="#cb183-1278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb183-1279"><a href="#cb183-1279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on hosts' response rate"</span>,</span>
<span id="cb183-1280"><a href="#cb183-1280" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Host response rate"</span>,</span>
<span id="cb183-1281"><a href="#cb183-1281" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span></span>
<span id="cb183-1282"><a href="#cb183-1282" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1283"><a href="#cb183-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1284"><a href="#cb183-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1285"><a href="#cb183-1285" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1286"><a href="#cb183-1286" aria-hidden="true" tabindex="-1"></a>The jitter is possibly making it look more interesting, but it's truly not! </span>
<span id="cb183-1287"><a href="#cb183-1287" aria-hidden="true" tabindex="-1"></a>Ok, I think I'm done with the numeric visualizations. What about non-numeric columns?</span>
<span id="cb183-1288"><a href="#cb183-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1289"><a href="#cb183-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`city`</span> </span>
<span id="cb183-1290"><a href="#cb183-1290" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`property_type`</span></span>
<span id="cb183-1291"><a href="#cb183-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`room_type`</span></span>
<span id="cb183-1292"><a href="#cb183-1292" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1293"><a href="#cb183-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1296"><a href="#cb183-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1297"><a href="#cb183-1297" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(city), <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb183-1298"><a href="#cb183-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb183-1299"><a href="#cb183-1299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on city"</span>, </span>
<span id="cb183-1300"><a href="#cb183-1300" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"City"</span>, </span>
<span id="cb183-1301"><a href="#cb183-1301" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb183-1302"><a href="#cb183-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb183-1303"><a href="#cb183-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb183-1304"><a href="#cb183-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1305"><a href="#cb183-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1306"><a href="#cb183-1306" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1307"><a href="#cb183-1307" aria-hidden="true" tabindex="-1"></a>Ok, maybe not that interesting. Seems like Amesterdam is the most expensive, and everything else is just not... so, I'll just group the cities together into a new column that accounts for whether or not the listing is in Amersterdam. </span>
<span id="cb183-1308"><a href="#cb183-1308" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1309"><a href="#cb183-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1312"><a href="#cb183-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1313"><a href="#cb183-1313" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1314"><a href="#cb183-1314" aria-hidden="true" tabindex="-1"></a>  <span class="at">isAmesterdam =</span> <span class="fu">ifelse</span>(</span>
<span id="cb183-1315"><a href="#cb183-1315" aria-hidden="true" tabindex="-1"></a>    city <span class="sc">==</span> <span class="st">'amsterdam'</span>,</span>
<span id="cb183-1316"><a href="#cb183-1316" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb183-1317"><a href="#cb183-1317" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb183-1318"><a href="#cb183-1318" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb183-1319"><a href="#cb183-1319" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1320"><a href="#cb183-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1321"><a href="#cb183-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1324"><a href="#cb183-1324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1325"><a href="#cb183-1325" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(property_type), <span class="at">y =</span> price), <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span> </span>
<span id="cb183-1326"><a href="#cb183-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb183-1327"><a href="#cb183-1327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on property type"</span>, </span>
<span id="cb183-1328"><a href="#cb183-1328" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Property type"</span>, </span>
<span id="cb183-1329"><a href="#cb183-1329" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb183-1330"><a href="#cb183-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb183-1331"><a href="#cb183-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb183-1332"><a href="#cb183-1332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1333"><a href="#cb183-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1334"><a href="#cb183-1334" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1335"><a href="#cb183-1335" aria-hidden="true" tabindex="-1"></a>Cool. This also looks interseting. </span>
<span id="cb183-1336"><a href="#cb183-1336" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1337"><a href="#cb183-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1340"><a href="#cb183-1340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1341"><a href="#cb183-1341" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(room_type), <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb183-1342"><a href="#cb183-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb183-1343"><a href="#cb183-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price changes depending on room type"</span>, </span>
<span id="cb183-1344"><a href="#cb183-1344" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Room type"</span>, </span>
<span id="cb183-1345"><a href="#cb183-1345" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Listing price"</span>) <span class="sc">+</span> </span>
<span id="cb183-1346"><a href="#cb183-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb183-1347"><a href="#cb183-1347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb183-1348"><a href="#cb183-1348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1349"><a href="#cb183-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1350"><a href="#cb183-1350" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1351"><a href="#cb183-1351" aria-hidden="true" tabindex="-1"></a>There is definitely something here! </span>
<span id="cb183-1352"><a href="#cb183-1352" aria-hidden="true" tabindex="-1"></a>Let's make sure these values are factors.</span>
<span id="cb183-1353"><a href="#cb183-1353" aria-hidden="true" tabindex="-1"></a>Then, start building the model with these variables: </span>
<span id="cb183-1354"><a href="#cb183-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1355"><a href="#cb183-1355" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`accommodates`</span> </span>
<span id="cb183-1356"><a href="#cb183-1356" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`bathroom_per_person`</span> (maybe a quadratic relationship)</span>
<span id="cb183-1357"><a href="#cb183-1357" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`weighted_review_score_nona`</span></span>
<span id="cb183-1358"><a href="#cb183-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`isAmesterdam`</span></span>
<span id="cb183-1359"><a href="#cb183-1359" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`property_type`</span></span>
<span id="cb183-1360"><a href="#cb183-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`room_type`</span></span>
<span id="cb183-1361"><a href="#cb183-1361" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1362"><a href="#cb183-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1365"><a href="#cb183-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1366"><a href="#cb183-1366" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1367"><a href="#cb183-1367" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcity =</span> <span class="fu">as.factor</span>(city),</span>
<span id="cb183-1368"><a href="#cb183-1368" aria-hidden="true" tabindex="-1"></a>  <span class="at">fproperty_type =</span> <span class="fu">as.factor</span>(property_type),</span>
<span id="cb183-1369"><a href="#cb183-1369" aria-hidden="true" tabindex="-1"></a>  <span class="at">froom_type =</span> <span class="fu">as.factor</span>(room_type),</span>
<span id="cb183-1370"><a href="#cb183-1370" aria-hidden="true" tabindex="-1"></a>  <span class="at">sqbathroom_per_person =</span> bathroom_per_person<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb183-1371"><a href="#cb183-1371" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1372"><a href="#cb183-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1373"><a href="#cb183-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1374"><a href="#cb183-1374" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1375"><a href="#cb183-1375" aria-hidden="true" tabindex="-1"></a>I will build three models, plus a null model (with no predictors) for comparison. </span>
<span id="cb183-1376"><a href="#cb183-1376" aria-hidden="true" tabindex="-1"></a>Please try various models and read about how to pick which features to include. </span>
<span id="cb183-1377"><a href="#cb183-1377" aria-hidden="true" tabindex="-1"></a>At this point, I'm just trying to build up a model that makes sense. </span>
<span id="cb183-1378"><a href="#cb183-1378" aria-hidden="true" tabindex="-1"></a>I'm still not "training" anything! </span>
<span id="cb183-1379"><a href="#cb183-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1380"><a href="#cb183-1380" aria-hidden="true" tabindex="-1"></a>Model 1 includes everything, model 2 drops the <span class="in">`weighted_review_score_nona`</span>, and model 3 is model 1 but <span class="in">`bathroom_per_person`</span> is quadratic. </span>
<span id="cb183-1381"><a href="#cb183-1381" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1382"><a href="#cb183-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1385"><a href="#cb183-1385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1386"><a href="#cb183-1386" aria-hidden="true" tabindex="-1"></a>nullmodel <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df)</span>
<span id="cb183-1387"><a href="#cb183-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1388"><a href="#cb183-1388" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> weighted_review_score_nona <span class="sc">+</span> </span>
<span id="cb183-1389"><a href="#cb183-1389" aria-hidden="true" tabindex="-1"></a>            isAmesterdam <span class="sc">+</span> fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1390"><a href="#cb183-1390" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb183-1391"><a href="#cb183-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1392"><a href="#cb183-1392" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb183-1393"><a href="#cb183-1393" aria-hidden="true" tabindex="-1"></a>            isAmesterdam <span class="sc">+</span> fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1394"><a href="#cb183-1394" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb183-1395"><a href="#cb183-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1396"><a href="#cb183-1396" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> sqbathroom_per_person <span class="sc">+</span> </span>
<span id="cb183-1397"><a href="#cb183-1397" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1398"><a href="#cb183-1398" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1399"><a href="#cb183-1399" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb183-1400"><a href="#cb183-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1401"><a href="#cb183-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1402"><a href="#cb183-1402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1403"><a href="#cb183-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1406"><a href="#cb183-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1407"><a href="#cb183-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nullmodel)</span>
<span id="cb183-1408"><a href="#cb183-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1409"><a href="#cb183-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1410"><a href="#cb183-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1413"><a href="#cb183-1413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1414"><a href="#cb183-1414" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span>
<span id="cb183-1415"><a href="#cb183-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1416"><a href="#cb183-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1419"><a href="#cb183-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1420"><a href="#cb183-1420" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb183-1421"><a href="#cb183-1421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1422"><a href="#cb183-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1423"><a href="#cb183-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1426"><a href="#cb183-1426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1427"><a href="#cb183-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span>
<span id="cb183-1428"><a href="#cb183-1428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1429"><a href="#cb183-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1430"><a href="#cb183-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1431"><a href="#cb183-1431" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1432"><a href="#cb183-1432" aria-hidden="true" tabindex="-1"></a>Testing which model is the best using ANOVA. </span>
<span id="cb183-1433"><a href="#cb183-1433" aria-hidden="true" tabindex="-1"></a>The null hypothesis is that the two models are the same. </span>
<span id="cb183-1434"><a href="#cb183-1434" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1435"><a href="#cb183-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1436"><a href="#cb183-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1439"><a href="#cb183-1439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1440"><a href="#cb183-1440" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nullmodel, model1, <span class="at">test =</span> <span class="st">"Chisq"</span>) <span class="co"># you can force it to do a chi-squared test.</span></span>
<span id="cb183-1441"><a href="#cb183-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1442"><a href="#cb183-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1443"><a href="#cb183-1443" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1444"><a href="#cb183-1444" aria-hidden="true" tabindex="-1"></a>We see from the test that the null hypothesis is rejected. </span>
<span id="cb183-1445"><a href="#cb183-1445" aria-hidden="true" tabindex="-1"></a>So, model 1 and nullmodel are different. </span>
<span id="cb183-1446"><a href="#cb183-1446" aria-hidden="true" tabindex="-1"></a>Therefore, since model 1 actually does more explaining about the outcome, model 1 is the better model from the two. </span>
<span id="cb183-1447"><a href="#cb183-1447" aria-hidden="true" tabindex="-1"></a>Additionaly, you can look at the Residual Sums of Squares (RSS), which is smaller for model 1 (the second row). </span>
<span id="cb183-1448"><a href="#cb183-1448" aria-hidden="true" tabindex="-1"></a>This means model 1 is the better model. </span>
<span id="cb183-1449"><a href="#cb183-1449" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1450"><a href="#cb183-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1453"><a href="#cb183-1453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1454"><a href="#cb183-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span>
<span id="cb183-1455"><a href="#cb183-1455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1456"><a href="#cb183-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1457"><a href="#cb183-1457" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1458"><a href="#cb183-1458" aria-hidden="true" tabindex="-1"></a>Model 1 and model 2 are different. </span>
<span id="cb183-1459"><a href="#cb183-1459" aria-hidden="true" tabindex="-1"></a>The residual sum of square in model 1 is actually lower, which means this is the better model. </span>
<span id="cb183-1460"><a href="#cb183-1460" aria-hidden="true" tabindex="-1"></a>Now compare it with model 3. </span>
<span id="cb183-1461"><a href="#cb183-1461" aria-hidden="true" tabindex="-1"></a>However, since both models are essentially the same -- this will give us no "test results": </span>
<span id="cb183-1462"><a href="#cb183-1462" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1463"><a href="#cb183-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1466"><a href="#cb183-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1467"><a href="#cb183-1467" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model3, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb183-1468"><a href="#cb183-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1469"><a href="#cb183-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1470"><a href="#cb183-1470" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1471"><a href="#cb183-1471" aria-hidden="true" tabindex="-1"></a>Instead, we can manually calculate some metrics like AIC or the mean squared error. </span>
<span id="cb183-1472"><a href="#cb183-1472" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1473"><a href="#cb183-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1474"><a href="#cb183-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1477"><a href="#cb183-1477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1478"><a href="#cb183-1478" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model1, model3)</span>
<span id="cb183-1479"><a href="#cb183-1479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1480"><a href="#cb183-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1483"><a href="#cb183-1483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1484"><a href="#cb183-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Model 1 MSE: "</span>, <span class="fu">mean</span>(<span class="fu">residuals</span>(model1)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb183-1485"><a href="#cb183-1485" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Model 3 MSE: "</span>, <span class="fu">mean</span>(<span class="fu">residuals</span>(model3)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb183-1486"><a href="#cb183-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1487"><a href="#cb183-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1488"><a href="#cb183-1488" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1489"><a href="#cb183-1489" aria-hidden="true" tabindex="-1"></a>The AIC values are barely any different, which really just means this addition of the squared representation didn't improve things.</span>
<span id="cb183-1490"><a href="#cb183-1490" aria-hidden="true" tabindex="-1"></a>In fact, the AIC went up, which is not a good thing. </span>
<span id="cb183-1491"><a href="#cb183-1491" aria-hidden="true" tabindex="-1"></a>Similar to this, the mean square error for model 3 is actually a little higher, too. </span>
<span id="cb183-1492"><a href="#cb183-1492" aria-hidden="true" tabindex="-1"></a>So, model 1 is the best. </span>
<span id="cb183-1493"><a href="#cb183-1493" aria-hidden="true" tabindex="-1"></a>Let's roll with model 1 then, and start training the data, which means, SPLIT!</span>
<span id="cb183-1494"><a href="#cb183-1494" aria-hidden="true" tabindex="-1"></a>Before that, I will mean center the numeric variables. </span>
<span id="cb183-1495"><a href="#cb183-1495" aria-hidden="true" tabindex="-1"></a>This is just to not get a negative intercept! (run the nonmeancentered version to see the difference).</span>
<span id="cb183-1496"><a href="#cb183-1496" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1497"><a href="#cb183-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1498"><a href="#cb183-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1501"><a href="#cb183-1501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1502"><a href="#cb183-1502" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1503"><a href="#cb183-1503" aria-hidden="true" tabindex="-1"></a>  <span class="at">accommodates_c =</span> accommodates <span class="sc">-</span> <span class="fu">mean</span>(accommodates), </span>
<span id="cb183-1504"><a href="#cb183-1504" aria-hidden="true" tabindex="-1"></a>  <span class="at">bathroom_per_person_c =</span> bathroom_per_person <span class="sc">-</span> <span class="fu">mean</span>(bathroom_per_person),</span>
<span id="cb183-1505"><a href="#cb183-1505" aria-hidden="true" tabindex="-1"></a>  <span class="at">weighted_review_score_nona_c =</span> weighted_review_score_nona <span class="sc">-</span> <span class="fu">mean</span>(weighted_review_score_nona), </span>
<span id="cb183-1506"><a href="#cb183-1506" aria-hidden="true" tabindex="-1"></a>  <span class="at">isAmesterdam =</span> <span class="fu">as.factor</span>(isAmesterdam)</span>
<span id="cb183-1507"><a href="#cb183-1507" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1508"><a href="#cb183-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1509"><a href="#cb183-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1510"><a href="#cb183-1510" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1511"><a href="#cb183-1511" aria-hidden="true" tabindex="-1"></a>Before we split the data, since there are three categorical variables, I need to check something -- what if there is one value for the category? Then it might show up in the test set but not training set. </span>
<span id="cb183-1512"><a href="#cb183-1512" aria-hidden="true" tabindex="-1"></a>Since this model cannot guess on un-seen data, I need to make sure it works with only observed data. </span>
<span id="cb183-1513"><a href="#cb183-1513" aria-hidden="true" tabindex="-1"></a>So, let's check for this --- in fact, there are various property types that are repeated only once or twice: Chalet, Dorm, Earth House, Hut, Treehouse and Yurt. </span>
<span id="cb183-1514"><a href="#cb183-1514" aria-hidden="true" tabindex="-1"></a>I will add these into a new category called "odd", since they're pretty odd! </span>
<span id="cb183-1515"><a href="#cb183-1515" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1516"><a href="#cb183-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1519"><a href="#cb183-1519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1520"><a href="#cb183-1520" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb183-1521"><a href="#cb183-1521" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> <span class="fu">ifelse</span>(</span>
<span id="cb183-1522"><a href="#cb183-1522" aria-hidden="true" tabindex="-1"></a>        property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'chalet'</span>, <span class="st">'dorm'</span>, <span class="st">'eart house'</span>, <span class="st">'hut'</span>, <span class="st">'treehouse'</span>, <span class="st">'yurt'</span>),</span>
<span id="cb183-1523"><a href="#cb183-1523" aria-hidden="true" tabindex="-1"></a>        <span class="st">'odd'</span>,</span>
<span id="cb183-1524"><a href="#cb183-1524" aria-hidden="true" tabindex="-1"></a>        property_type</span>
<span id="cb183-1525"><a href="#cb183-1525" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb183-1526"><a href="#cb183-1526" aria-hidden="true" tabindex="-1"></a>    <span class="at">fproperty_type =</span> <span class="fu">as.factor</span>(property_type)</span>
<span id="cb183-1527"><a href="#cb183-1527" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1528"><a href="#cb183-1528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1529"><a href="#cb183-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1530"><a href="#cb183-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1533"><a href="#cb183-1533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1534"><a href="#cb183-1534" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb183-1535"><a href="#cb183-1535" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df),</span>
<span id="cb183-1536"><a href="#cb183-1536" aria-hidden="true" tabindex="-1"></a>                <span class="fu">nrow</span>(df)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb183-1537"><a href="#cb183-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1538"><a href="#cb183-1538" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df[index, ]</span>
<span id="cb183-1539"><a href="#cb183-1539" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df[<span class="sc">-</span>index, ]</span>
<span id="cb183-1540"><a href="#cb183-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1541"><a href="#cb183-1541" aria-hidden="true" tabindex="-1"></a><span class="co">#df_train$fproperty_type &lt;- fct_lump_min(df_train$fproperty_type, min = 15)</span></span>
<span id="cb183-1542"><a href="#cb183-1542" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test$fproperty_type &lt;- fct_lump_min(df_test$fproperty_type, min = 15)</span></span>
<span id="cb183-1543"><a href="#cb183-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1544"><a href="#cb183-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1545"><a href="#cb183-1545" aria-hidden="true" tabindex="-1"></a><span class="co"># another way </span></span>
<span id="cb183-1546"><a href="#cb183-1546" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> fproperty_type) </span>
<span id="cb183-1547"><a href="#cb183-1547" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb183-1548"><a href="#cb183-1548" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb183-1549"><a href="#cb183-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1550"><a href="#cb183-1550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1551"><a href="#cb183-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1552"><a href="#cb183-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1555"><a href="#cb183-1555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1556"><a href="#cb183-1556" aria-hidden="true" tabindex="-1"></a>model_q3_nonmeancentered <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb183-1557"><a href="#cb183-1557" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1558"><a href="#cb183-1558" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1559"><a href="#cb183-1559" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb183-1560"><a href="#cb183-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1561"><a href="#cb183-1561" aria-hidden="true" tabindex="-1"></a>model_q3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb183-1562"><a href="#cb183-1562" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1563"><a href="#cb183-1563" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1564"><a href="#cb183-1564" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb183-1565"><a href="#cb183-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1566"><a href="#cb183-1566" aria-hidden="true" tabindex="-1"></a>model_q3_nonmeancentered2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates <span class="sc">+</span> bathroom_per_person <span class="sc">+</span> </span>
<span id="cb183-1567"><a href="#cb183-1567" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1568"><a href="#cb183-1568" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1569"><a href="#cb183-1569" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> train)</span>
<span id="cb183-1570"><a href="#cb183-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1571"><a href="#cb183-1571" aria-hidden="true" tabindex="-1"></a>model_q32 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb183-1572"><a href="#cb183-1572" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1573"><a href="#cb183-1573" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1574"><a href="#cb183-1574" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> train)</span>
<span id="cb183-1575"><a href="#cb183-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1576"><a href="#cb183-1576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1577"><a href="#cb183-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1578"><a href="#cb183-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1581"><a href="#cb183-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1582"><a href="#cb183-1582" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_q3)</span>
<span id="cb183-1583"><a href="#cb183-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1584"><a href="#cb183-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1585"><a href="#cb183-1585" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1586"><a href="#cb183-1586" aria-hidden="true" tabindex="-1"></a>Interpretation: </span>
<span id="cb183-1587"><a href="#cb183-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1588"><a href="#cb183-1588" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>with each one more person accommodated, the price goes up $24$ euros </span>
<span id="cb183-1589"><a href="#cb183-1589" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a one unit increase in bathroom per person adds $46$ euros to the price</span>
<span id="cb183-1590"><a href="#cb183-1590" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a one unit increase in review score is associated with $2.3$ euros increase in price </span>
<span id="cb183-1591"><a href="#cb183-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>It seems that while not significant (p-value $&gt;0.05$), listings in Amesterdam are actually $13$ euros more expensive </span>
<span id="cb183-1592"><a href="#cb183-1592" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The reference level for property type is apartment, so everything here should be compared with apartment (I'll only go over the significant relationships): </span>
<span id="cb183-1593"><a href="#cb183-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to an apartment, a bed and breakfast is almost $15$ euros more expensive </span>
<span id="cb183-1594"><a href="#cb183-1594" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to an apartment, a camper/rv is actually $77$ euros less expensive </span>
<span id="cb183-1595"><a href="#cb183-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to an apartment, a house is almost $22$ euros more expensive </span>
<span id="cb183-1596"><a href="#cb183-1596" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to an apartment, other types of property are on average $88.4$ euros more expensive. </span>
<span id="cb183-1597"><a href="#cb183-1597" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The reference level for room type is the entire house or apartment, so I compare the results to this: </span>
<span id="cb183-1598"><a href="#cb183-1598" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to the entire house or apartment, a private room is $45$ euros cheaper</span>
<span id="cb183-1599"><a href="#cb183-1599" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>compared to the entire house or apartment, a shared room is $70$ euros cheaper </span>
<span id="cb183-1600"><a href="#cb183-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1601"><a href="#cb183-1601" aria-hidden="true" tabindex="-1"></a>Read this very helpful website <span class="al">![Towards Data Science](https://towardsdatascience.com/understanding-linear-regression-output-in-r-7a9cbda948b3/)</span>.</span>
<span id="cb183-1602"><a href="#cb183-1602" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1603"><a href="#cb183-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1604"><a href="#cb183-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1605"><a href="#cb183-1605" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model Diagnositcs </span></span>
<span id="cb183-1606"><a href="#cb183-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1607"><a href="#cb183-1607" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1608"><a href="#cb183-1608" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Residuals vs Fitted &gt; Are the variances of the residuals constant? </span>
<span id="cb183-1609"><a href="#cb183-1609" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>QQnorm &gt; Are the residuals norma? </span>
<span id="cb183-1610"><a href="#cb183-1610" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>How accurate is your model (MSE, Score, etc.) </span>
<span id="cb183-1611"><a href="#cb183-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Visualize the predictions and the line you came up with! </span>
<span id="cb183-1612"><a href="#cb183-1612" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1613"><a href="#cb183-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1614"><a href="#cb183-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1617"><a href="#cb183-1617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1618"><a href="#cb183-1618" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3<span class="sc">$</span>fitted.values, </span>
<span id="cb183-1619"><a href="#cb183-1619" aria-hidden="true" tabindex="-1"></a>     model_q3<span class="sc">$</span>residuals) <span class="sc">+</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb183-1620"><a href="#cb183-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1621"><a href="#cb183-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1622"><a href="#cb183-1622" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1623"><a href="#cb183-1623" aria-hidden="true" tabindex="-1"></a>Ok, it doesn't look funnel shaped so this is fine-ish. </span>
<span id="cb183-1624"><a href="#cb183-1624" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1625"><a href="#cb183-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1626"><a href="#cb183-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1629"><a href="#cb183-1629" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1630"><a href="#cb183-1630" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb183-1631"><a href="#cb183-1631" aria-hidden="true" tabindex="-1"></a>    model_q3, </span>
<span id="cb183-1632"><a href="#cb183-1632" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> test </span>
<span id="cb183-1633"><a href="#cb183-1633" aria-hidden="true" tabindex="-1"></a>    <span class="co">#interval = "confidence"</span></span>
<span id="cb183-1634"><a href="#cb183-1634" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1635"><a href="#cb183-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1636"><a href="#cb183-1636" aria-hidden="true" tabindex="-1"></a>df_test<span class="sc">$</span>predictions <span class="ot">&lt;-</span> predictions</span>
<span id="cb183-1637"><a href="#cb183-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1638"><a href="#cb183-1638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1639"><a href="#cb183-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1640"><a href="#cb183-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1643"><a href="#cb183-1643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1644"><a href="#cb183-1644" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((df_test<span class="sc">$</span>predictions <span class="sc">-</span> df_test<span class="sc">$</span>price)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb183-1645"><a href="#cb183-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1646"><a href="#cb183-1646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1647"><a href="#cb183-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1648"><a href="#cb183-1648" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1649"><a href="#cb183-1649" aria-hidden="true" tabindex="-1"></a>This is your mean squared erros. The lower the better, so this is kind of high. </span>
<span id="cb183-1650"><a href="#cb183-1650" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1651"><a href="#cb183-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1652"><a href="#cb183-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1655"><a href="#cb183-1655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1656"><a href="#cb183-1656" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3)</span>
<span id="cb183-1657"><a href="#cb183-1657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1658"><a href="#cb183-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1659"><a href="#cb183-1659" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1660"><a href="#cb183-1660" aria-hidden="true" tabindex="-1"></a>The qq-plot kind of scares me if I'm being completely honest! Let's focus on that: </span>
<span id="cb183-1661"><a href="#cb183-1661" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb183-1662"><a href="#cb183-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1665"><a href="#cb183-1665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1666"><a href="#cb183-1666" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model_q3<span class="sc">$</span>residuals)</span>
<span id="cb183-1667"><a href="#cb183-1667" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model_q3<span class="sc">$</span>residuals, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb183-1668"><a href="#cb183-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1669"><a href="#cb183-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1670"><a href="#cb183-1670" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1671"><a href="#cb183-1671" aria-hidden="true" tabindex="-1"></a>Shapiro test's null hypothesis is: the population is normally distributed.</span>
<span id="cb183-1672"><a href="#cb183-1672" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1673"><a href="#cb183-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1676"><a href="#cb183-1676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1677"><a href="#cb183-1677" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid getting this: &gt; Error in shapiro.test(model_q3$residuals) : sample size must be between 3 and 5000, just sample 5,000 of the residuals </span></span>
<span id="cb183-1678"><a href="#cb183-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1679"><a href="#cb183-1679" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">sample</span>(model_q3<span class="sc">$</span>residuals, <span class="dv">5000</span>))</span>
<span id="cb183-1680"><a href="#cb183-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1681"><a href="#cb183-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1682"><a href="#cb183-1682" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1683"><a href="#cb183-1683" aria-hidden="true" tabindex="-1"></a>Oh great! It's not! So, now what? </span>
<span id="cb183-1684"><a href="#cb183-1684" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1685"><a href="#cb183-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1686"><a href="#cb183-1686" aria-hidden="true" tabindex="-1"></a>::: {.custom-box style="background-color: #fff8dc; padding: 1em; border-radius: 5px;"}</span>
<span id="cb183-1687"><a href="#cb183-1687" aria-hidden="true" tabindex="-1"></a>If a parametric family can be identified, then one can often achieve greatest power by explicit modeling. This can be done through generalized linear models (15). If no parametric family is found, a transformation of either the independent or dependent variables might help. The Box-Cox transform (16) provides a model-based transformation of the dependent variable. Tukey’s ladder of transformations (17) provides a graphics-based method of choosing transformation of both the dependent and independent variables.</span>
<span id="cb183-1688"><a href="#cb183-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1689"><a href="#cb183-1689" aria-hidden="true" tabindex="-1"></a>This is from: <span class="co">[</span><span class="ot">10.3945/ajcn.115.113498</span><span class="co">](https://doi.org/10.3945/ajcn.115.113498)</span>. </span>
<span id="cb183-1690"><a href="#cb183-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1691"><a href="#cb183-1691" aria-hidden="true" tabindex="-1"></a>This is beyond the scope of your course, so, all I need from you is to acknowledge that this assumption does not hold! That basically mean, this isn't the best model. </span>
<span id="cb183-1692"><a href="#cb183-1692" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1693"><a href="#cb183-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1696"><a href="#cb183-1696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1697"><a href="#cb183-1697" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_q3<span class="sc">$</span>residuals, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb183-1698"><a href="#cb183-1698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1699"><a href="#cb183-1699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1702"><a href="#cb183-1702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1703"><a href="#cb183-1703" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model_q3<span class="sc">$</span>residuals, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb183-1704"><a href="#cb183-1704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1705"><a href="#cb183-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1708"><a href="#cb183-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1709"><a href="#cb183-1709" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> predictions, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1710"><a href="#cb183-1710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       </span>
<span id="cb183-1711"><a href="#cb183-1711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1712"><a href="#cb183-1712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs actual prices (test)"</span>,</span>
<span id="cb183-1713"><a href="#cb183-1713" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted price"</span>,</span>
<span id="cb183-1714"><a href="#cb183-1714" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Actual price"</span>) <span class="sc">+</span></span>
<span id="cb183-1715"><a href="#cb183-1715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1716"><a href="#cb183-1716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1717"><a href="#cb183-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1718"><a href="#cb183-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1721"><a href="#cb183-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1722"><a href="#cb183-1722" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb183-1723"><a href="#cb183-1723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb183-1724"><a href="#cb183-1724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predictions), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb183-1725"><a href="#cb183-1725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model fit on test set"</span>,</span>
<span id="cb183-1726"><a href="#cb183-1726" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms per person"</span>,</span>
<span id="cb183-1727"><a href="#cb183-1727" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb183-1728"><a href="#cb183-1728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1729"><a href="#cb183-1729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1730"><a href="#cb183-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1731"><a href="#cb183-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1732"><a href="#cb183-1732" aria-hidden="true" tabindex="-1"></a><span class="fu">### A better model? </span></span>
<span id="cb183-1733"><a href="#cb183-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1734"><a href="#cb183-1734" aria-hidden="true" tabindex="-1"></a>:::{.blue-text}</span>
<span id="cb183-1735"><a href="#cb183-1735" aria-hidden="true" tabindex="-1"></a>You may be able to build a better model. Let's see this. </span>
<span id="cb183-1736"><a href="#cb183-1736" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-1737"><a href="#cb183-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1738"><a href="#cb183-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1741"><a href="#cb183-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1742"><a href="#cb183-1742" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>price_log <span class="ot">&lt;-</span> <span class="fu">log</span>(df<span class="sc">$</span>price)</span>
<span id="cb183-1743"><a href="#cb183-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1744"><a href="#cb183-1744" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df[index, ]</span>
<span id="cb183-1745"><a href="#cb183-1745" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df[<span class="sc">-</span>index, ]</span>
<span id="cb183-1746"><a href="#cb183-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1747"><a href="#cb183-1747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1748"><a href="#cb183-1748" aria-hidden="true" tabindex="-1"></a>model_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(price_log <span class="sc">~</span> accommodates_c <span class="sc">+</span> bathroom_per_person_c <span class="sc">+</span> </span>
<span id="cb183-1749"><a href="#cb183-1749" aria-hidden="true" tabindex="-1"></a>            weighted_review_score_nona_c <span class="sc">+</span> isAmesterdam <span class="sc">+</span> </span>
<span id="cb183-1750"><a href="#cb183-1750" aria-hidden="true" tabindex="-1"></a>            fproperty_type <span class="sc">+</span> froom_type, </span>
<span id="cb183-1751"><a href="#cb183-1751" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> df_train)</span>
<span id="cb183-1752"><a href="#cb183-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1753"><a href="#cb183-1753" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_log)</span>
<span id="cb183-1754"><a href="#cb183-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1755"><a href="#cb183-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1756"><a href="#cb183-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1757"><a href="#cb183-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1758"><a href="#cb183-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1761"><a href="#cb183-1761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1762"><a href="#cb183-1762" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log<span class="sc">$</span>fitted.values, model_log<span class="sc">$</span>residuals) <span class="sc">+</span> <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb183-1763"><a href="#cb183-1763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1764"><a href="#cb183-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1765"><a href="#cb183-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1768"><a href="#cb183-1768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1769"><a href="#cb183-1769" aria-hidden="true" tabindex="-1"></a>predictionsLog <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb183-1770"><a href="#cb183-1770" aria-hidden="true" tabindex="-1"></a>    model_log, </span>
<span id="cb183-1771"><a href="#cb183-1771" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> df_test</span>
<span id="cb183-1772"><a href="#cb183-1772" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-1773"><a href="#cb183-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1774"><a href="#cb183-1774" aria-hidden="true" tabindex="-1"></a>df_test<span class="sc">$</span>predictionsLog <span class="ot">&lt;-</span> predictionsLog</span>
<span id="cb183-1775"><a href="#cb183-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1776"><a href="#cb183-1776" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1777"><a href="#cb183-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1778"><a href="#cb183-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1781"><a href="#cb183-1781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1782"><a href="#cb183-1782" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((df_test<span class="sc">$</span>predictionsLog <span class="sc">-</span> df_test<span class="sc">$</span>price_log)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb183-1783"><a href="#cb183-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1784"><a href="#cb183-1784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1785"><a href="#cb183-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1786"><a href="#cb183-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1789"><a href="#cb183-1789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1790"><a href="#cb183-1790" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log)</span>
<span id="cb183-1791"><a href="#cb183-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1792"><a href="#cb183-1792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1793"><a href="#cb183-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1794"><a href="#cb183-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1797"><a href="#cb183-1797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1798"><a href="#cb183-1798" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(model_log<span class="sc">$</span>residuals)</span>
<span id="cb183-1799"><a href="#cb183-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(model_log<span class="sc">$</span>residuals, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb183-1800"><a href="#cb183-1800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1801"><a href="#cb183-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1802"><a href="#cb183-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1805"><a href="#cb183-1805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1806"><a href="#cb183-1806" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">sample</span>(model_log<span class="sc">$</span>residuals, <span class="dv">5000</span>))</span>
<span id="cb183-1807"><a href="#cb183-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1808"><a href="#cb183-1808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1809"><a href="#cb183-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1810"><a href="#cb183-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1813"><a href="#cb183-1813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1814"><a href="#cb183-1814" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_log<span class="sc">$</span>residuals, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb183-1815"><a href="#cb183-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1816"><a href="#cb183-1816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1817"><a href="#cb183-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1818"><a href="#cb183-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1821"><a href="#cb183-1821" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1822"><a href="#cb183-1822" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model_log<span class="sc">$</span>residuals)</span>
<span id="cb183-1823"><a href="#cb183-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1824"><a href="#cb183-1824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1825"><a href="#cb183-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1826"><a href="#cb183-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1827"><a href="#cb183-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1830"><a href="#cb183-1830" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1831"><a href="#cb183-1831" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> predictionsLog, <span class="at">y =</span> price_log)) <span class="sc">+</span></span>
<span id="cb183-1832"><a href="#cb183-1832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       </span>
<span id="cb183-1833"><a href="#cb183-1833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb183-1834"><a href="#cb183-1834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted vs actual prices (test), log model"</span>,</span>
<span id="cb183-1835"><a href="#cb183-1835" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted price (log)"</span>,</span>
<span id="cb183-1836"><a href="#cb183-1836" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Actual price (log)"</span>) <span class="sc">+</span></span>
<span id="cb183-1837"><a href="#cb183-1837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1838"><a href="#cb183-1838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1839"><a href="#cb183-1839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1840"><a href="#cb183-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1843"><a href="#cb183-1843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1844"><a href="#cb183-1844" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_test, <span class="fu">aes</span>(<span class="at">x =</span> bathroom_per_person, <span class="at">y =</span> price_log)) <span class="sc">+</span></span>
<span id="cb183-1845"><a href="#cb183-1845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb183-1846"><a href="#cb183-1846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predictionsLog), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb183-1847"><a href="#cb183-1847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model fit on test set (log)"</span>,</span>
<span id="cb183-1848"><a href="#cb183-1848" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms per person (log)"</span>,</span>
<span id="cb183-1849"><a href="#cb183-1849" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span></span>
<span id="cb183-1850"><a href="#cb183-1850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb183-1851"><a href="#cb183-1851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>